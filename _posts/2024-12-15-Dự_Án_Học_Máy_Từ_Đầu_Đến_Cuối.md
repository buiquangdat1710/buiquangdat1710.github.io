---
title: "D·ª± √Ån H·ªçc M√°y T·ª´ ƒê·∫ßu ƒê·∫øn Cu·ªëi"
date: 2024-12-14 00:00:00  + 0800
categories: [Gi√°o Tr√¨nh D·∫°y AI ProPTIT]
tags: [machine learning]
---
---

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
        }
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_HTML-full"></script>

ƒê√¢y l√† b√†i cu·ªëi c√πng trong ph·∫ßn Machine Learning c∆° b·∫£n, t√¥i vi·∫øt b√†i n√†y tr∆∞·ªõc t·∫°i v√¨ t√¥i mu·ªën, h√£y c√¢n nh·∫Øc b·∫°n c√≥ ƒë·ªß ki·∫øn th·ª©c ƒë·ªÉ ƒë·ªçc n√≥. Trong blog n√†y, ch√∫ng ta s·∫Ω ƒë√≥ng vai nh√† khoa h·ªçc d·ªØ li·ªáu v·ª´a ƒë∆∞·ª£c tuy·ªÉn d·ª•ng b·ªüi m·ªôt c√¥ng ty b·∫•t ƒë·ªông s·∫£n, v√† s·∫Ω l√†m vi·ªác trong m·ªôt d·ª± √°n t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi. D∆∞·ªõi ƒë√¢y l√† nh·ªØng b∆∞·ªõc m√† ta s·∫Ω th·ª±c hi·ªán:
1. Nh√¨n v√†o b·ª©c tranh t·ªïng th·ªÉ.
2. L·∫•y d·ªØ li·ªáu.
3. Kh√°m ph√° v√† tr·ª±c quan h√≥a ƒë·ªÉ hi·ªÉu d·ªØ li·ªáu.
4. Chu·∫©n b·ªã d·ªØ li·ªáu cho c√°c thu·∫≠t to√°n H·ªçc M√°y.
5. L·ª±a ch·ªçn v√† hu·∫•n luy·ªán m√¥ h√¨nh H·ªçc M√°y.
6. Tinh ch·ªânh m√¥ h√¨nh H·ªçc M√°y.
7. Tr√¨nh b√†y gi·∫£i ph√°p.
8. Tri·ªÉn khai, gi√°m s√°t v√† b·∫£o tr√¨ h·ªá th·ªëng.


## 1. L√†m vi·ªác v·ªõi d·ªØ li·ªáu th·ª±c

- Khi t√¨m hi·ªÉu v·ªÅ H·ªçc M√°y, c√°ch t·ªët nh·∫•t l√† th·ª≠ nghi·ªám tr√™n d·ªØ li·ªáu th·ª±c t·∫ø thay v√¨ c√°c t·∫≠p d·ªØ li·ªáu nh√¢n t·∫°o. May m·∫Øn thay, hi·ªán nay ta c√≥ th·ªÉ s·ª≠ d·ª•ng h√†ng ng√†n t·∫≠p d·ªØ li·ªáu m·ªü trong h·∫ßu h·∫øt c√°c lƒ©nh v·ª±c. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë ngu·ªìn ƒë·ªÉ l·∫•y d·ªØ li·ªáu m√† b·∫°n c√≥ th·ªÉ tham kh·∫£o:
  - C√°c kho d·ªØ li·ªáu m·ªü ph·ªï bi·∫øn:
    - [Kho D·ªØ Li·ªáu H·ªçc M√°y c·ªßa tr∆∞·ªùng UC Irvine](https://archive.ics.uci.edu/)
    - [C√°c t·∫≠p d·ªØ li·ªáu tr√™n Kaggle](https://www.kaggle.com/datasets)
    - [C√°c t·∫≠p d·ªØ li·ªáu tr√™n Amazon AWS](https://registry.opendata.aws/)
  - C·ªïng th√¥ng tin c√°c kho d·ªØ li·ªáu m·ªü:
    - [Data Portals](https://dataportals.org/)
    - [OpenDataMonitor](https://opendatamonitor.eu/frontend/web/index.php?r=dashboard%2Findex)
    - [Quandl](https://data.nasdaq.com/institutional-investors)
  - C√°c trang web kh√°c:
    - [Danh s√°ch c√°c t·∫≠p d·ªØ li·ªáu H·ªçc M√°y tr√™n Wikipedia](https://en.wikipedia.org/wiki/List_of_datasets_for_machine-learning_research)
    - [Quora.com](https://www.quora.com/Where-can-I-find-large-datasets-open-to-the-public)
    - [Subreddit v·ªÅ c√°c t·∫≠p d·ªØ li·ªáu](https://www.reddit.com/r/datasets/)

- Trong ch∆∞∆°ng n√†y, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng t·∫≠p d·ªØ li·ªáu Gi√° nh√† ·ªü California t·ª´ kho d·ªØ li·ªáu StatLib (tham kh·∫£o h√¨nh 2.1). T·∫≠p d·ªØ li·ªáu n√†y d·ª±a tr√™n k·∫øt qu·∫£ c·ªßa cu·ªôc ƒëi·ªÅu tra d√¢n s·ªë nƒÉm 1990 ·ªü bang California. N√≥ kh√¥ng ph·∫£n √°nh ƒë√∫ng gi√° c·∫£ hi·ªán t·∫°i (gi√° m·ªôt ng·ªìi nh√† t·ªët ·ªü Bay Area l√∫c ƒë√≥ v·∫´n c√≤n r·∫ª), nh∆∞ng l·∫°i s·ªü h·ªØu nhi·ªÅu t√≠nh ch·∫•t h·ªó tr·ª£ vi·ªác h·ªçc n√™n h√£y c·ª© gi·∫£ s·ª≠ r·∫±ng t·∫≠p d·ªØ li·ªáu n√†y m·ªõi ƒë∆∞·ª£c thu nh·∫≠p g·∫ßn ƒë√¢y. ƒê·ªÉ ph√π h·ª£p v·ªõi m·ª•c ƒë√≠ch gi·∫£ng d·∫°y, t√¥i ƒë√£ th√™m v√†o m·ªôt v√†i thu·ªôc t√≠nh h·∫°ng m·ª•c v√† lo·∫°i b·ªè m·ªôt v√†i ƒë·∫∑c tr∆∞ng:

![anh](./image/168.png)

## 2. Nh√¨n v√†o b·ª©c tranh t·ªïng th·ªÉ

- Nhi·ªám v·ª• ƒë·∫ßu ti√™n c·ªßa b·∫°n l√† s·ª≠ d·ª•ng t·∫≠p d·ªØ li·ªáu ƒëi·ªÅu tra d√¢n s·ªë c·ªßa bang California ƒë·ªÉ x√¢y d·ª±ng m·ªôt m√¥ h√¨nh d·ª± ƒëo√°n gi√° nh√† t·∫°i bang. D·ªØ li·ªáu n√†y bao g·ªìm c√°c s·ªë li·ªáu nh∆∞ d√¢n s·ªë, thu nh·∫≠p trung v·ªã v√† gi√° nh√† trung v·ªã cho t·ª´ng block ·ªü California. Block l√† ƒë∆°n v·ªã ƒë·ªãa l√Ω nh·ªè nh·∫•t m√† c·ª•c ƒëi·ªÅu tra d√¢n s·ªë Hoa K·ª≥ s·ª≠ d·ª•ng ƒë·ªÉ c√¥ng b·ªë d·ªØ li·ªáu m·∫´u (m·ªôt block th∆∞·ªùng c√≥ d√¢n s·ªë t·ª´ 600 ƒë·∫øn 3,000 ng∆∞·ªùi). ƒê·ªÉ thu·∫≠n ti·ªán, ta s·∫Ω g·ªçi c√°c block l√† c√°c "qu·∫≠n".
- M√¥ h√¨nh c·ªßa ta s·∫Ω c·∫ßn h·ªçc t·ª´ t·∫≠p d·ªØ li·ªáu n√†y v√† d·ª± ƒëo√°n gi√° nh√† trung v·ªã cho m·ªôt qu·∫≠n b·∫•t k·ª≥, d·ª±a tr√™n t·∫•t c·∫£ c√°c s·ªë li·ªáu ƒë√£ cho.

> üíπ **M·∫πo:** L√† m·ªôt nh√† khoa h·ªçc d·ªØ li·ªáu b√†i b·∫£n, vi·ªác ƒë·∫ßu ti√™n b·∫°n c·∫ßn l√†m l√† t·∫°o m·ªôt danh m·ª•c c√¥ng vi·ªác cho d·ª± √°n H·ªçc M√°y. B·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu b·∫±ng c√°ch tham kh·∫£o Ph·ª• l·ª•c cu·ªëi c√πng c·ªßa blog n√†y, m√¥ t·∫£ m·ªôt khu√¥n m·∫´u ph√π h·ª£p cho h·∫ßu h·∫øt c√°c d·ª± √°n H·ªçc M√°y. Tuy nhi√™n, h√£y ƒëi·ªÅu ch·ªânh danh m·ª•c c√¥ng vi·ªác theo nhu c·∫ßu c·ª• th·ªÉ c·ªßa b·∫°n. Trong blog n√†y, t√¥i s·∫Ω th·ª±c hi·ªán nhi·ªÅu vi·ªác trong danh m·ª•c, nh∆∞ng c≈©ng s·∫Ω b·ªè qua m·ªôt v√†i vi·ªác do ch√∫ng kh√¥ng c·∫ßn thi·∫øt.

### Ph√°t bi·ªÉu b√†i to√°n

- Tr∆∞·ªõc h·∫øt, b·∫°n n√™n h·ªèi s·∫øp v·ªÅ m·ª•c ti√™u c·ªßa d·ª± √°n. X√¢y d·ª±ng m·ªôt m√¥ h√¨nh c√≥ l·∫Ω kh√¥ng ph·∫£i l√† m·ª•c ti√™u cu·ªëi c√πng. C√¥ng ty s·∫Ω s·ª≠ d·ª•ng v√† thu l·ª£i t·ª´ m√¥ h√¨nh n√†y nh∆∞ th·∫ø n√†o? Bi·∫øt ƒë∆∞·ª£c m·ª•c ti√™u r·∫•t quan tr·ªçng v√¨ n√≥ s·∫Ω x√°c ƒë·ªãnh c√°ch b·∫°n ph√°t bi·ªÉu b√†i to√°n, thu·∫≠t to√°n ƒë∆∞·ª£c l·ª±a ch·ªçn, ph√©p ƒëo ch·∫•t l∆∞·ª£ng m√† b·∫°n s·∫Ω s·ª≠ d·ª•ng ƒë·ªÉ ƒë√°nh gi√° m√¥ h√¨nh v√† c√¥ng s·ª©c b·∫°n c·∫ßn b·ªè ra ƒë·ªÉ tinh ch·ªânh n√≥.

- S·∫øp c·ªßa b·∫°n tr·∫£ l·ªùi r·∫±ng ƒë·∫ßu ra c·ªßa m√¥ h√¨nh (d·ª± ƒëo√°n gi√° nh√† trung v·ªã c·ªßa m·ªôt qu·∫≠n) s·∫Ω ƒë∆∞·ª£c ƒë∆∞a ti·∫øp v√†o m·ªôt h·ªá th·ªëng H·ªçc M√°y kh√°c (tham kh·∫£o H√¨nh 2.2), c√πng v·ªõi c√°c d·ªØ li·ªáu kh√°c. H·ªá th·ªëng n√†y s·∫Ω x√°c ƒë·ªãnh li·ªáu c√≥ ƒë√°ng ƒë·ªÉ ƒë·∫ßu t∆∞ v√†o m·ªôt khu v·ª±c n√†o ƒë√≥ hay kh√¥ng. Vi·ªác n·∫Øm ƒë∆∞·ª£c th√¥ng tin n√†y r·∫•t quan tr·ªçng, v√¨ n√≥ ·∫£nh h∆∞·ªüng tr·ª±c ti·∫øp t·ªõi l·ª£i nhu·∫≠n c·ªßa c√¥ng ty.

![anh](./image/169.png)


- C√¢u h·ªèi ti·∫øp theo cho s·∫øp l√† v·ªÅ gi·∫£i ph√°p hi·ªán t·∫°i (n·∫øu c√≥). T√¨nh h√¨nh hi·ªán t·∫°i th∆∞·ªùng s·∫Ω cung c·∫•p m·ªôt c√°ch ƒë·ªëi chi·∫øu ch·∫•t l∆∞·ª£ng, ƒë·ªìng th·ªùi gi√∫p ta hi·ªÉu th√™m v·ªÅ c√°c ph∆∞∆°ng ph√°p gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ. S·∫øp c·ªßa b·∫°n tr·∫£ l·ªùi r·∫±ng gi√° nh√† ·ªü c·ªßa m·ªôt qu·∫≠n hi·ªán ƒë∆∞·ª£c chuy√™n gia ∆∞·ªõc l∆∞·ª£ng m·ªôt c√°ch th·ªß c√¥ng: m·ªôt nh√≥m thu th·∫≠p c√°c th√¥ng tin c∆° b·∫£n v·ªÅ qu·∫≠n ƒë√≥ v√† khi kh√¥ng c√≥ gi√° nh√† trung v·ªã, h·ªç ∆∞·ªõc l∆∞·ª£ng n√≥ b·∫±ng c√°c quy t·∫Øc ph·ª©c t·∫°p.

- C√°ch n√†y r·∫•t t·ªën k√©m v√† m·∫•t th·ªùi gian, v√† c√°c gi√° tr·ªã ∆∞·ªõc l∆∞·ª£ng th∆∞·ªùng kh√¥ng ch√≠nh x√°c. Trong tr∆∞·ªùng h·ª£p t√¨m ƒë∆∞·ª£c gi√° nh√† trung v·ªã th·ª±c t·∫ø, h·ªç nh·∫≠n th·∫•y r·∫±ng c√°c ∆∞·ªõc l∆∞·ª£ng th∆∞·ªùng sai l·ªách h∆°n 20%. Do ƒë√≥, c√¥ng ty cho r·∫±ng s·∫Ω r·∫•t h·ªØu √≠ch n·∫øu hu·∫•n luy·ªán ƒë∆∞·ª£c m·ªôt m√¥ h√¨nh d·ª± ƒëo√°n gi√° nh√† trung v·ªã c·ªßa c√°c qu·∫≠n, khi bi·∫øt c√°c d·ªØ li·ªáu kh√°c v·ªÅ qu·∫≠n ƒë√≥. D·ªØ li·ªáu hi·ªán ra d·∫ßn ƒë√≥ ƒë∆∞·ª£c coi l√† m·ªôt t·∫≠p d·ªØ li·ªáu tuy·ªát v·ªùi ƒë·ªÉ s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch n√†y, v√¨ n√≥ bao g·ªìm gi√° nh√† trung v·ªã c·ªßa h√†ng ngh√¨n qu·∫≠n, c≈©ng nh∆∞ c√°c d·ªØ li·ªáu kh√°c.

- V·ªõi t·∫•t c·∫£ nh·ªØng th√¥ng tin tr√™n, b√¢y gi·ªù b·∫°n ƒë√£ s·∫µn s√†ng ƒë·ªÉ b·∫Øt ƒë·∫ßu thi·∫øt k·∫ø h·ªá th·ªëng c·ªßa m√¨nh. ƒê·∫ßu ti√™n, b·∫°n c·∫ßn x√°c ƒë·ªãnh b√†i to√°n: ƒë√¢y l√† b√†i to√°n h·ªçc c√≥ gi√°m s√°t, h·ªçc kh√¥ng gi√°m s√°t, hay h·ªçc tƒÉng c∆∞·ªùng? ƒê√¢y l√† b√†i to√°n ph√¢n lo·∫°i, h·ªìi quy, hay m·ªôt b√†i to√°n kh√°c? B·∫°n n√™n s·ª≠ d·ª•ng k·ªπ thu·∫≠t h·ªçc theo batch hay h·ªçc tr·ª±c tuy·∫øn? Tr∆∞·ªõc khi ƒë·ªçc ti·∫øp, b·∫°n ƒë·ªçc h√£y t·∫°m d·ª´ng m·ªôt ch√∫t v√† c·ªë g·∫Øng t·ª± tr·∫£ l·ªùi nh·ªØng c√¢u h·ªèi n√†y.

- B·∫°n ƒë√£ t√¨m th·∫•y c√¢u tr·∫£ l·ªùi ch∆∞a? C√≥ th·ªÉ th·∫•y, r√µ r√†ng ƒë√¢y l√† m·ªôt b√†i to√°n h·ªçc c√≥ gi√°m s√°t ƒëi·ªÉn h√¨nh, v√¨ b·∫°n c√≥ m·ªôt t·∫≠p d·ªØ li·ªáu hu·∫•n luy·ªán ƒë√£ ƒë∆∞·ª£c g√°n nh√¢n (m·ªói m·∫´u c√≥ m·ªôt gi√° tr·ªã nh√¢n t∆∞∆°ng ·ª©ng, trong tr∆∞·ªùng h·ª£p n√†y l√† gi√° nh√† ·ªü trung v·ªã c·ªßa qu·∫≠n ƒë√≥). ƒê√¢y c≈©ng l√† m·ªôt b√†i to√°n h·ªìi quy ƒëi·ªÉn h√¨nh, v√¨ b·∫°n ƒë∆∞·ª£c y√™u c·∫ßu d·ª± ƒëo√°n m·ªôt gi√° tr·ªã. C·ª• th·ªÉ h∆°n, ƒë√¢y l√† b√†i to√°n ƒëa h·ªìi quy (multiple regression), v√¨ h·ªá th·ªëng s·∫Ω s·ª≠ d·ª•ng nhi·ªÅu ƒë·∫∑c tr∆∞ng ƒë·ªÉ ƒë∆∞a ra d·ª± ƒëo√°n (nh∆∞ d√¢n s·ªë c·ªßa qu·∫≠n, trung v·ªã thu nh·∫≠p, v.v.). ƒê√¢y c≈©ng l√† b√†i to√°n h·ªìi quy ƒë∆°n bi·∫øn (univariate regression), v√¨ ta ch·ªâ d·ª± ƒëo√°n m·ªôt gi√° tr·ªã cho m·ªôt qu·∫≠n. N·∫øu ta d·ª± ƒëo√°n nhi·ªÅu gi√° tr·ªã cho m·ªôt qu·∫≠n, th√¨ n√≥ s·∫Ω l√† b√†i to√°n h·ªìi quy ƒëa bi·∫øn (multivariate regression). Cu·ªëi c√πng, do kh√¥ng c√≥ l∆∞·ª£ng d·ªØ li·ªáu l·ªõn t·ªõi h·ªá th·ªëng n√™n ta s·∫Ω kh√¥ng c·∫ßn ph·∫£i ƒëi·ªÅu ch·ªânh ƒë·ªÉ th√≠ch nghi v·ªõi d·ªØ li·ªáu m·ªôt c√°ch nhanh ch√≥ng. ƒê·ªìng th·ªùi, d·ªØ li·ªáu ƒë·ªß nh·ªè ƒë·ªÉ ƒë∆∞a v√†o b·ªô nh·ªõ, n√™n ta c√≥ th·ªÉ ƒë∆°n thu·∫ßn s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p h·ªçc theo batch.

> üíπ **M·∫πo:** N·∫øu l∆∞·ª£ng d·ªØ li·ªáu qu√° l·ªõn, ta c√≥ th·ªÉ chia nh·ªè vi·ªác h·ªçc theo batch ra c√°c server (s·ª≠ d·ª•ng k·ªπ thu·∫≠t MapReduce) ho·∫∑c s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p h·ªçc tr·ª±c tuy·∫øn.

### L·ª±a ch·ªçn ph√©p ƒëo ch·∫•t l∆∞·ª£ng

- B∆∞·ªõc ti·∫øp theo l√† l·ª±a ch·ªçn m·ªôt ph√©p ƒëo ch·∫•t l∆∞·ª£ng ph√π h·ª£p. M·ªôt ph√©p ƒëo ch·∫•t l∆∞·ª£ng ƒëi·ªÉn h√¨nh trong b√†i to√°n h·ªìi quy l√† cƒÉn b·∫≠c hai trung b√¨nh b√¨nh ph∆∞∆°ng sai s·ªë (Root Mean Square Error - **RMSE**). Ph√©p ƒëo n√†y cho bi·∫øt sai s·ªë m√† h·ªá th·ªëng th∆∞·ªùng ph·∫°m ph·∫£i khi ƒë∆∞a ra d·ª± ƒëo√°n, v·ªõi tr·ªçng s·ªë l·ªõn cho nh·ªØng sai s·ªë l·ªõn. Ph∆∞∆°ng tr√¨nh d∆∞·ªõi tr√¨nh b√†y c√¥ng th·ª©c to√°n h·ªçc ƒë·ªÉ t√≠nh gi√° tr·ªã **RMSE**:

$$\text{RMSE}(\mathbf{X}, h) = \sqrt{\frac{1}{m} \sum_{i=1}^{m} \left( h(\mathbf{x}^{(i)}) - y^{(i)} \right)^2 }$$

- M·∫∑c d√π **RMSE** nh√¨n chung kh√° ph·ªï bi·∫øn cho b√†i to√°n h·ªìi quy, trong m·ªôt v√†i tr∆∞·ªùng h·ª£p ta c√≥ th·ªÉ l·ª±a ch·ªçn ph√©p ƒëo kh√°c. V√≠ d·ª•, gi·∫£ s·ª≠ t·∫≠p d·ªØ li·ªáu c√≥ nhi·ªÅu qu·∫≠n ngo·∫°i lai. Trong tr∆∞·ªùng h·ª£p n√†y, b·∫°n c√≥ th·ªÉ c√¢n nh√°c s·ª≠ d·ª•ng trung b√¨nh sai s·ªë tuy·ªát ƒë·ªëi (Mean Absolute Error - **MAE**) hay c√≤n ƒë∆∞·ª£c g·ªçi l√† trung b√¨nh ƒë·ªô l·ªách tuy·ªát ƒë·ªëi:

$$\text{MAE}(\mathbf{X}, h) = \frac{1}{m} \sum_{i=1}^{m} \left| h\left(\mathbf{x}^{(i)}\right) - y^{(i)} \right|$$

- Ngo√†i ra th√¨ ph√©p ƒëo trung b√¨nh b√¨nh ph∆∞∆°ng sai s·ªë (Mean Square Error - **MSE**) c≈©ng ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·ªï bi·∫øn:


$$\text{MSE}(\mathbf{X}, h) = \frac{1}{m} \sum_{i=1}^{m} \left( h(\mathbf{x}^{(i)}) - y^{(i)} \right)^2$$

- B·∫£ng d∆∞·ªõi ƒë√¢y so s√°nh ba ph√©p ƒëo d·ª±a tr√™n t·ª´ng ti√™u ch√≠:

| **Ti√™u ch√≠**                     | **MAE**      | **MSE**       | **RMSE** |
|----------------------------------|------------------------------------|-----------------------------------|-----------------------------------|
| **M·ª©c ƒë·ªô nh·∫°y c·∫£m v·ªõi outliers** | √çt nh·∫°y c·∫£m.                      | R·∫•t nh·∫°y c·∫£m (ph·∫°t sai s·ªë l·ªõn h∆°n). | R·∫•t nh·∫°y c·∫£m (nh∆∞ MSE).          |
| **T·∫≠p trung v√†o sai s·ªë l·ªõn**     | Kh√¥ng ∆∞u ti√™n sai s·ªë l·ªõn.          | Ph·∫°t n·∫∑ng sai s·ªë l·ªõn.              | Ph·∫°t n·∫∑ng sai s·ªë l·ªõn.            |
| **Kh·∫£ nƒÉng t·ªëi ∆∞u h√≥a (H√†m cost)**          | Kh√≥ t·ªëi ∆∞u v√¨ ƒë·∫°o h√†m kh√¥ng li√™n t·ª•c. | D·ªÖ t·ªëi ∆∞u v√¨ ƒë·∫°o h√†m li√™n t·ª•c.     | D·ªÖ t·ªëi ∆∞u v√¨ ƒë·∫°o h√†m li√™n t·ª•c.   |
| **ƒê·ªô ph·ª©c t·∫°p t√≠nh to√°n**        | Th·∫•p.                             | Trung b√¨nh.                        | Cao h∆°n MSE do c√≥ cƒÉn b·∫≠c hai.   |
| **Khi n√†o n√™n d√πng?**            | Khi d·ªØ li·ªáu c√≥ nhi·ªÅu outliers.     | Khi sai s·ªë l·ªõn c·∫ßn ch√∫ tr·ªçng.      | Khi c·∫ßn di·ªÖn gi·∫£i sai s·ªë tr·ª±c quan. |
| **V√≠ d·ª• ·ª©ng d·ª•ng**               | D·ª± ƒëo√°n gi√° nh√† trong d·ªØ li·ªáu nhi·ªÖu. | B√†i to√°n h·ªìi quy ch√≠nh x√°c cao.    | D·ª± b√°o th·ªùi ti·∫øt, nhi·ªát ƒë·ªô,...   |


### Ki·ªÉm tra c√°c gi·∫£ ƒë·ªãnh

- Cu·ªëi c√πng, vi·ªác li·ªát k√™ v√† ki·ªÉm tra c√°c gi·∫£ ƒë·ªãnh ƒë√£ ƒë∆∞·ª£c ƒë∆∞a ra (b·ªüi b·∫°n ho·∫∑c ng∆∞·ªùi kh√°c) l√† m·ªôt th√≥i quen t·ªët. Vi·ªác n√†y gi√∫p ta s·ªõm ph√°t hi·ªán c√°c v·∫•n ƒë·ªÅ nghi√™m tr·ªçng. V√≠ d·ª•: gi√° nh√† ·ªü m·ªôt qu·∫≠n m√† h·ªá th·ªëng d·ª± ƒëo√°n s·∫Ω ƒë∆∞·ª£c ƒë∆∞a v√†o m·ªôt h·ªá th·ªëng H·ªçc M√°y kh√°c v√† ta gi·∫£ ƒë·ªãnh r·∫±ng nh·ªØng gi√° tr·ªã n√†y v·∫´n ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü ƒë·ªãnh d·∫°ng s·ªë. Nh∆∞ng ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra n·∫øu h·ªá th·ªëng ti·∫øp theo chuy·ªÉn ƒë·ªïi gi√° nh√† ·ªü th√†nh c√°c h·∫°ng m·ª•c (v√≠ d·ª•: ‚Äúr·∫ª‚Äù, ‚Äútrung b√¨nh‚Äù ho·∫∑c ‚Äúƒë·∫Øt‚Äù) v√† sau ƒë√≥ s·ª≠ d·ª•ng c√°c h·∫°ng m·ª•c ƒë√≥ thay v√¨ c√°c con s·ªë ban ƒë·∫ßu? Trong tr∆∞·ªùng h·ª£p n√†y, vi·ªác d·ª± ƒëo√°n ch√≠nh x√°c m·ª©c gi√° kh√¥ng c√≤n quan tr·ªçng n·ªØa, m√† h·ªá th·ªëng c·ªßa b·∫°n ch·ªâ c·∫ßn ch·ªçn ƒë√∫ng h·∫°ng m·ª•c. Khi ƒë√≥, b√†i to√°n n√™n ƒë∆∞·ª£c xem l√† m·ªôt b√†i to√°n ph√¢n lo·∫°i, ch·ª© kh√¥ng ph·∫£i l√† b√†i to√°n h·ªìi quy. Ta kh√¥ng mu·ªën ph√°t hi·ªán ra ƒëi·ªÅu n√†y qu√° mu·ªôn sau khi ƒë√£ d√†nh nhi·ªÅu th√°ng ƒë·ªÉ x√¢y d·ª±ng m·ªôt h·ªá th·ªëng h·ªìi quy.

- May thay, sau khi n√≥i chuy·ªán v·ªõi nh√≥m ph·ª• tr√°ch h·ªá th·ªëng ti·∫øp theo, b·∫°n bi·∫øt ch·∫Øc r·∫±ng h·ªç th·ª±c s·ª± c·∫ßn gi√° nh√† ·ªü d·∫°ng s·ªë, thay v√¨ c√°c h·∫°ng m·ª•c. Tuy·ªát! B·∫°n ƒë√£ ƒë∆∞·ª£c b·∫≠t ƒë√®n xanh v√† c√≥ th·ªÉ b·∫Øt ƒë·∫ßu l·∫≠p tr√¨nh ngay b√¢y gi·ªù!

### T·∫£i d·ªØ li·ªáu

- Trong m√¥i tr∆∞·ªùng th√¥ng th∆∞·ªùng, d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ trong m·ªôt c∆° s·ªü d·ªØ li·ªáu quan h·ªá (ho·∫∑c c√°c kho ch·ª©a d·ªØ li·ªáu th√¥ng d·ª•ng kh√°c) v√† c√≥ th·ªÉ bao g·ªìm nhi·ªÅu b·∫£ng/t·∫≠p tin/t√†i li·ªáu. ƒê·ªÉ truy c·∫≠p c∆° s·ªü d·ªØ li·ªáu n√†y, ta c·∫ßn c√≥ ·ªßy nhi·ªám (credential) v√† quy·ªÅn truy c·∫≠p, r·ªìi l√†m quen v·ªõi ƒë·ªãnh d·∫°ng d·ªØ li·ªáu. Tuy nhi√™n, trong d·ª± √°n n√†y, m·ªçi th·ª© ƒë∆°n gi·∫£n h∆°n r·∫•t nhi·ªÅu: ta ch·ªâ c·∫ßn t·∫£i xu·ªëng m·ªôt t·∫≠p tin n√©n, `housing.tgz`, to√†n b·ªô d·ªØ li·ªáu n·∫±m trong t·∫≠p tin `housing.csv`, v·ªõi c√°c gi√° tr·ªã ƒë∆∞·ª£c ngƒÉn c√°ch b·ªüi d·∫•u ph·∫©y (comma-separated values hay CSV).

- B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng tr√¨nh duy·ªát web ƒë·ªÉ t·∫£i xu·ªëng t·∫≠p tin ƒë√≥, ch·∫°y l·ªánh sau tr√™n c·ª≠a s·ªï d√≤ng l·ªánh ƒë·ªÉ gi·∫£i n√©n ra t·∫≠p tin CSV:
```
tar xzf housing.tgz
```
-  Tuy nhi√™n, l·ª±a ch·ªçn ph·ªï bi·∫øn h∆°n l√† s·ª≠ d·ª•ng m·ªôt h√†m nh·ªè ƒë·ªÉ l√†m vi·ªác n√†y. Vi·ªác c√≥ m·ªôt h√†m t·∫£i d·ªØ li·ªáu v·ªÅ r·∫•t c√≥ l·ª£i, ƒë·∫∑c bi·ªát l√† khi d·ªØ li·ªáu thay ƒë·ªïi th∆∞·ªùng xuy√™n. Ta c√≥ th·ªÉ vi·∫øt m·ªôt ƒëo·∫°n m√£ ng·∫Øn d√πng h√†m n√†y ƒë·ªÉ l·∫•y d·ªØ li·ªáu m·ªõi nh·∫•t (ho·∫∑c c√≥ th·ªÉ t·∫°o m·ªôt t√°c v·ª• t·ª± ƒë·ªông l·∫•y d·ªØ li·ªáu sau m·ªôt kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh). Vi·ªác t·ª± ƒë·ªông h√≥a qu√° tr√¨nh l·∫•y d·ªØ li·ªáu c≈©ng c·∫ßn thi·∫øt n·∫øu ta c·∫ßn c√†i ƒë·∫∑t c√πng m·ªôt t·∫≠p d·ªØ li·ªáu tr√™n nhi·ªÅu m√°y. D∆∞·ªõi ƒë√¢y l√† h√†m ƒë·ªÉ l·∫•y d·ªØ li·ªáu:
  

```python
import os
import tarfile
import urllib.request

DOWNLOAD_ROOT = "https://raw.githubusercontent.com/mlbvn/handson-ml2-vn/main/"
HOUSING_PATH = os.path.join("datasets", "housing") # T·∫°o ƒë∆∞·ªùng d·∫´n datasets/housing
HOUSING_URL = DOWNLOAD_ROOT + "datasets/housing/housing.tgz"

def fetch_housing_data(housing_url=HOUSING_URL, housing_path=HOUSING_PATH):
    if not os.path.isdir(housing_path): # ki·ªÉm tra th∆∞ m·ª•c housing_path t·ªìn t·∫°i ch∆∞a
        os.makedirs(housing_path)
    tgz_path = os.path.join(housing_path, "housing.tgz")
    urllib.request.urlretrieve(housing_url, tgz_path) # t·∫£i file v√† l∆∞u v√†o tgz_path
    housing_tgz = tarfile.open(tgz_path) # m·ªü file
    housing_tgz.extractall(path=housing_path) # gi·∫£i n√©n
    housing_tgz.close() # ƒë√≥ng file

fetch_housing_data()
```
 
 - Vi·ªác g·ªçi h√†m `fetch_housing_data` s·∫Ω t·∫°o th∆∞ m·ª•c `datasets/housing` trong kh√¥ng gian l√†m vi·ªác hi·ªán t·∫°i, t·∫£i v·ªÅ t·∫≠p tin `housing.tgz`, v√† gi·∫£i n√©n t·∫≠p tin `housing.csv` ƒë·∫øn th∆∞ m·ª•c ƒë√≥.
 - Gi·ªù h√£y s·ª≠ d·ª•ng `pandas` ƒë·ªÉ n·∫°p d·ªØ li·ªáu. T∆∞∆°ng t·ª±, ta c≈©ng n√™n vi·∫øt m·ªôt h√†m nh·ªè ƒë·ªÉ l√†m ƒëi·ªÅu n√†y:

```python
import pandas as pd

def load_housing_data(housing_path=HOUSING_PATH):
    csv_path = os.path.join(housing_path, "housing.csv")
    return pd.read_csv(csv_path)
housing = load_housing_data()
print(housing.head())
``` 

- H√†m n√†y tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng DataFrame c·ªßa pandas ch·ª©a to√†n b·ªô d·ªØ li·ªáu.

### Nh√¨n qua c·∫•u tr√∫c d·ªØ li·ªáu

- H√£y c√πng nh√¨n qua nƒÉm h√†ng ƒë·∫ßu ti√™n c·ªßa d·ªØ li·ªáu:

![anh](./image/170.png)

- M·ªói h√†ng bi·ªÉu di·ªÖn m·ªôt qu√¢n, v√† c√≥ 10 thu·ªôc t√≠nh t·∫•t c·∫£ (·∫£nh tr√™n ch·ªâ hi·ªán 6 thu·ªôc t√≠nh): `longitude	latitude`, 	`housing_median_age`,	`total_rooms`,	`total_bedrooms`,	`population`,	`households`,	`median_income`, `median_house_value`,	`ocean_proximity`.
- Ph∆∞∆°ng th·ª©c `info()` r·∫•t h·ªØu d·ª•ng ƒë·ªÉ xem c√°c m√¥ t·∫£ ƒë∆°n gi·∫£n v·ªÅ d·ªØ li·ªáu, nh∆∞ t·ªïng s·ªë h√†ng, ki·ªÉu d·ªØ li·ªáu c·ªßa m·ªói thu·ªôc t√≠nh, s·ªë l∆∞·ª£ng gi√° tr·ªã kh√°c r·ªóng (xem ·∫£nh d∆∞·ªõi):

![anh](./image/171.png)

- T·∫≠p d·ªØ li·ªáu ch·ª©a t·ªïng c·ªông 20640 m·∫´u n√†y kh√° nh·ªè theo ti√™u chu·∫©n H·ªçc M√°y, nh∆∞ng l·∫°i ho√†n h·∫£o cho d·ª± √°n ƒë·∫ßu ti√™n. L∆∞u √Ω r·∫±ng thu·ªôc t√≠nh `total_bedrooms` ch·ªâ c√≥ 20433 gi√° tr·ªã kh√°c r·ªóng, ƒë·ªìng nghƒ©a l√† c√≥ 207 qu·∫≠n thi·∫øu ƒë·∫∑c tr∆∞ng v√† ta s·∫Ω ph·∫£i gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y.
- T·∫•t c·∫£ thu·ªôc t√≠nh l√† ki·ªÉu gi√° tr·ªã s·ªë, ngo·∫°i tr·ª´ thu·ªôc t√≠nh `ocean_proximity`. Ki·ªÉu d·ªØ li·ªáu c·ªßa thu·ªôc t√≠nh n√†y l√† `object`, t·ª©c n√≥ c√≥ th·ªÉ ch·ª©a b·∫•t k·ª≥ ƒë·ªëi t∆∞·ª£ng Python n√†o. Nh∆∞ng ta bi·∫øt ch·∫Øc r·∫±ng n√≥ s·∫Ω l√† m·ªôt thu·ªôc t√≠nh vƒÉn b·∫£n, v√¨ d·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ m·ªôt t·ªáp CSV. Khi nh√¨n v√†o nƒÉm h√†ng ƒë·∫ßu, ta th·∫•y c√°c gi√° tr·ªã trong c·ªôt `ocean_proximity` ƒë∆∞·ª£c l·∫∑p ƒëi l·∫∑p l·∫°i, ƒë·ªìng nghƒ©a v·ªõi vi·ªác n√≥ c√≥ th·ªÉ l√† m·ªôt thu·ªôc t√≠nh h·∫°ng m·ª•c. Ta c√≥ th·ªÉ bi·∫øt t·∫•t c·∫£ c√°c h·∫°ng m·ª•c c≈©ng nh∆∞ s·ªë qu·∫≠n thu·ªôc m·ªói h·∫°ng m·ª•c b·∫±ng c√°ch d√πng h√†m `value_counts()`:

![anh](./image/172.png)

- H√£y x√©t th·ª≠ c√°c thu·ªôc t√≠nh kh√°c. H√†m `describe()` cho bi·∫øt th√¥ng tin t·ªïng quan c·ªßa c√°c thu·ªôc t√≠nh s·ªë:

![anh](./image/173.png)

- √ù nghƒ©a c·ªßa c√°c h√†ng `count`, `mean`, `min`, v√† `max` kh√° l√† r√µ r√†ng. L∆∞u √Ω r·∫±ng c√°c gi√° tr·ªã r·ªóng ƒë∆∞·ª£c b·ªè qua (v√≠ d·ª•, ta th·∫•y gi√° tr·ªã `count` c·ªßa `total_bedrooms` l√† 20,433 thay v√¨ 20,640). D√≤ng `std` cho bi·∫øt ƒë·ªô l·ªách chu·∫©n, m·ªôt ph√©p ƒëo ƒë·ªô ph√¢n t√°n c·ªßa gi√° tr·ªã.12 C√°c h√†ng 25%, 50%, v√† 75% cho bi·∫øt c√°c b√°ch ph√¢n v·ªã (`percentile`): t∆∞∆°ng t·ª± v·ªõi ph·∫ßn trƒÉm s·ªë li·ªáu c√≥ gi√° tr·ªã th·∫•p ho·∫∑c cao h∆°n m·ªôt m·ª©c ng∆∞·ª°ng cho tr∆∞·ªõc. V√≠ d·ª•, `housing_median_age` c·ªßa 25% c√°c qu·∫≠n th·∫•p h∆°n 18, trong khi ƒë√≥ 50% v√† 75% c√°c qu·∫≠n c√≥ `housing_median_age` l·∫ßn l∆∞·ª£t th·∫•p h∆°n 29 v√† 37. Ch√∫ng th∆∞·ªùng ƒë∆∞·ª£c g·ªçi l√† b√°ch ph√¢n v·ªã th·ª© 25 (hay t·ª© ph√¢n v·ªã ‚Äì `quartile` th·ª© nh·∫•t), trung v·ªã, v√† b√°ch ph√¢n v·ªã th·ª© 75 (hay t·ª© ph√¢n v·ªã th·ª© ba).

- Ngo√†i ra, ta c√≥ th·ªÉ v·∫Ω bi·ªÉu ƒë·ªì t·∫ßn su·∫•t cho m·ªói thu·ªôc t√≠nh s·ªë ƒë·ªÉ nhanh ch√≥ng bi·∫øt ƒë∆∞·ª£c d·∫°ng d·ªØ li·ªáu ƒëang x·ª≠ l√Ω. Bi·ªÉu ƒë·ªì t·∫ßn su·∫•t cho bi·∫øt s·ªë m·∫´u (tr√™n tr·ª•c tung) n·∫±m trong m·ªôt kho·∫£ng gi√° tr·ªã nh·∫•t ƒë·ªãnh (tr√™n tr·ª•c ho√†nh). Ta c√≥ th·ªÉ v·∫Ω bi·ªÉu ƒë·ªì t·∫ßn su·∫•t theo t·ª´ng thu·ªôc t√≠nh m·ªôt, ho·∫∑c s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c *hist()* tr√™n to√†n b·ªô t·∫≠p d·ªØ li·ªáu (nh∆∞ trong ƒëo·∫°n m√£ b√™n d∆∞·ªõi) ƒë·ªÉ v·∫Ω bi·ªÉu ƒë·ªì t·∫ßn su·∫•t cho m·ªói thu·ªôc t√≠nh s·ªë (xem H√¨nh 2.8):

```python
import matplotlib.pyplot as plt
housing.hist(bins=50, figsize=(20,15))
plt.show()
```
![anh](./image/174.png)

- Ta c√≥ th·ªÉ nh·∫≠n th·∫•y m·ªôt v√†i ƒëi·ªÅu t·ª´ c√°c bi·ªÉu ƒë·ªì n√†y:
1. ƒê·∫ßu ti√™n, d∆∞·ªùng nh∆∞ thu·ªôc t√≠nh thu nh·∫≠p trung v·ªã kh√¥ng ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng ƒë∆°n v·ªã ƒë√¥-la M·ªπ (USD). Sau khi h·ªèi l·∫°i nh√≥m thu th·∫≠p d·ªØ li·ªáu, h·ªç th√¥ng b√°o r·∫±ng d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c co gi·∫£n xu·ªëng v·ªõi m·ª©c tr·∫ßn t·∫°i 15 (ch√≠nh x√°c l√† 15.0001) ƒë·ªëi v·ªõi c√°c thu nh·∫≠p trung v·ªã cao h∆°n, v√† m·ª©c s√†n t·∫°i 0.5 (ch√≠nh x√°c l√† 0.4999) ƒë·ªëi v·ªõi c√°c thu nh·∫≠p trung v·ªã th·∫•p h∆°n. C√°c con s·ªë ƒë∆∞·ª£c t√≠nh theo m∆∞·ªùi ng√†n ƒë√¥-la (v√≠ d·ª•, 3 th·ª±c t·∫ø c√≥ nghƒ©a l√† kho·∫£ng 30,000 ƒë√¥-la). L√†m vi·ªác v·ªõi c√°c thu·ªôc t√≠nh ƒë√£ ƒë∆∞·ª£c ti·ªÅn x·ª≠ l√Ω l√† vi·ªác kh√° ph·ªï bi·∫øn trong H·ªçc M√°y. M·∫∑c d√π ƒë√¢y kh√¥ng h·∫≥n l√† v·∫•n ƒë·ªÅ, nh∆∞ng b·∫°n n√™n hi·ªÉu c√°ch m√† d·ªØ li·ªáu ƒë∆∞·ª£c x·ª≠ l√Ω.
2. Tu·ªïi ƒë·ªùi trung v·ªã v√† gi√° tr·ªã trung v·ªã c·ªßa ng√¥i nh√† c≈©ng ƒë∆∞·ª£c gi·ªõi h·∫°n. Vi·ªác gi·ªõi h·∫°n gi√° tr·ªã trung v·ªã c·ªßa ng√¥i nh√† c√≥ th·ªÉ l√† v·∫•n ƒë·ªÅ nghi√™m tr·ªçng v√¨ ƒë√¢y l√† thu·ªôc t√≠nh m·ª•c ti√™u c·ªßa b·∫°n (nh√£n mu·ªën d·ª± ƒëo√°n). Thu·∫≠t to√°n H·ªçc M√°y c√≥ th·ªÉ s·∫Ω h·ªçc ƒë∆∞·ª£c r·∫±ng gi√° c·∫£ s·∫Ω kh√¥ng bao gi·ªù v∆∞·ª£t qu√° m·ªôt gi·ªõi h·∫°n nh·∫•t ƒë·ªãnh. B·∫°n c·∫ßn ph·∫£i ki·ªÉm tra v·ªõi kh√°ch h√†ng (nh·ªØng ng∆∞·ªùi s·∫Ω s·ª≠ d·ª•ng h·ªá th·ªëng ƒë·ªÉ d·ª± ƒëo√°n) ƒë·ªÉ xem li·ªáu ƒë√¢y c√≥ ph·∫£i l√† m·ªôt v·∫•n ƒë·ªÅ kh√¥ng. N·∫øu kh√°ch h√†ng n√≥i h·ªç c·∫ßn c·∫£ nh·ªØng d·ª± ƒëo√°n ch√≠nh x√°c n·∫±m ngo√†i kho·∫£ng 500,000 USD, th√¨ b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng hai c√°ch sau:

   - Thu th·∫≠p nh√£n th√≠ch h·ª£p cho c√°c qu·∫≠n c√≥ nh√£n b·ªã gi·ªõi h·∫°n.
   - Lo·∫°i b·ªè c√°c qu·∫≠n ƒë√≥ ra kh·ªèi t·∫≠p hu·∫•n luy·ªán (c≈©ng nh∆∞ t·∫≠p ki·ªÉm tra v√¨ h·ªá th·ªëng c·ªßa b·∫°n kh√¥ng n√™n b·ªã ƒë√°nh gi√° t·ªá m·ªói khi n√≥ d·ª± ƒëo√°n gi√° tr·ªã tr√™n ng∆∞·ª°ng 500,000 USD).

3. C√°c thu·ªôc t√≠nh n√†y c√≥ c√°c kho·∫£ng gi√° tr·ªã r·∫•t kh√°c nhau. Ta s·∫Ω b√†n lu·∫≠n v·ªÅ ƒëi·ªÅu n√†y ·ªü blog kh√°c v·ªÅ co gi√£n ƒë·∫∑c tr∆∞ng.

4. Cu·ªëi c√πng, nhi·ªÅu bi·ªÉu ƒë·ªì t·∫ßn su·∫•t n·∫∑ng ƒëu√¥i (`tail-heavy`): bi·ªÉu ƒë·ªì tr·∫£i d√†i v·ªÅ b√™n ph·∫£i trung v·ªã h∆°n b√™n tr√°i. ƒêi·ªÅu n√†y s·∫Ω khi·∫øn vi·ªác ph√°t hi·ªán khu√¥n m·∫´u trong m·ªôt s·ªë thu·∫≠t to√°n H·ªçc M√°y g·∫∑p ƒë√¥i ch√∫t kh√≥ khƒÉn. V·ªÅ sau, ta s·∫Ω th·ª≠ bi·∫øn ƒë·ªïi ph√¢n ph·ªëi c·ªßa c√°c thu·ªôc t√≠nh n√†y v·ªÅ d·∫°ng gi·ªëng h√¨nh chu√¥ng h∆°n.

- Hy v·ªçng r·∫±ng b√¢y gi·ªù b·∫°n ƒë√£ hi·ªÉu h∆°n v·ªÅ d·∫°ng d·ªØ li·ªáu m√† m√¨nh ƒëang x·ª≠ l√Ω.

> üìù **Note:** Ch·ªù ƒë√£! Tr∆∞·ªõc khi xem x√©t th√™m v·ªÅ d·ªØ li·ªáu, b·∫°n c·∫ßn t·∫°o m·ªôt t·∫≠p d·ªØ li·ªáu ki·ªÉm tra, b·ªè n√≥ qua m·ªôt b√™n, v√† kh√¥ng bao gi·ªù ƒë·ªông t·ªõi n√≥.

### T·∫°o t·∫≠p ki·ªÉm tra

- Nghe c√≥ v·∫ª k·ª≥ qu·∫∑c n·∫øu b√¢y gi·ªù ta t·∫°m th·ªùi ƒë·ªÉ m·ªôt ph·∫ßn d·ªØ li·ªáu sang m·ªôt b√™n. Cho t·ªõi hi·ªán t·∫°i, ta ch·ªâ m·ªõi nh√¨n qua d·ªØ li·ªáu, v√† ch·∫Øc ch·∫Øn r·∫±ng ta c·∫ßn t√¨m hi·ªÉu th√™m v·ªÅ d·ªØ li·ªáu tr∆∞·ªõc khi quy·∫øt ƒë·ªãnh s·∫Ω s·ª≠ d·ª•ng thu·∫≠t to√°n n√†o. Tuy v·∫≠y, b·ªô n√£o c·ªßa ch√∫ng ta l√† m·ªôt h·ªá th·ªëng ph√°t hi·ªán khu√¥n m·∫´u tuy·ªát v·ªùi, c≈©ng c√≥ nghƒ©a l√† n√≥ r·∫•t d·ªÖ qu√° kh·ªõp tr√™n t·∫≠p d·ªØ li·ªáu ƒë∆∞·ª£c quan s√°t: n·∫øu nh√¨n v√†o t·∫≠p ki·ªÉm tra, ta c√≥ th·ªÉ g·∫∑p m·ªôt v√†i khu√¥n m·∫´u th√∫ v·ªã trong t·∫≠p ki·ªÉm tra, ƒëi·ªÅu n√†y khi·∫øn ta c√≥ thi√™n ki·∫øn l·ª±a ch·ªçn m·ªôt d·∫°ng m√¥ h√¨nh H·ªçc M√°y c·ª• th·ªÉ. Khi ƒë√°nh gi√° sai s·ªë kh√°i qu√°t tr√™n t·∫≠p ki·ªÉm tra, k·∫øt qu·∫£ s·∫Ω qu√° t·ªët. Do ƒë√≥, ta s·∫Ω ƒë∆∞a v√†o tri·ªÉn khai m·ªôt h·ªá th·ªëng ho·∫°t ƒë·ªông t·ªá h∆°n mong ƒë·ª£i. ƒê√¢y ƒë∆∞·ª£c g·ªçi l√† **thi√™n ki·∫øn d√≤m ng√≥ d·ªØ li·ªáu** (`data-snooping`).

- V·ªÅ l√Ω thuy·∫øt, vi·ªác t·∫°o m·ªôt t·∫≠p ki·ªÉm tra kh√° ƒë∆°n gi·∫£n: ch·ªçn ng·∫´u nhi√™n m·ªôt v√†i m·∫´u, th∆∞·ªùng l√† 20% t·∫≠p d·ªØ li·ªáu (ho·∫∑c √≠t h∆°n n·∫øu t·∫≠p d·ªØ li·ªáu c√≥ k√≠ch th∆∞·ªõc r·∫•t l·ªõn), v√† ƒë·ªÉ ch√∫ng sang m·ªôt b√™n:

```python
import numpy as np

def split_train_test(data, test_ratio):
  shuffled_data = np.random.permutation(len(data))
  test_set_size = int(len(data) * test_ratio)
  test_idx = shuffled_data[:test_set_size]
  train_idx = shuffled_data[test_set_size:]
  return data.iloc[train_idx], data.iloc[test_idx]

train_set, test_set = split_train_test(housing, 0.2)
```

- C√°ch n√†y ·ªïn, nh∆∞ng kh√¥ng ho√†n h·∫£o: n·∫øu ta ch·∫°y l·∫°i ch∆∞∆°ng tr√¨nh, n√≥ s·∫Ω sinh ra m·ªôt t·∫≠p ki·ªÉm tra kh√°c! D·∫ßn d·∫ßn, b·∫°n (ho·∫∑c thu·∫≠t to√°n H·ªçc M√°y) s·∫Ω th·∫•y ƒë∆∞·ª£c to√†n b·ªô t·∫≠p d·ªØ li·ªáu, v√† ta kh√¥ng mu·ªën ƒëi·ªÅu n√†y x·∫£y ra.
- M·ªôt gi·∫£i ph√°p l√† l∆∞u l·∫°i t·∫≠p ki·ªÉm tra trong l·∫ßn ch·∫°y ƒë·∫ßu ti√™n v√† n·∫°p n√≥ trong c√°c l·∫ßn ch·∫°y ti·∫øp theo. M·ªôt l·ª±a ch·ªçn kh√°c l√† ƒë·∫∑t `seed` cho b·ªô sinh s·ªë ng·∫´u nhi√™n (v√≠ d·ª•, v·ªõi `np.random.seed(42)`) tr∆∞·ªõc khi h·ªçi h√†m `np.random.permutation()` ƒë·ªÉ n√≥ lu√¥n sinh ra c√πng m·ªôt c√°ch ho√°n ƒë·ªïi.
-  Tuy nhi√™n c·∫£ hai c√°ch tr√™n s·∫Ω kh√¥ng ho·∫°t ƒë·ªông trong tr∆∞·ªùng h·ª£p t·∫≠p d·ªØ li·ªáu ƒë∆∞·ª£c c·∫≠p nh·∫≠t. ƒê·ªÉ c√≥ m·ªôt c√°ch chia ·ªïn ƒë·ªãnh ngay c·∫£ trong tr∆∞·ªùng h·ª£p n√†y, m·ªôt gi·∫£i ph√°p th√¥ng d·ª•ng l√† s·ª≠ d·ª•ng ID c·ªßa m·ªói m·∫´u ƒë·ªÉ quy·∫øt ƒë·ªãnh xem li·ªáu n√≥ c√≥ thu·ªôc d·ªØ li·ªáu ki·ªÉm tra hay kh√¥ng (gi·∫£ s·ª≠ c√°c m·∫´u c√≥ m·ªôt ID duy nh·∫•t v√† b·∫•t bi·∫øn). V√≠ d·ª•, b·∫°n c√≥ th·ªÉ t√≠nh to√°n hash c·ªßa ID m·ªói m·∫´u v√† ƒë∆∞a m·∫´u ƒë√≥ v√†o t·∫≠p ki·ªÉm tra n·∫øu hash th·∫•p h∆°n ho·∫∑c b·∫±ng 20% gi√° tr·ªã hash l·ªõn nh·∫•t. Vi·ªác n√†y s·∫Ω ƒë·∫£m b·∫£o r·∫±ng t·∫≠p ki·ªÉm tra trong c√°c l·∫ßn ch·∫°y lu√¥n ƒë·ªìng nh·∫•t, k·ªÉ c·∫£ khi b·∫°n c·∫≠p nh·∫≠t t·∫≠p d·ªØ li·ªáu. T·∫≠p ki·ªÉm tra m·ªõi s·∫Ω ch·ª©a 20% m·∫´u m·ªõi, nh∆∞ng n√≥ s·∫Ω kh√¥ng ch·ª©a b·∫•t k·ª≥ m·∫´u n√†o tr∆∞·ªõc ƒë√≥ thu·ªôc v·ªÅ t·∫≠p hu·∫•n luy·ªán.
-  D∆∞·ªõi ƒë√¢y l√† m·ªôt c√°ch l·∫≠p tr√¨nh kh·∫£ thi:

```python
from zlib import crc32

def test_set_check(identifier, test_ratio):
    return crc32(np.int64(identifier)) & 0xffffffff < test_ratio * 2**32

def split_train_test_by_id(data, test_ratio, id_column):
    ids = data[id_column]
    in_test_set = ids.apply(lambda id_: test_set_check(id_, test_ratio))
    return data.loc[~in_test_set], data.loc[in_test_set]

```

- Kh√¥ng may, t·∫≠p d·ªØ li·ªáu nh√† ·ªü kh√¥ng c√≥ c·ªôt ID. C√°ch ƒë∆°n gi·∫£n nh·∫•t l√† s·ª≠ d·ª•ng ch·ªâ s·ªë h√†ng l√†m ID:

```python
housing_with_id = housing.reset_index() # adds an `index` column
train_set, test_set = split_train_test_by_id(housing_with_id, 0.2, "index")
```

- N·∫øu s·ª≠ d·ª•ng ch·ªâ s·ªë h√†ng l√†m ID duy nh·∫•t, ta c·∫ßn ƒë·∫£m b·∫£o r·∫±ng d·ªØ li·ªáu m·ªõi ƒë∆∞·ª£c n·ªëi v√†o c≈© t·∫≠p d·ªØ li·ªáu v√† kh√¥ng h√†ng n√†o b·ªã x√≥a sau n√†y. N·∫øu c√°ch n√†y kh√¥ng kh·∫£ thi, ta c√≥ th·ªÉ th·ª≠ s·ª≠ d·ª•ng ƒë·∫∑c tr∆∞ng ·ªïn ƒë·ªãnh nh·∫•t ƒë·ªÉ t·∫°o ID ƒë·ªôc nh·∫•t. V√≠ d·ª•, kinh ƒë·ªô v√† vƒ© ƒë·ªô c·ªßa m·ªôt quan ƒëi·ªÉm ƒë·∫£m b·∫£o ·ªïn ƒë·ªãnh ƒë·∫øn v√†i tri·ªáu nƒÉm, n√™n ta c√≥ th·ªÉ k·∫øt h·ª£p ch√∫ng l·∫°i th√†nh m·ªôt ID:

```python
housing_with_id["id"] = housing["longitude"] * 1000 + housing["latitude"]
train_set, test_set = split_train_test_by_id(housing_with_id, 0.2, "id")

```

- Scikit-Learn cung c·∫•p m·ªôt v√†i h√†m ƒë·ªÉ chia m·ªôt t·∫≠p d·ªØ li·ªáu th√†nh c√°c t·∫≠p d·ªØ li·ªáu con theo nhi·ªÅu c√°ch. H√†m ƒë∆°n gi·∫£n nh·∫•t l√† train_test_split, ho·∫°t ƒë·ªông gi·ªëng v·ªõi h√†m split_train_test() v·ªõi m·ªôt v√†i ch·ª©c nƒÉng b·ªï sung. ƒê·∫ßu ti√™n l√† tham s·ªë random_state cho ph√©p ta ƒë·∫∑t seed cho b·ªô sinh s·ªë ng·∫´u nhi√™n. Th·ª© hai, ta c√≥ th·ªÉ truy·ªÅn v√†o nhi·ªÅu t·∫≠p d·ªØ li·ªáu c√≥ c√πng s·ªë h√†ng, v√† h√†m n√†y s·∫Ω chia c√°c t·∫≠p d·ªØ li·ªáu theo c√πng m·ªôt c√°ch (ƒëi·ªÅu n√†y r·∫•t h·ªØu √≠ch, v√≠ d·ª• nh∆∞ khi b·∫°n c√≥ m·ªôt DataFrame ri√™ng cho nh√£n):

```python
from sklearn.model_selection import train_test_split
train_set, test_set = train_test_split(housing, test_size =  0.2, random_state = 42)
```

- Cho t·ªõi hi·ªán t·∫°i, ta m·ªõi ch·ªâ ƒë∆°n thu·∫ßn xem x√©t c√°c ph∆∞∆°ng ph√°p l·∫•y m·∫´u ng·∫´u nhi√™n. Nh√¨n chung, c√°c ph∆∞∆°ng ph√°p n√†y ho·∫°t ƒë·ªông ·ªïn n·∫øu t·∫≠p d·ªØ li·ªáu ƒë·ªß l·ªõn (ƒë·∫∑c bi·ªát l√† so v·ªõi s·ªë l∆∞·ª£ng thu·ªôc t√≠nh), nh∆∞ng n·∫øu kh√¥ng, ta s·∫Ω ƒë·ªëi m·∫∑t v·ªõi r·ªßi ro ƒë√°ng k·ªÉ v·ªÅ `thi√™n ki·∫øn l·∫•y m·∫´u`. Khi m·ªôt c√¥ng ty l√†m kh·∫£o s√°t tr√™n 1,000 ng∆∞·ªùi, h·ªç kh√¥ng ch·ªâ l·∫•y ng·∫´u nhi√™n 1,000 ng∆∞·ªùi trong danh b·∫°. H·ªç c·ªë g·∫Øng ƒë·∫£m b·∫£o 1,000 ng∆∞·ªùi n√†y ƒë·∫°i di·ªán cho to√†n b·ªô d√¢n s·ªë. V√≠ d·ª•, d√¢n s·ªë n∆∞·ªõc M·ªπ c√≥ 51.3% n·ªØ v√† 48.7% nam, n√™n m·ªôt cu·ªôc kh·∫£o s√°t t·ªët ·ªü M·ªπ s·∫Ω c·ªë g·∫Øng duy tr√¨ t·ª∑ l·ªá n√†y khi l·∫•y m·∫´u: 513 n·ªØ v√† 487 nam. C√°ch l·∫•y m·∫´u n√†y ƒë∆∞·ª£c g·ªçi l√† l·∫•y m·∫´u ph√¢n t·∫ßng (`stratified sampling`): to√†n b·ªô t·ªïng th·ªÉ ƒë∆∞·ª£c chia th√†nh c√°c nh√≥m con ƒë·ªìng nh·∫•t g·ªçi l√† `stratum`, v√† m·ªôt s·ªë l∆∞·ª£ng m·∫´u x√°c ƒë·ªãnh ƒë∆∞·ª£c l·∫•y t·ª´ m·ªói `stratum` ƒë·ªÉ ƒë·∫£m b·∫£o t·∫≠p d·ªØ li·ªáu ki·ªÉm tra c√≥ t√≠nh ƒë·∫°i di·ªán cho to√†n b·ªô t·ªïng th·ªÉ. N·∫øu ng∆∞·ªùi l√†m kh·∫£o s√°t ch·ªâ ƒë∆°n thu·∫ßn l·∫•y m·∫´u ng·∫´u nhi√™n, s·∫Ω c√≥ 12% kh·∫£ nƒÉng ph√¢n ph·ªëi c·ªßa t·∫≠p d·ªØ li·ªáu ki·ªÉm tra b·ªã l·ªách, t·ª©c ho·∫∑c √≠t h∆°n 49% nam ho·∫∑c nhi·ªÅu h∆°n 54% n·ªØ. D√π l√† tr∆∞·ªùng h·ª£p n√†o, k·∫øt qu·∫£ kh·∫£o s√°t s·∫Ω b·ªã thi√™n ki·∫øn ƒë√°ng k·ªÉ.
- Gi·∫£ s·ª≠ sau khi th·∫£o lu·∫≠n v·ªõi chuy√™n gia, ta bi·∫øt r·∫±ng thu nh·∫≠p trung v·ªã l√† m·ªôt thu·ªôc t√≠nh r·∫•t quan tr·ªçng ƒë·ªÉ d·ª± ƒëo√°n gi√° nh√† trung v·ªã. Ta c·∫ßn ƒë·∫£m b·∫£o r·∫±ng t·∫≠p ki·ªÉm tra mang t√≠nh ƒë·∫°i di·ªán cho t·∫•t c·∫£ c√°c m·ª©c thu nh·∫≠p trong to√†n b·ªô t·∫≠p d·ªØ li·ªáu. V√¨ thu nh·∫≠p trung v·ªã l√† m·ªôt thu·ªôc t√≠nh li√™n t·ª•c, ƒë·∫ßu ti√™n ta c·∫ßn t·∫°o thu·ªôc t√≠nh h·∫°ng ƒë·ªÉ bi·ªÉu di·ªÖn c√°c m·ª©c thu nh·∫≠p kh√°c nhau. H√£y quan s√°t bi·ªÉu ƒë·ªì t·∫ßn su·∫•t k·ª≥ v·ªçng (trong H√¨nh 2.8): ph·∫ßn l·ªõn c√°c gi√° tr·ªã thu nh·∫≠p trung v·ªã ƒë∆∞·ª£c ph√¢n b·ªë trong kho·∫£ng t·ª´ 1.5 ƒë·∫øn 6 (t·ª©c 15,000 USD - 60,000 USD), nh∆∞ng c√≥ v√†i gi√° tr·ªã v∆∞·ª£t qu√° 6. Vi·ªác c√≥ ƒë·ªß m·∫´u trong t·∫≠p d·ªØ li·ªáu cho m·ªói stratum l√† r·∫•t quan tr·ªçng. N·∫øu kh√¥ng, vi·ªác ∆∞·ªõc l∆∞·ª£ng ƒë·ªô quan tr·ªçng c·ªßa m·ªôt stratum s·∫Ω b·ªã thi√™n ki·∫øn. Nghƒ©a l√†, kh√¥ng n√™n c√≥ qu√° nhi·ªÅu stratum, v√† m·ªói stratum n√™n ƒë·ªß l·ªõn. ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y s·ª≠ d·ª•ng h√†m pd.cut() ƒë·ªÉ t·∫°o thu·ªôc t√≠nh m·ª©c thu nh·∫≠p theo nƒÉm m·ª©c (g√°n nh√£n t·ª´ 1 ƒë·∫øn 5): m·ª©c 1 t·ª´ 0 ƒë·∫øn 1.5 (t·ª©c d∆∞·ªõi 15,000 USD), m·ª©c 2 t·ª´ 1.5 ƒë·∫øn 3, v.v.

```python
housing["income_cat"] = pd.cut(housing["median_income"],
                               bins=[0., 1.5, 3.0, 4.5, 6., np.inf],
                               labels=[1, 2, 3, 4, 5])
housing["income_cat"].hist()
```

![anh](./image/175.png)

- B√¢y gi·ªù, ta ƒë√£ s·∫µn s√†ng l·∫•y m·∫´u `stratified` d·ª±a tr√™n c√°c m·ª©c thu nh·∫≠p. ƒê·ªÉ th·ª±c hi·ªán vi·ªác n√†y, ta c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªõp `StratifiedShuffleSplit` c·ªßa Scikit-learn:

```python
from sklearn.model_selection import StratifiedShuffleSplit

split = StratifiedShuffleSplit(n_splits=1, test_size=0.2, random_state=42) # n_splits l√† s·ªë l·∫ßn tr·ªôn
for train_index, test_index in split.split(housing, housing["income_cat"]):
    strat_train_set = housing.loc[train_index]
    strat_test_set = housing.loc[test_index]
```

- H√£y ki·ªÉm tra xem ƒëo·∫°n m√£ c√≥ ho·∫°t ƒë·ªông ƒë√∫ng kh√¥ng, b·∫Øt ƒë·∫ßu b·∫±ng vi·ªác quan s√°t t·ª∑ l·ªá ph·∫ßn trƒÉm c√°c m·ª©c thu nh·∫≠p trong t·∫≠p ki·ªÉm tra:

```python
strat_test_set["income_cat"].value_counts() / len(strat_test_set)
```

![anh](./image/176.png)

- T∆∞∆°ng t·ª±, ta c√≥ th·ªÉ ƒëo l∆∞·ªùng t·ª∑ l·ªá ph·∫ßn trƒÉm c·ªßa c√°c m·ª©c thu nh·∫≠p trong to√†n b·ªô t·∫≠p d·ªØ li·ªáu. H√¨nh 2.10 so s√°nh t·ª∑ l·ªá ph·∫ßn trƒÉm c·ªßa c√°c m·ª©c thu nh·∫≠p trong to√†n b·ªô d·ªØ li·ªáu v√† trong t·∫≠p d·ªØ li·ªáu ki·ªÉm tra ƒë∆∞·ª£c t·∫°o ra b·ªüi l·∫•y m·∫´u `stratified` v√† l·∫•y m·∫´u ng·∫´u nhi√™n. C√≥ th·ªÉ th·∫•y, l·∫•y m·∫´u `stratified` t·∫°o ra t·∫≠p d·ªØ li·ªáu ki·ªÉm tra c√≥ t·ª∑ l·ªá c√°c m·ª©c thu nh·∫≠p kh√° gi·ªëng v·ªõi t·ª∑ l·ªá trong t·∫≠p d·ªØ li·ªáu g·ªëc, trong khi ph√¢n ph·ªëi c·ªßa t·∫≠p d·ªØ li·ªáu l·∫•y m·∫´u ng·∫´u nhi√™n b·ªã l·ªách:

```python
def income_cat_proportions(data):
    return data["income_cat"].value_counts() / len(data)

train_set, test_set = train_test_split(housing, test_size=0.2, random_state=42)

compare_props = pd.DataFrame({
    "Overall": income_cat_proportions(housing),
    "Stratified": income_cat_proportions(strat_test_set),
    "Random": income_cat_proportions(test_set),
}).sort_index()
compare_props["Rand. %error"] = 100 * compare_props["Random"] / compare_props["Overall"] - 100
compare_props["Strat. %error"] = 100 * compare_props["Stratified"] / compare_props["Overall"] - 100
```

![anh](./image/177.png)

- Gi·ªù ta c√≥ th·ªÉ lo·∫°i b·ªè thu·ªôc t√≠nh income_cat ƒë·ªÉ d·ªØ li·ªáu tr·ªü v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu:

```python
for set_ in (strat_train_set, strat_test_set):
    set_.drop("income_cat", axis=1, inplace=True)
```

- Vi·ªác ta d√†nh kh√° nhi·ªÅu th·ªùi gian ƒë·ªÉ sinh t·∫≠p d·ªØ li·ªáu ki·ªÉm tra l√† c√≥ l√Ω do: ƒëi·ªÅu n√†y th∆∞·ªùng b·ªã b·ªè qua nh∆∞ng l·∫°i l√† ph·∫ßn c·ª±c k·ª≥ quan tr·ªçng trong m·ªôt d·ª± √°n H·ªçc M√°y. H∆°n n·ªØa, nhi·ªÅu √Ω t∆∞·ªüng tr√¨nh b√†y ·ªü tr√™n s·∫Ω h·ªØu √≠ch khi th·∫£o lu·∫≠n v·ªÅ  `ki·ªÉm ƒë·ªãnh ch√©o` (`cross-validation`). Gi·ªù l√† l√∫c chuy·ªÉn sang b∆∞·ªõc ti·∫øp theo: kh√°m ph√° d·ªØ li·ªáu


## 3. Kh√°m ph√° v√† tr·ª±c quan h√≥a ƒë·ªÉ hi·ªÉu d·ªØ li·ªáu

- Cho t·ªõi nay ta m·ªõi ch·ªâ nh√¨n l∆∞·ªõt qua d·ªØ li·ªáu ƒë·ªÉ n·∫Øm ƒë∆∞·ª£c c√°c ƒë·∫∑c ƒëi·ªÉm chung c·ªßa ch√∫ng. B√¢y gi·ªù m·ª•c ti√™u c·ªßa ta l√† ƒëi s√¢u h∆°n m·ªôt ch√∫t.

- ƒê·∫ßu ti√™n, h√£y ƒë·∫£m b·∫£o r·∫±ng ta kh√¥ng ƒë·ªông v√†o t·∫≠p ki·ªÉm tra v√† ch·ªâ s·ª≠ d·ª•ng t·∫≠p hu·∫•n luy·ªán. Ngo√†i ra, n·∫øu t·∫≠p hu·∫•n luy·ªán r·∫•t l·ªõn, ta c√≥ th·ªÉ ch·ªâ l·∫•y ra m·ªôt t·∫≠p nh·ªè ƒë·ªÉ vi·ªác thao t√°c d·ªÖ v√† nhanh h∆°n. Trong tr∆∞·ªùng h·ª£p n√†y, t·∫≠p hu·∫•n luy·ªán t∆∞∆°ng ƒë·ªëi nh·ªè, n√™n ta c√≥ th·ªÉ l√†m vi·ªác tr·ª±c ti·∫øp tr√™n to√†n b·ªô t·∫≠p. H√£y t·∫°o m·ªôt b·∫£n sao ƒë·ªÉ y√™n t√¢m r·∫±ng ta kh√¥ng l√†m ·∫£nh h∆∞·ªüng ƒë·∫øn t·∫≠p hu·∫•n luy·ªán g·ªëc:

```python
housing = strat_train_set.copy()
```

### Tr·ª±c quan h√≥a D·ªØ li·ªáu ƒê·ªãa l√Ω

- V√¨ d·ªØ li·ªáu c√≥ c√°c th√¥ng tin v·ªÅ ƒë·ªãa l√Ω (kinh ƒë·ªô v√† vƒ© ƒë·ªô), ta n√™n t·∫°o m·ªôt bi·ªÉu ƒë·ªì ph√¢n t√°n (`scatterplot`) c·ªßa t·∫•t c·∫£ c√°c quan s√°t ƒë·ªÉ tr·ª±c quan h√≥a d·ªØ li·ªáu (H√¨nh 2.11):

```python
housing.plot(kind="scatter", x="longitude", y="latitude")
```

![anh](./image/178.png)

- Bi·ªÉu ƒë·ªì n√†y nh√¨n kh√° gi·ªëng h√¨nh d√°ng bang California, nh∆∞ng ngo√†i ƒëi·ªÅu ƒë√≥ ra th√¨ r·∫•t kh√≥ ƒë·ªÉ th·∫•y ƒë∆∞·ª£c khu√¥n m·∫´u c·ª• th·ªÉ n√†o. Vi·ªác ƒë·∫∑t alpha b·∫±ng 0.1 s·∫Ω gi√∫p minh h·ªça t·ªët h∆°n c√°c v√πng c√≥ m·∫≠t ƒë·ªô ƒëi·ªÉm d·ªØ li·ªáu l·ªõn (H√¨nh 2.12):

```python
housing.plot(kind="scatter", x="longitude", y="latitude", alpha=0.1)
```

![anh](./image/179.png)


- L√∫c n√†y ta ƒë√£ c√≥ th·ªÉ th·∫•y r√µ c√°c khu v·ª±c ƒë√¥ng d√¢n, c·ªß th·ªÉ l√† Bay Area, xung quanh Los Angeles v√† San Diego, c·ªông v·ªõi m·ªôt d·∫£i d√†i ƒë√¥ng ƒë√∫c ·ªü Central Valley, ƒë·∫∑c bi·ªát l√† quanh Sacramento v√† Fresno.

- Gi·ªù h√£y nh√¨n v√†o gi√° nh√† (H√¨nh 2.13). B√°n k√≠nh m·ªói v√≤ng tr√≤n ƒë·∫°i di·ªán cho d√¢n s·ªë c·ªßa qu·∫≠n (ƒë·ªëi s·ªë `s`), v√† m√†u s·∫Øc ƒë·∫°i di·ªán cho m·ª©c gi√° (ƒë·ªëi s·ªë  `c`). Ta s·∫Ω s·ª≠ d·ª•ng m·ªôt b·∫£ng m√†u ƒë·ªãnh nghƒ©a s·∫µn (ƒë·ªëi s·ªë `cmap`) c√≥ t√™n l√† `jet`, c√≥ d·∫£i m√†u t·ª´ xanh (gi√° th·∫•p) ƒë·∫øn ƒë·ªè (gi√° cao):

```python
```

![anh](./image/180.png)


- H√¨nh ·∫£nh n√†y cho th·∫•y gi√° nh√† li√™n quan m·∫≠t thi·∫øt ƒë·∫øn v·ªã tr√≠ (nh∆∞ g·∫ßn bi·ªÉn) v√† m·∫≠t ƒë·ªô d√¢n s·ªë, nh∆∞ b·∫°n c√≥ th·ªÉ ƒë√£ bi·∫øt. M·ªôt thu·∫≠t to√°n ph√¢n c·ª•m th∆∞·ªùng s·∫Ω h·ªØu √≠ch trong vi·ªác ph√°t hi·ªán c√°c c·ª•m ch√≠nh, t·ª´ ƒë√≥ gi√∫p b·ªï sung th√™m c√°c ƒë·∫∑c tr∆∞ng m·ªõi l√† kho·∫£ng c√°ch t·ª´ m·∫´u ƒë·∫øn c√°c t√¢m c·ª•m. Kho·∫£ng c√°ch ƒë·∫øn bi·ªÉn c≈©ng c√≥ th·ªÉ l√† m·ªôt thu·ªôc t√≠nh h·ªØu √≠ch, tuy v·∫≠y ·ªü B·∫Øc California gi√° nh√† ·ªü c√°c qu·∫≠n v√πng v·ªãnh l·∫°i kh√¥ng qu√° cao, v√¨ th·∫ø ƒë√¢y kh√¥ng ph·∫£i l√† m·ªôt quy t·∫Øc ƒë∆°n gi·∫£n.

### T√¨m s·ª± t∆∞∆°ng quan

- V√¨ t·∫≠p d·ªØ li·ªáu kh√¥ng qu√° l·ªõn, ta c√≥ th·ªÉ d·ªÖ d√†ng t√≠nh d∆∞·ª£c h·ªá s·ªë t∆∞∆°ng quan chu·∫©n (`standard corelation coefficient`, c√≤n ƒë∆∞·ª£c g·ªçi l√† h·ªá s·ªë t∆∞∆°ng quan `Pearson r`) gi·ªØa c√°c c·∫∑p thu·ªôc t√≠nh b·∫±ng ph∆∞∆°ng th·ª©c `corr()`:

```python
housing = housing.drop(columns=['ocean_proximity'])
corr_matrix = housing.corr()
```

- Gi·ªù h√£y c√πng xem t√≠nh t∆∞∆°ng quan c·ªßa t·ª´ng thu·ªôc t√≠nh d·ªØ li·ªáu v·ªõi nh√† trung v·ªã:

![anh](./image/181.png)

- H·ªá s·ªë t∆∞∆°ng quan n·∫±m trong kho·∫£ng t·ª´ ‚àí1 ƒë·∫øn 1. C√†ng g·∫ßn 1, m·ª©c t∆∞∆°ng quan c√†ng d∆∞∆°ng; v√≠ d·ª•, gi√° nh√† trung v·ªã c√≥ xu h∆∞·ªõng tƒÉng khi thu nh·∫≠p trung v·ªã tƒÉng. Ng∆∞·ª£c l·∫°i, c√†ng g·∫ßn ‚àí1, m·ª©c t∆∞∆°ng quan c√†ng √¢m; ta c√≥ th·ªÉ th·∫•y m·ªôt s·ª± t∆∞∆°ng quan √¢m nh·ªè gi·ªØa vƒ© ƒë·ªô v√† gi√° nh√† trung v·ªã (t·ª©c gi√° nh√† h∆°i c√≥ xu h∆∞·ªõng gi·∫£m d·∫ßn khi ƒëi l√™n ph√≠a B·∫Øc). Cu·ªëi c√πng, h·ªá s·ªë t∆∞∆°ng quan g·∫ßn 0 nghƒ©a l√† kh√¥ng c√≥ s·ª± t∆∞∆°ng quan tuy·∫øn t√≠nh n√†o.


> üìù **Note:** H·ªá s·ªë t∆∞∆°ng quan ch·ªâ ƒëo l∆∞·ªùng s·ª± t∆∞∆°ng quan tuy·∫øn t√≠nh (‚Äún·∫øu x tƒÉng th√¨ y nh√¨n chung s·∫Ω tƒÉng ho·∫∑c gi·∫£m‚Äù). N√≥ c√≥ th·ªÉ ho√†n to√†n b·ªè qua c√°c quan h·ªá phi tuy·∫øn trong d·ªØ li·ªáu (v√≠ d·ª•, ‚Äún·∫øu x g·∫ßn 0 th√¨ y tƒÉng‚Äù). H√£y ƒë·ªÉ √Ω r·∫±ng t·∫•t c·∫£ c√°c ƒë·ªì th·ªã ·ªü h√†ng d∆∞·ªõi c√πng ƒë·ªÅu c√≥ h·ªá s·ªë t∆∞∆°ng quan b·∫±ng 0, d√π c√°c tr·ª•c t·ªça ƒë·ªô r√µ r√†ng kh√¥ng ƒë·ªôc l·∫≠p v·ªõi nhau: ƒë√¢y l√† c√°c v√≠ d·ª• v·ªÅ quan h·ªá phi tuy·∫øn. Th√™m v√†o ƒë√≥, trong h√†ng th·ª© hai, h·ªá s·ªë t∆∞∆°ng quan b·∫±ng 1 ho·∫∑c ‚àí1. Ch√∫ √Ω r·∫±ng ƒëi·ªÅu n√†y kh√¥ng li√™n quan g√¨ ƒë·∫øn ƒë·ªô d·ªëc. V√¨ v·∫≠y, chi·ªÅu cao c·ªßa b·∫°n t√≠nh b·∫±ng inch v·∫´n c√≥ h·ªá s·ªë t∆∞∆°ng quan b·∫±ng 1 v·ªõi chi·ªÅu cao c·ªßa b·∫°n t√≠nh b·∫±ng m√©t ho·∫∑c nano-m√©t.


- M·ªôt c√°ch kh√°c ƒë·ªÉ ki·ªÉm tra m·ªëi quan h·ªá t∆∞∆°ng quan gi·ªØa c√°c thu·ªôc t√≠nh l√† s·ª≠ d·ª•ng h√†m `scatter_matrix()` c·ªßa pandas ƒë·ªÉ v·∫Ω ƒë·ªì th·ªã bi·ªÉu di·ªÖn m·ªëi quan h·ªá gi·ªØa c√°c thu·ªôc t√≠nh so v·ªõi nhau. V√¨ gi·ªù c√≥ 11 thu·ªôc t√≠nh, n√™n ta s·∫Ω c√≥ $11^2 = 121$ ƒë·ªì th·ªã. V√¨ ch√∫ng kh√¥ng n·∫±m v·ª´a trong m·ªôt blog n√™n h√£y ch·ªâ t·∫≠p trung v√†o m·ªôt v√†i thu·ªôc t√≠nh h·ª©a h·∫πn s·∫Ω c√≥ t∆∞∆°ng quan cao v·ªõi gi√° nh√† trung v·ªã:

```python
from pandas.plotting import scatter_matrix

attributes = ["median_house_value", "median_income", "total_rooms",
              "housing_median_age"]
scatter_matrix(housing[attributes], figsize=(12, 8))

```

![anh](./image/182.png)

- ƒê∆∞·ªùng ch√©o ch√≠nh s·∫Ω ƒë·ªÅu l√† c√°c ƒë∆∞·ªùng th·∫≥ng n·∫øu `pandas` v·∫Ω quan h·ªá t·ª´ng bi·∫øn ƒë·ªëi v·ªõi ch√≠nh bi·∫øn ƒë√≥, v√† ƒëi·ªÅu n√†y kh√¥ng h·ªØu √≠ch cho l·∫Øm. N√™n thay v√†o ƒë√≥, pandas v·∫Ω bi·ªÉu ƒë·ªì c·ªßa t·ª´ng thu·ªôc t√≠nh. Thu·ªôc t√≠nh c√≥ h·ª©a h·∫πn nh·∫•t ƒë·ªÉ d·ª± ƒëo√°n gi√° nh√† trung v·ªã l√† thu nh·∫≠p trung v·ªã, n√™n h√£y ph√≥ng to ƒë·ªì th·ªã ph√¢n t√°c t∆∞∆°ng quan c·ªßa ch√∫ng (H√¨nh 2.16):
  
```python
housing.plot(kind="scatter", x="median_income", y="median_house_value",
             alpha=0.1)
plt.axis([0, 16, 0, 550000])
```

![anh](./image/183.png)

- Bi·ªÉu ƒë·ªì n√†y n√≥i l√™n v√†i ƒëi·ªÅu. ƒê·∫ßu ti√™n, s·ª± t∆∞∆°ng quan th·∫≠t s·ª± r·∫•t m·∫°nh. B·∫°n c√≥ th·ªÉ th·∫•y r√µ xu h∆∞·ªõng ƒëi l√™n trong khi c√°c ƒëi·ªÉm d·ªØ li·ªáu th√¨ kh√¥ng qu√° ph√¢n t√°n. Th·ª© hai, m·ª©c gi√° tr·∫ßn ch√∫ng ta th·∫•y tr∆∞·ªõc ƒë√≥ ƒë√£ ƒë∆∞·ª£c bi·ªÉu th·ªã r√µ r√†ng b·∫±ng m·ªôt ƒë∆∞·ªùng ngang t·∫°i 500,000 USD. Tuy nhi√™n, bi·ªÉu ƒë·ªì n√†y c≈©ng ti·∫øt l·ªô m·ªôt v√†i ƒë∆∞·ªùng ngang kh√≥ nh·∫≠n th·∫•y ngay: m·ªôt ƒë∆∞·ªùng quanh 450,000 USD, m·ªôt ƒë∆∞·ªùng kh√°c ·ªü kho·∫£ng 350,000 USD, m·ªôt ƒë∆∞·ªùng kh√°c ·ªü kho·∫£ng 280,000 USD, v√† m·ªôt v√†i ƒë∆∞·ªùng ph√≠a d∆∞·ªõi n·ªØa. B·∫°n c√≥ th·ªÉ th·ª≠ lo·∫°i b·ªè c√°c qu·∫≠n t∆∞∆°ng ·ª©ng ƒë·ªÉ ngƒÉn thu·∫≠t to√°n t√°i t·∫°o l·∫°i nh·ªØng khu√¥n m·∫´u k√¨ l·∫° n√†y trong qu√° tr√¨nh h·ªçc.

### Th√≠ nghi·ªám K·∫øt h·ª£p c√°c Thu·ªôc t√≠nh

- Hy v·ªçng r·∫±ng c√°c m·ª•c tr∆∞·ªõc ƒë√£ gi√∫p b·∫°n n·∫Øm ƒë∆∞·ª£c m·ªôt v√†i c√°ch th·ª©c kh√°m ph√° v√† hi·ªÉu d·ªØ li·ªáu. B·∫°n ƒë√£ nh·∫≠n th·∫•y v√†i ƒëi·ªÉm k√¨ l·∫° trong d·ªØ li·ªáu m√† b·∫°n mu·ªën lo·∫°i b·ªè tr∆∞·ªõc khi ƒë∆∞a v√†o c√°c thu·∫≠t to√°n H·ªçc M√°y, c≈©ng nh∆∞ t√¨m th·∫•y c√°c m·ªëi t∆∞∆°ng quan th√∫ v·ªã gi·ªØa c√°c thu·ªôc t√≠nh, ƒë·∫∑c bi·ªát l√† v·ªõi thu·ªôc t√≠nh m·ª•c ti√™u. B·∫°n c≈©ng nh·∫≠n ra m·ªôt v√†i thu·ªôc t√≠nh c√≥ ph√¢n ph·ªëi n·∫∑ng ƒëu√¥i (`tail-heavy distribution`) v√† mu·ªën bi·∫øn ƒë·ªïi ch√∫ng (v√≠ d·ª• nh∆∞ d√πng h√†m logarit). T·∫•t nhi√™n, c√°ch m·ªói ng∆∞·ªùi x·ª≠ l√Ω s·∫Ω thay ƒë·ªïi nhi·ªÅu t√πy theo n·ªôi dung, nh∆∞ng √Ω t∆∞·ªüng t∆∞∆°ng quan l√† nh∆∞ nhau.
- ƒêi·ªÅu cu·ªëi c√πng b·∫°n c√≥ th·ªÉ mu·ªën l√†m tr∆∞·ªõc khi chu·∫©n b·ªã d·ªØ li·ªáu cho c√°c thu·∫≠t to√°n H·ªçc M√°y l√† th·ª≠ nghi·ªám b·∫±ng c√°ch k·∫øt h·ª£p c√°c thu·ªôc t√≠nh. V√≠ d·ª• nh∆∞ vi·ªác bi·∫øt t·ªïng s·ªë ph√≤ng s·∫Ω c√≥ th·ªÉ b·ªï sung m·ªôt ch√∫t th√¥ng tin, nh∆∞ng n√≥ c√≥ th·ªÉ b·ªï sung bao nhi√™u khi gi√° ƒë√¨nh trung b√¨nh c√≥ 4 ph√≤ng? Th·ª© ta mu·ªën l√† s·ªë ph√≤ng c·ªßa m·ªói h·ªô. T∆∞∆°ng t·ª±, b·∫£n th√¢n th√¥ng tin t·ªïng s·ªë ph√≤ng ng·ªß c≈©ng kh√¥ng h·ªØu √≠ch cho l·∫Øm: ta c√≥ th·ªÉ mu·ªën nh√¨n n√≥ v·ªÅ t·ªïng s·ªë ph√≤ng. Ngo√†i ra s·ªë ng∆∞·ªùi trong m·ªói gia ƒë√¨nh c√≥ th·ªÉ l√† m·ªôt thu·ªôc t√≠nh k·∫øt h·ª£p th√∫ v·ªã. H√£y c√πng t·∫°o ra c√°c thu·ªôc t√≠nh m·ªõi n√†y:

```python
housing["rooms_per_household"] = housing["total_rooms"]/housing["households"]
housing["bedrooms_per_room"] = housing["total_bedrooms"]/housing["total_rooms"]
housing["population_per_household"]=housing["population"]/housing["households"]

```

- V√† gi·ªù h√£y nh√¨n l·∫°i ma tr·∫≠n t∆∞∆°ng quan:

![anh](./image/184.png)


- K·∫øt qu·∫£ kh√¥ng t·ªá ! Thu·ªôc t√≠nh m·ªõi `bedrooms_per_room` c√≥ ƒë·ªô t∆∞∆°ng quan v·ªõi gi√° nh√† trung v·ªã l·ªõn h∆°n h·∫≥n `total_rooms` hay `total_bedrooms`. R√µ r√†ng c√°c ng√¥i nh√† v·ªõi t·ªâ l·ªá ph√≤ng ng·ªß/s·ªë ph√≤ng nh·ªè h∆°n th∆∞·ªùng c√≥ xu h∆∞·ªõng ƒë·∫Øt h∆°n. S·ªë ph√≤ng m·ªói nh√† rooms_per_household c≈©ng mang nhi·ªÅu th√¥ng tin h∆°n t·ªïng s·ªë ph√≤ng `total_rooms` trong m·ªôt qu·∫≠n, v√¨ r√µ r√†ng nh√† c√†ng l·ªõn c√†ng ƒë·∫Øt. Vi·ªác k·∫øt h·ª£p thu·ªôc t√≠nh khi kh√°m ph√° d·ªØ li·ªáu l·∫ßn ƒë·∫ßu kh√¥ng c·∫ßn ph·∫£i tuy·ªát ƒë·ªëi t·ªâ m·ªâ. Ta ch·ªâ c·∫ßn c√≥ m·ªôt kh·ªüi ƒë·∫ßu t·ªët v√† nhanh ch√≥ng hi·ªÉu d·ªØ li·ªáu, ƒë·ªÉ t·ª´ ƒë√≥ ph√°t tri·ªÉn nguy√™n m·∫´u ƒë·∫ßu ti√™n t∆∞∆°ng ƒë·ªëi t·ªët. Nh∆∞ng ƒë√¢y l√† m·ªôt qu√° tr√¨nh l·∫∑p l·∫°i: khi ƒë√£ c√≥ m·ªôt nguy√™n m·∫´u, ta c√≥ th·ªÉ ph√¢n t√≠ch ƒë·∫ßu ra c·ªßa n√≥ ƒë·ªÉ c√≥ nhi·ªÅu th√¥ng tin h∆°n v√† quay l·∫°i b∆∞·ªõc kh√°m ph√° n√†y.

## 4. Chu·∫©n b·ªã D·ªØ li·ªáu cho c√°c Thu·∫≠t to√°n H·ªçc M√°y

- Gi·ªù l√† l√∫c chu·∫©n b·ªã d·ªØ li·ªáu cho c√°c thu·∫≠t to√°n H·ªçc M√°y. Thay v√¨ th·ª±c hi·ªán vi·ªác n√†y th·ªß c√¥ng, ta n√™n vi·∫øt c√°c h√†m ƒë·ªÉ l√†m ƒëi·ªÅu ƒë√≥, v√¨:
    - Vi·ªác n√†y cho ph√©p ta √°p d·ª•ng c√°c ph√©p bi·∫øn ƒë·ªïi d·ªÖ d√†ng tr√™n b·∫•t c·ª© t·∫≠p d·ªØ li·ªáu n√†o (v√≠ d·ª• khi ta c√≥ d·ªØ li·ªáu m·ªõi).
    - Ta s·∫Ω d·∫ßn d·∫ßn x√¢y d·ª±ng m·ªôt th∆∞ vi·ªán c√°c h√†m bi·∫øn ƒë·ªïi ƒë·ªÉ t√°i s·ª≠ d·ª•ng trong t∆∞∆°ng lai.
    - Ta c√≥ th·ªÉ d√πng c√°c h√†m n√†y trong h·ªá th·ªëng th·ª±c ƒë·ªÉ bi·∫øn ƒë·ªïi d·ªØ li·ªáu m·ªõi tr∆∞·ªõc khi ƒë∆∞a v√†o thu·∫≠t to√°n.
    - Ta c√≥ th·ªÉ d·ªÖ d√†ng th·ª≠ nhi·ªÅu ph√©p bi·∫øn ƒë·ªïi v√† xem t·ªï h·ª£p n√†o ho·∫°t ƒë·ªông t·ªët nh·∫•t.
- Nh∆∞ng tr∆∞·ªõc h·∫øt, h√£y quay l·∫°i v·ªõi t·∫≠p hu·∫•n luy·ªán ban ƒë·∫ßu (b·∫±ng c√°ch sao ch√©p `strat_train_set` m·ªôt l·∫ßn n·ªØa). C√πng v·ªõi ƒë√≥, h√£y t√°ch c√°c thu·ªôc t√≠nh v√† nh√£n, v√¨ ta kh√¥ng nh·∫•t thi·∫øt mu·ªën √°p d·ª•ng c√πng c√°c ph√©p bi·∫øn ƒë·ªïi l√™n c·∫£ hai (ch√∫ √Ω r·∫±ng ph∆∞∆°ng th·ª©c `drop()` t·∫°o m·ªôt b·∫£n sao c·ªßa d·ªØ li·ªáu v√† kh√¥ng l√†m ·∫£nh h∆∞·ªüng t·ªõi `strat_train_set`):

```python
housing = strat_train_set.drop("median_house_value", axis=1)
housing_labels = strat_train_set["median_house_value"].copy()

```


### L√†m s·∫°ch D·ªØ li·ªáu
- ƒêa ph·∫ßn c√°c thu·∫≠t to√°n H·ªçc M√°y kh√¥ng th·ªÉ l√†m vi·ªác v·ªõi c√°c ƒë·∫∑c tr∆∞ng b·ªã thi·∫øu n√™n h√£y vi·∫øt m·ªôt v√†i h√†m x·ª≠ l√Ω v·∫•n ƒë·ªÅ n√†y. Tr∆∞·ªõc ƒë√≥ ta ƒë√£ th·∫•y thu·ªôc t√≠nh total_bedrooms c√≥ m·ªôt v√†i gi√° tr·ªã b·ªã thi·∫øu, n√™n h√£y x·ª≠ l√Ω n√≥. Ta c√≥ ba l·ª±a ch·ªçn:
    - Lo·∫°i b·ªè c√°c qu·∫≠n t∆∞∆°ng ·ª©ng.
    - Lo·∫°i b·ªè to√†n b·ªô thu·ªôc t√≠nh.
    - G√°n m·ªôt gi√° tr·ªã n√†o ƒë√≥ (0, trung b√¨nh, trung v·ªã, v.v.).
- Ta c√≥ th·ªÉ th·ª±c hi·ªán nh·ªØng vi·ªác n√†y d·ªÖ d√†ng b·∫±ng c√°c ph∆∞∆°ng th·ª©c `dropna()`, `drop()`, v√† `fillna()` c·ªßa DataFrame:

```python
housing.dropna(subset=["total_bedrooms"])    # option 1
housing.drop("total_bedrooms", axis=1)      # option 2
median = housing["total_bedrooms"].median() # option 3
housing["total_bedrooms"].fillna(median, inplace=True)
```

- H√£y t·∫°o m·ªôt b·∫£n sao c·ªßa t·∫≠p d·ªØ li·ªáu nh√† ·ªü, nh∆∞ng ch·ªâ gi·ªØ l·∫°i c√°c h√†ng ch·ª©a √≠t nh·∫•t m·ªôt gi√° tr·ªã r·ªóng. Sau ƒë√≥, s·∫Ω d·ªÖ d√†ng h∆°n ƒë·ªÉ h√¨nh dung ch√≠nh x√°c nh·ªØng g√¨ m·ªói t√πy ch·ªçn l√†m:

```python
sample_incomplete_rows = housing[housing.isnull().any(axis=1)].head()
sample_incomplete_rows
```

- Ta s·∫Ω th·ª≠ c√°ch 1 l√† lo·∫°i b·ªè c√°c h√†ng ch·ª©a √≠t nh·∫•t m·ªôt gi√° r·ªóng:

```python
sample_incomplete_rows = sample_incomplete_rows.dropna(subset=["total_bedrooms"]) 
sample_incomplete_rows
```

- Ta s·∫Ω th·ª≠ c√°ch 2 l√† lo·∫°i b·ªè lu√¥n c·ªôt thu·ªôc t√≠nh ch·ª©a gi√° tr·ªã r·ªóng:

```python
sample_incomplete_rows = sample_incomplete_rows.drop("total_bedrooms", axis=1)    
sample_incomplete_rows
```

- Ta s·∫Ω th·ª≠ c√°ch 3 l√† thay th·∫ø c√°c √¥ r·ªóng b·∫±ng gi√° tr·ªã `median`:

```python
median = housing["total_bedrooms"].median()
sample_incomplete_rows["total_bedrooms"].fillna(median, inplace=True) # option 3
sample_incomplete_rows
```


- N·∫øu ch·ªçn c√°ch th·ª© 3, ta n√™n t√≠nh gi√° tr·ªã trung v·ªã tr√™n t·∫≠p hu·∫•n luy·ªán v√† d√πng n√≥ ƒë·ªÉ g√°n cho c√°c gi√° tr·ªã b·ªã thi·∫øu trong t·∫≠p hu·∫•n luy·ªán. ƒê·ª´ng qu√™n l∆∞u gi√° tr·ªã trung v·ªã n√†y, v√¨ ta s·∫Ω c·∫ßn ƒë·∫øn n√≥ khi ƒë√°nh gi√° v√† tri·ªÉn khai h·ªá th·ªëng th·ª±c ƒë·ªÉ thay th·∫ø c√°c gi√° tr·ªã b·ªã thi·∫øu trong tapajkiemer tra v√† trong d·ªØ li·ªáu m·ªõi.
- `Scikit-Learn` cung c·∫•p m·ªôt l·ªõp h·ªØu √≠ch ƒë·ªÉ x·ª≠ l√Ω gi√° tr·ªã b·ªã thi·∫øu: `SimpleImputer`. ƒê·ªÉ s·ª≠ d·ª•ng n√≥, ƒë·∫ßu ti√™n ta c·∫ßn t·∫°o m·ªôt th·ª±c th·ªÉ c·ªßa l·ªõp `SimpleImputer` v√† ch·ªâ ƒë·ªãnh r·∫±ng ta mu·ªën thay c√°c gi√° tr·ªã thi·∫øu b·∫±ng trung v·ªã c·ªßa thu·ªôc t√≠nh:

```python
from sklearn.impute import SimpleImputer
imputer = SimpleImputer(strategy = "median")
```

- V√¨ trung v·ªã ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c t√≠nh cho c√°c thu·ªôc t√≠nh s·ªë, ta c·∫ßn t·∫°o b·∫£n sao c·ªßa d·ªØ li·ªáu kh√¥ng ch·ª©a thu·ªôc t√≠nh vƒÉn b·∫£n `ocean_proximity`:

```python
housing_num = housing.drop("ocean_proximity", axis = 1)
```

- Gi·ªù ta c√≥ th·ªÉ kh·ªõp th·ª±c th·ªÉ `imputer` v·ªõi d·ªØ li·ªáu b·∫±ng ph∆∞∆°ng th·ª©c `fit()`:

```python
imputer.fit(housing_num)
```

- Th·ª±c th·ªÉ `imputer` ch·ªâ ƒë∆°n thu·∫ßn t√≠nh trung v·ªã c·ªßa c√°c thu·ªôc t√≠nh v√† l∆∞u k·∫øt qu·∫£ v√†o bi·∫øn th·ª±c th·ªÉ `statistics_` c·ªßa n√≥. Hi·ªán ch·ªâ duy nh·∫•t thu·ªôc t√≠nh `total_bedrooms` c√≥ gi√° tr·ªã thi·∫øu, nh∆∞ng ta kh√¥ng th·ªÉ ƒë·∫£m b·∫£o s·∫Ω kh√¥ng c√≥ gi√° tr·ªã thi·∫øu trong d·ªØ li·ªáu m·ªõi khi tri·ªÉn khai h·ªá th·ªëng, n√™n s·∫Ω an to√†n h∆°n n·∫øu √°p d·ª•ng `imputer` cho t·∫•t c·∫£ c√°c thu·ªôc t√≠nh s·ªë:

![anh](./image/185.png)

- Gi·ªù ta c√≥ th·ªÉ d√πng th·ª±c th·ªÉ `imputer` n√†y ƒë·ªÉ bi·∫øn ƒë·ªïi t·∫≠p hu·∫•n luy·ªán b·∫±ng c·∫•c thay th·∫ø d·ªØ li·ªáu thi·∫øu b·∫±ng trung v·ªã ƒë√£ t√≠nh ƒë∆∞·ª£c:

```python
X = imputer.transform(housing_num)
```

- K·∫øt qu·∫£ l√† m·ªôt m·∫£ng `Numpy` thu·∫ßn ch·ª©a c√°c ƒë·∫∑c tr∆∞ng ƒë√£ ƒë∆∞·ª£c bi·∫øn ƒë·ªïi. N·∫øu ta mu·ªën chuy·ªÉn n√≥ v·ªÅ d·∫°ng `DataFrame` c·ªßa `pandas`, ch·ªâ c·∫ßn:

```python
housing_tr = pd.DataFrame(X, columns=housing_num.columns,
                          index=housing.index)
housing_tr.loc[sample_incomplete_rows.index.values]
```   

### X·ª≠ l√Ω c√°c thu·ªôc t√≠nh vƒÉn b·∫£n v√† h·∫°ng m·ª•c

- Cho ƒë·∫øn nay ch√∫ng ta ch·ªâ m·ªõi l√†m vi·ªác v·ªõi c√°c thu·ªôc t√≠nh s·ªë, n√™n ti·∫øp theo h√£y c√πng xem x√©t c√°c thu·ªôc t√≠nh vƒÉn b·∫£n. Trong t·∫≠p d·ªØ li·ªáu n√†y ch·ªâ c√≥ m·ªôt thu·ªôc t√≠nh nh∆∞ v·∫≠y: `ocean_proximity`. H√£y nh√¨n qua c√°c gi√° tr·ªã c·ªßa 10 m·∫´u ƒë·∫ßu ti√™n:

![anh](./image/186.png)

ƒê√¢y kh√¥ng ph·∫£i l√† ki·ªÉu d·ªØ li·ªáu vƒÉn b·∫£n t√πy √Ω: ch·ªâ c√≥ m·ªôt s·ªë l∆∞·ª£ng gi·ªõi h·∫°n c√°c gi√° tr·ªã kh·∫£ d·ª•ng, m·ªói gi√° tr·ªã bi·ªÉu di·ªÖn m·ªôt h·∫°ng m·ª•c. V√¨ v·∫≠y thu·ªôc t√≠nh n√†y l√† thu·ªôc t√≠nh h·∫°ng m·ª•c. Ph·∫ßn l·ªõn c√°c thu·∫≠t to√°n H·ªçc M√°y th√≠ch l√†m vi·ªác v·ªõi c√°c con s·ªë h∆°n, v·∫≠y n√™n h√£y chuy·ªÉn ƒë·ªïi c√°c h·∫°ng m·ª•c n√†y t·ª´ d·∫°ng vƒÉn b·∫£n sang d·∫°ng s·ªë. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, ta c√≥ th·ªÉ s·ª≠ d·ª•ng l·ªõp `OrdinalEncoder` c·ªßa `Scikit-Learn`:

![anh](./image/187.png)

- Ta c√≥ th·ªÉ tr√≠ch xu·∫•t danh s√°ch h·∫°ng m·ª•c b·∫±ng thu·ªôc t√≠nh `categories_`. ƒê√¢y l√† danh s√°ch g·ªìm c√°c m·∫£ng m·ªôt chi·ªÅu ch·ª©a h·∫°ng m·ª•c t∆∞∆°ng ·ª©ng v·ªõi m·ªói thu·ªôc t√≠nh h·∫°ng m·ª•c (trong tr∆∞·ªùng h·ª£p n√† danh s√°ch ch·ªâ ch·ª©a m·ªôt m·∫£ng v√¨ ch·ªâ c√≥ m·ªôt thu·ªôc t√≠nh h·∫°ng m·ª•c).
  
![anh](./image/188.png)

- M·ªôt s·ªë v·∫•n ƒë·ªÅ v·ªõi c√°ch bi·ªÉu di·ªÖn n√†y l√† c√°c thu·∫≠t to√°n H·ªçc M√°y s·∫Ω gi·∫£ ƒë·ªãnh r·∫±ng hai gi√° tr·ªã g·∫ßn nhau th√¨ gi·ªëng nhau h∆°n l√† hai gi√° tr·ªã c√°ch xa nhau. C√≥ th·ªÉ ƒëi·ªÅu n√†y s·∫Ω kh√¥ng th√†nh v·∫•n ƒë·ªÅ trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p (v√≠ d·ª•: v·ªõi c√°c h·∫°ng m·ª•c c√≥ th·ª© t·ª± nh∆∞ "k√©m", "trung b√¨nh", "t·ªët" v√† "xu·∫•t s·∫Øc"), nh∆∞ng r√µ r√†ng ƒëi·ªÅu n√†y kh√¥ng ƒë√∫ng v·ªõi c·ªôt `ocean_proximity` (v√≠ d·ª•: h·∫°ng m·ª•c 0 v√† 4 r√µ r√†ng g·∫ßn nhau h∆°n h·∫°ng m·ª•c 0 v√† 1). ƒê·ªÉ kh·∫Øc ph·ª•c v·∫•n ƒë·ªÅ n√†y, m·ªôt s·ªë gi·∫£i ph√°p ph·ªï bi·∫øn l√† s·ª≠ d·ª•ng thu·ªôc t√≠nh nh·ªã ph√¢n cho m·ªói h·∫°ng m·ª•c: m·ªôt thu·ªôc t√≠nh b·∫±ng 1 khi h·∫°ng m·ª•c l√† "<1H OCEAN" (v√† tr√°i l·∫°i b·∫±ng 0), m·ªôt thu·ªôc t√≠nh kh√°c b·∫±ng 1 khi h·∫°ng m·ª•c l√† "INLAND" (v√† tr√°i l·∫°i b·∫±ng 0), v.v. Ph∆∞∆°ng ph√°p n√†y ƒë∆∞·ª£c g·ªçi l√† bi·ªÉu di·ªÖn one-hot (`one-hot encoding`), v√¨ ch·ªâ c√≥ m·ªôt thu·ªôc t√≠nh b·∫±ng 1 (hot), trong khi c√°c thu·ªôc t√≠nh kh√°c s·∫Ω b·∫±ng 0 (cold). C√°c thu·ªôc t√≠nh m·ªõi ƒë√¥i khi ƒë∆∞·ª£c g·ªçi l√† thu·ªôc t√≠nh gi·∫£ (dummy attribute). `Scikit-Learn` cung c·∫•p l·ªõp `OneHotEncoder` gi√∫p bi·∫øn ƒë·ªïi c√°c gi√° tr·ªã h·∫°ng m·ª•c th√†nh c√°c vector one-hot:

![anh](./image/189.png)

- L∆∞u √Ω r·∫±ng ƒë·∫ßu ra ·ªü ƒë√¢y l√† m·ªôt ma tr·∫≠n th∆∞a (sparse matrix) `SciPy` thay v√¨ m·ªôt m·∫£ng `NumPy`. ƒêi·ªÅu n√†y r·∫•t h·ªØu √≠ch khi b·∫£ng c√≥ thu·ªôc t√≠nh h·∫°ng m·ª•c v·ªõi h√†ng ngh√¨n danh m·ª•c. Sau khi bi·ªÉu di·ªÖn th√†nh d·∫°ng one-hot, ta c√≥ m·ªôt ma tr·∫≠n v·ªõi h√†ng ngh√¨n c·ªôt ch·ª©a ƒë·∫ßy gi√° tr·ªã 0 ngo·∫°i tr·ª´ gi√° tr·ªã 1 duy nh·∫•t ·ªü m·ªói h√†ng. Vi·ªác s·ª≠ d·ª•ng m·ªôt l∆∞·ª£ng b·ªô nh·ªõ kh·ªïng l·ªì ch·ªâ ƒë·ªÉ l∆∞u tr·ªØ c√°c s·ªë 0 s·∫Ω r·∫•t l√£ng ph√≠, v√¨ th·∫ø ta c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt ma tr·∫≠n th∆∞a v√† ch·ªâ l∆∞u tr·ªØ v·ªã tr√≠ c·ªßa c√°c ph·∫ßn t·ª≠ kh√°c 0. Ta c√≥ th·ªÉ s·ª≠ d·ª•ng n√≥ g·∫ßn gi·ªëng nh∆∞ m·ªôt m·∫£ng hai chi·ªÅu th√¥ng th∆∞·ªùng, tuy nhi√™n n·∫øu b·∫°n th·ª±c s·ª± mu·ªën chuy·ªÉn ƒë·ªïi n√≥ th√†nh m·ªôt m·∫£ng `NumPy` (d√†y ƒë·∫∑c), ch·ªâ c·∫ßn g·ªçi ph∆∞∆°ng th·ª©c `toarray()` nh∆∞ sau:

![anh](./image/190.png)

- M·ªôt l·∫ßn n·ªØa, ta c√≥ th·ªÉ tr√≠ch xu·∫•t danh s√°ch c√°c h·∫°ng m·ª•c b·∫±ng c√°ch s·ª≠ d·ª•ng thu·ªôc t√≠nh `categories_` c·ªßa th·ª±c th·ªÉ encoder:

![anh](./image/191.png)


> üíπ **M·∫πo:** N·∫øu m·ªôt thu·ªôc t√≠nh h·∫°ng m·ª•c c√≥ s·ªë l∆∞·ª£ng h·∫°ng m·ª•c l·ªõn (v√≠ d·ª•: m√£ qu·ªëc gia, ngh·ªÅ nghi·ªáp, gi·ªëng lo√†i), bi·ªÉu di·ªÖn one-hot s·∫Ω tr·∫£ v·ªÅ r·∫•t nhi·ªÅu ƒë·∫∑c tr∆∞ng ƒë·∫ßu v√†o. ƒêi·ªÅu n√†y c√≥ th·ªÉ l√†m ch·∫≠m qu√° tr√¨nh hu·∫•n luy·ªán v√† l√†m suy gi·∫£m ch·∫•t l∆∞·ª£ng m√¥ h√¨nh. Trong tr∆∞·ªùng h·ª£p n√†y, ta c√≥ th·ªÉ thay th·∫ø thu·ªôc t√≠nh h·∫°ng m·ª•c b·∫±ng c√°c ƒë·∫∑c tr∆∞ng s·ªë h·ªçc c√≥ li√™n quan ƒë·∫øn c√°c h·∫°ng m·ª•c ƒë√≥: v√≠ d·ª•, c√≥ th·ªÉ thay ƒë·∫∑c tr∆∞ng ocean_proximity b·∫±ng kho·∫£ng c√°ch t·ªõi ƒë·∫°i d∆∞∆°ng (t∆∞∆°ng t·ª±, m√£ qu·ªëc gia c√≥ th·ªÉ ƒë∆∞·ª£c thay b·∫±ng t·ªïng d√¢n s·ªë ho·∫∑c GDP ƒë·∫ßu ng∆∞·ªùi). Ngo√†i ra, c≈©ng c√≥ th·ªÉ thay th·∫ø m·ªói h·∫°ng m·ª•c b·∫±ng m·ªôt vector √≠t chi·ªÅu c√≥ ƒë∆∞·ª£c th√¥ng qua vi·ªác h·ªçc, g·ªçi l√† embedding. Bi·ªÉu di·ªÖn c·ªßa m·ªói h·∫°ng m·ª•c s·∫Ω ƒë∆∞·ª£c h·ªçc trong qu√° tr√¨nh hu·∫•n luy·ªán. ƒê√¢y l√† m·ªôt v√≠ d·ª• c·ªßa h·ªçc bi·ªÉu di·ªÖn (representation learning).


### B·ªô Bi·∫øn ƒë·ªïi T√πy ch·ªânh


- M·∫∑c d√π `Scikit-Learn` cung c·∫•p kh√° nhi·ªÅu b·ªô bi·∫øn ƒë·ªïi h·ªØu d·ª•ng, ta v·∫´n s·∫Ω c·∫ßn thi·∫øt k·∫ø m·ªôt b·ªô bi·∫øn ƒë·ªïi d√†nh ri√™ng cho c√°c t√°c v·ª• nh∆∞ d·ªçn d·∫πp hay k·∫øt h·ª£p c√°c thu·ªôc t√≠nh c·ª• th·ªÉ. Ta s·∫Ω mu·ªën b·ªô bi·∫øn ƒë·ªïi n√†y ho·∫°t ƒë·ªông tr∆°n tru c√πng v·ªõi c√°c th√†nh ph·∫ßn kh√°c c·ªßa `Scikit-Learn` (nh∆∞ `pipeline`). ƒê·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu n√†y, ta ch·ªâ c·∫ßn t·∫°o m·ªôt l·ªõp v√† khai b√°o ba ph∆∞∆°ng th·ª©c: `fit()` (tr·∫£ v·ªÅ `self`), `transform()`, v√† `fit_transform()` b·ªüi v√¨ `Scikit-Learn` d·ª±a tr√™n `duck typing` (ch·ª© kh√¥ng ph·∫£i t√≠nh k·∫ø th·ª´a).

- Ph∆∞∆°ng th·ª©c `fit_transform()` s·∫Ω c√≥ s·∫µn n·∫øu ta th√™m `TransformerMixin` l√†m l·ªõp c∆° s·ªü. N·∫øu th√™m `BaseEstimator` l√†m l·ªõp c∆° s·ªü (v√† tr√°nh s·ª≠ d·ª•ng `*args` v√† `**kwargs` trong ph∆∞∆°ng th·ª©c kh·ªüi t·∫°o), ta s·∫Ω c√≥ th√™m hai ph∆∞∆°ng th·ª©c r·∫•t h·ªØu √≠ch cho vi·ªác t·ª± ƒë·ªông tinh ch·ªânh c√°c si√™u tham s·ªë l√† `get_params()` v√† `set_params()`.

- V√≠ d·ª•, ƒëo·∫°n m√£ sau l·∫≠p tr√¨nh m·ªôt b·ªô bi·∫øn ƒë·ªïi ƒë·ªÉ gh√©p n·ªëi c√°c thu·ªôc t√≠nh k·∫øt h·ª£p m√† ch√∫ng ta ƒë√£ th·∫£o lu·∫≠n tr∆∞·ªõc ƒë√≥:

```python
H√£y t·∫°o m·ªôt chuy·ªÉn ƒë·ªïi t√πy ch·ªânh ƒë·ªÉ th√™m c√°c thu·ªôc t√≠nh b·ªï sung:

from sklearn.base import BaseEstimator, TransformerMixin

# column index
rooms_ix, bedrooms_ix, population_ix, households_ix = 3, 4, 5, 6

class CombinedAttributesAdder(BaseEstimator, TransformerMixin):
    def __init__(self, add_bedrooms_per_room=True): # no *args or **kargs
        self.add_bedrooms_per_room = add_bedrooms_per_room
    def fit(self, X, y=None):
        return self  # nothing else to do
    def transform(self, X):
        rooms_per_household = X[:, rooms_ix] / X[:, households_ix]
        population_per_household = X[:, population_ix] / X[:, households_ix]
        if self.add_bedrooms_per_room:
            bedrooms_per_room = X[:, bedrooms_ix] / X[:, rooms_ix]
            return np.c_[X, rooms_per_household, population_per_household,
                         bedrooms_per_room]
        else:
            return np.c_[X, rooms_per_household, population_per_household]

attr_adder = CombinedAttributesAdder(add_bedrooms_per_room=False)
housing_extra_attribs = attr_adder.transform(housing.values)
```

- Trong v√≠ d·ª• n√†y, b·ªô bi·∫øn ƒë·ªïi c√≥ m·ªôt si√™u tham s·ªë `add_bedrooms_per_room`, m·∫∑c ƒë·ªãnh ƒë∆∞·ª£c g√°n l√† `True` (vi·ªác cung c·∫•p c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh h·ª£p l√Ω th∆∞·ªùng kh√° h·ªØu √≠ch). Si√™u tham s·ªë n√†y s·∫Ω cho ph√©p ta d·ªÖ d√†ng bi·∫øt ƒë∆∞·ª£c li·ªáu vi·ªác th√™m thu·ªôc t√≠nh n√†y c√≥ gi√∫p √≠ch cho thu·∫≠t to√°n H·ªçc M√°y hay kh√¥ng. T·ªïng qu√°t h∆°n, ta c√≥ th·ªÉ th√™m m·ªôt si√™u tham s·ªë ƒë·ªÉ b·∫≠t/t·∫Øt m·ªôt b∆∞·ªõc chu·∫©n b·ªã d·ªØ li·ªáu b·∫•t k·ª≥ n·∫øu kh√¥ng ch·∫Øc ch·∫Øn 100% v·ªÅ n√≥. C√†ng t·ª± ƒë·ªông h√≥a nh·ªØng b∆∞·ªõc chu·∫©n b·ªã d·ªØ li·ªáu n√†y, ta c√≥ th·ªÉ th·ª≠ nghi·ªám c√†ng nhi·ªÅu t·ªï h·ª£p kh√°c nhau, t·ª´ ƒë√≥ tƒÉng kh·∫£ nƒÉng t√¨m ƒë∆∞·ª£c c√°ch k·∫øt h·ª£p hi·ªáu qu·∫£ nh·∫•t (v√† ti·∫øt ki·ªám r·∫•t nhi·ªÅu th·ªùi gian). 
- L∆∞u √Ω r·∫±ng t√¥i ƒë√£ c·ªë g·∫Øng m√£ h√≥a c√°c ch·ªâ s·ªë (3, 4, 5, 6) ƒë·ªÉ c√≥ s·ª± ng·∫Øn g·ªçn v√† r√µ r√†ng, nh∆∞ng s·∫Ω g·ªçn g√†ng h∆°n nhi·ªÅu n·∫øu b·∫°n l·∫•y ch·ªâ s·ªë m·ªôt c√°ch linh ƒë·ªông, nh∆∞ th·∫ø n√†y:

```python
col_names = "total_rooms", "total_bedrooms", "population", "households"
rooms_ix, bedrooms_ix, population_ix, households_ix = [
    housing.columns.get_loc(c) for c in col_names] # get the column indices
```

- Ngo√†i ra, `housing_extra_attribs` l√† m·ªôt m·∫£ng `NumPy`, ch√∫ng ta ƒë√£ m·∫•t t√™n c·ªôt (th·∫≠t kh√¥ng may, ƒë√≥ l√† v·∫•n ƒë·ªÅ v·ªõi Scikit-Learn). ƒê·ªÉ kh√¥i ph·ª•c `DataFrame`, b·∫°n c√≥ th·ªÉ ch·∫°y nh∆∞ sau:

```python
housing_extra_attribs = pd.DataFrame(
    housing_extra_attribs,
    columns=list(housing.columns)+["rooms_per_household", "population_per_household"],
    index=housing.index)
housing_extra_attribs.head()
```

### Co gi√£n ƒê·∫∑c tr∆∞ng


- M·ªôt trong s·ªë nh·ªØng ph√©p bi·∫øn ƒë·ªïi quan tr·ªçng nh·∫•t m√† ta c·∫ßn th·ª±c hi·ªán tr√™n d·ªØ li·ªáu ƒë√≥ l√† co gi√£n ƒë·∫∑c tr∆∞ng (`feature scaling`). Ngo·∫°i m·ªôt s·ªë √≠t tr∆∞·ªùng h·ª£p ngo·∫°i l·ªá, c√°c thu·∫≠t to√°n H·ªçc M√°y kh√¥ng ho·∫°t ƒë·ªông t·ªët khi c√°c ƒë·∫∑c tr∆∞ng ƒë·∫ßu v√†o c√≥ kho·∫£ng gi√° tr·ªã kh√°c nhau. V·∫•n ƒë·ªÅ n√†y x·∫£y ra trong d·ªØ li·ªáu nh√† ·ªü: t·ªïng s·ªë ph√≤ng n·∫±m trong kho·∫£ng t·ª´ 6 t·ªõi 39,320, trong khi thu nh·∫≠p trung v·ªã ch·ªâ dao ƒë·ªông t·ª´ 0 t·ªõi 15. L∆∞u √Ω r·∫±ng vi·ªác co gi√£n c√°c gi√° tr·ªã m·ª•c ti√™u (nh√£n) th∆∞·ªùng kh√¥ng c·∫ßn thi·∫øt.

- Hai c√°ch ph·ªï bi·∫øn nh·∫•t ƒë·ªÉ ƒë∆∞a c√°c thu·ªôc t√≠nh v·ªÅ c√πng m·ªôt kho·∫£ng gi√° tr·ªã l√†: co gi√£n min-max (`min-max scaling`) v√† chu·∫©n t·∫Øc h√≥a (`standardization`).

- Co gi√£n min-max (coÃÄn ƒë∆∞∆°Ã£c goÃ£i laÃÄ chu√¢Ãân hoÃÅa ‚Äì `normalization`) laÃÄ ph∆∞∆°ng phaÃÅp ƒë∆°n giaÃân nh√¢ÃÅt: caÃÅc giaÃÅ triÃ£ ƒë∆∞∆°Ã£c diÃ£ch chuy√™Ãân vaÃÄ co gi√£n sao cho chuÃÅng nƒÉÃÄm trong khoaÃâng t∆∞ÃÄ 0 t∆°ÃÅi 1. ChuÃÅng ta th∆∞Ã£c hi√™Ã£n ƒëi√™ÃÄu naÃÄy bƒÉÃÄng caÃÅch tr∆∞ÃÄ ƒëi giaÃÅ triÃ£ nhoÃâ nh√¢ÃÅt vaÃÄ chia cho ƒë√¥Ã£ hi√™Ã£u cuÃâa giaÃÅ triÃ£ l∆°ÃÅn nh√¢ÃÅt vaÃÄ nhoÃâ nh√¢ÃÅt. `Scikit-Learn` cung c·∫•p m·ªôt b·ªô bi·∫øn ƒë·ªïi c√≥ t√™n l√† `MinMaxScaler` ƒë·ªÉ th·ª±c hi·ªán ph√©p bi·∫øn ƒë·ªïi n√†y. B·ªô bi·∫øn ƒë·ªïi n√†y ch·ª©a si√™u tham s·ªë `feature_range` cho ph√©p thay ƒë·ªïi kho·∫£ng gi·ªõi h·∫°n trong tr∆∞·ªùng h·ª£p ta kh√¥ng mu·ªën s·ª≠ d·ª•ng kho·∫£ng [0, 1].
- Chu·∫©n t·∫Øc h√≥a th√¨ kh√°c. ƒê·∫ßu ti√™n ta tr·ª´ ƒëi gi√° tr·ªã trung b√¨nh (v√¨ v·∫≠y c√°c gi√° tr·ªã chu·∫©n t·∫Øc lu√¥n c√≥ gi√° tr·ªã trung b√¨nh b·∫±ng 0), sau ƒë√≥ chia cho ƒë·ªô l·ªách chu·∫©n ƒë·ªÉ ph√¢n ph·ªëi thu ƒë∆∞·ª£c c√≥ ph∆∞∆°ng sai ƒë∆°n v·ªã. Kh√¥ng gi·ªëng nh∆∞ `min-max scaling`, chu·∫©n t·∫Øc h√≥a kh√¥ng r√†ng bu·ªôc c√°c gi√° tr·ªã ph·∫£i n·∫±m trong m·ªôt kho·∫£ng c·ª• th·ªÉ. ƒêi·ªÅu n√†y c√≥ th·ªÉ tr·ªü th√†nh v·∫•n ƒë·ªÅ ƒë·ªëi v·ªõi m·ªôt s·ªë thu·∫≠t to√°n (v√≠ d·ª• nh∆∞ m·∫°ng n∆°-ron th∆∞·ªùng y√™u c·∫ßu ƒë·∫ßu v√†o n·∫±m trong kho·∫£ng t·ª´ 0 t·ªõi 1). Tuy nhi√™n, chu·∫©n t·∫Øc h√≥a l·∫°i √≠t b·ªã ·∫£nh h∆∞·ªüng b·ªüi c√°c ƒëi·ªÉm ngo·∫°i lai. V√≠ d·ª•, gi·∫£ s·ª≠ m·ªôt qu·∫≠n c√≥ thu nh·∫≠p trung b√¨nh b·∫±ng 100 (do nh·∫ßm l·∫´n). Khi ƒë√≥ `min-max scaling` s·∫Ω co t·∫•t c·∫£ c√°c gi√° tr·ªã kh√°c t·ª´ [0, 15] xu·ªëng [0, 0.15], c√≤n chu·∫©n t·∫Øc h√≥a s·∫Ω kh√¥ng b·ªã ·∫£nh h∆∞·ªüng ƒë√°ng k·ªÉ. `Scikit-Learn` cung c·∫•p m·ªôt b·ªô bi·∫øn ƒë·ªïi g·ªçi l√† StandardScaler cho vi·ªác chu·∫©n t·∫Øc h√≥a.

> üìù **Note:** C√πng v·ªõi t·∫•t c·∫£ c√°c b·ªô bi·∫øn ƒë·ªïi kh√°c, ta ch·ªâ ƒë∆∞·ª£c kh·ªõp b·ªô co gi√£n cho d·ªØ li·ªáu hu·∫•n luy·ªán, kh√¥ng ph·∫£i to√†n b·ªô d·ªØ li·ªáu (bao g·ªìm t·∫≠p ki·ªÉm tra). Sau ƒë√≥ ta m·ªõi s·ª≠ d·ª•ng n√≥ ƒë·ªÉ bi·∫øn ƒë·ªïi t·∫≠p hu·∫•n luy·ªán v√† t·∫≠p ki·ªÉm tra (v√† c·∫£ d·ªØ li·ªáu m·ªõi). T·ª©c l√† n·∫øu nh∆∞ b·∫°n mu·ªën s·ª≠ d·ª•ng min-max scaling th√¨ b·∫°n ch·ªâ ƒë∆∞·ª£c ph√©p t√≠nh gi√° tr·ªã min v√† max tr√™n b·ªô hu·∫•n luy·ªán r·ªìi √°p d·ª•ng c√¥ng th·ª©c (x - min) / (max - min) cho to√†n b·ªô t·∫≠p (c·∫£ t·∫≠p ki·ªÉm tra).

### Pipeline bi·∫øn ƒë·ªïi

- C√≥ th·ªÉ th·∫•y, c√≥ kh√° nhi·ªÅu b∆∞·ªõc bi·∫øn ƒë·ªïi d·ªØ li·ªáu c·∫ßn ƒë∆∞·ª£c th·ª±c hi·ªán theo ƒë√∫ng tr√¨nh t·ª±. May m·∫Øn thay, `Scikit-Learn` cung c·∫•p l·ªõp `Pipeline` nh·∫±m th·ª±c hi·ªán c√°c chu·ªói bi·∫øn ƒë·ªïi nh∆∞ v·∫≠y. D∆∞·ªõi ƒë√¢y l√† m·ªôt `pipeline` nh·ªè d√†nh cho c√°c thu·ªôc t√≠nh s·ªë:

```python
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler

num_pipeline = Pipeline([
        ('imputer', SimpleImputer(strategy="median")),
        ('attribs_adder', CombinedAttributesAdder()),
        ('std_scaler', StandardScaler()),
    ])

housing_num_tr = num_pipeline.fit_transform(housing_num)
```

- Ph∆∞∆°ng th·ª©c kh·ªüi t·∫°o c·ªßa `Pipeline` nh·∫≠n m·ªôt danh s√°ch c√°c c·∫∑p t√™n/b·ªô ∆∞·ªõc l∆∞·ª£ng ƒë·ªÉ ƒë·ªãnh nghƒ©a m·ªôt chu·ªói c√°c b∆∞·ªõc. T·∫•t c·∫£ c√°c b·ªô ∆∞·ªõc l∆∞·ª£ng ph·∫£i l√† b·ªô bi·∫øn ƒë·ªïi (t·ª©c ph·∫£i c√≥ ph∆∞∆°ng th·ª©c `fit_transform()`), ngo·∫°i tr·ª´ b·ªô ∆∞·ªõc l∆∞·ª£ng cu·ªëi c√πng. T√™n g·ªçi c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·∫∑t m·ªôt c√°ch b·∫•t k·ª≥ (mi·ªÖn sao ch√∫ng ƒë·ªôc nh·∫•t v√† kh√¥ng ch·ª©a d·∫•u g·∫°ch d∆∞·ªõi k√©p, __), v√† ch√∫ng s·∫Ω tr·ªü n√™n h·ªØu √≠ch cho vi·ªác ƒëi·ªÅu ch·ªânh si√™u tham s·ªë sau n√†y.
- Khi ta g·ªçi ph∆∞∆°ng th·ª©c `fit()` c·ªßa pipeline, n√≥ s·∫Ω l·∫ßn l∆∞·ª£t g·ªçi ph∆∞∆°ng th·ª©c `fit_transform()` c·ªßa t·∫•t c·∫£ c√°c b·ªô bi·∫øn ƒë·ªïi, ngo·∫°i tr·ª´ b·ªô ∆∞·ªõc l∆∞·ª£ng cu·ªëi c√πng s·∫Ω g·ªçi ph∆∞∆°ng th·ª©c `fit()`. ƒê·∫ßu ra t·ª´ b·ªô bi·∫øn ƒë·ªïi tr∆∞·ªõc s·∫Ω l√† tham s·ªë cho b·ªô bi·∫øn ƒë·ªïi ph√≠a sau.

- Pipeline n√†y c√≥ c√°c ph∆∞∆°ng th·ª©c gi·ªëng b·ªô ∆∞·ªõc l∆∞·ª£ng cu·ªëi c√πng. Trong v√≠ d·ª• n√†y, b·ªô ∆∞·ªõc l∆∞·ª£ng cu·ªëi c√πng l√† b·ªô bi·∫øn ƒë·ªïi `StandardScaler`, v√¨ th·∫ø ph∆∞∆°ng th·ª©c `transform()` (v√† c·∫£ `fit_transform()` m√† ta ƒë√£ d√πng) c·ªßa pipeline n√†y s·∫Ω th·ª±c hi·ªán t·∫•t c·∫£ c√°c ph√©p bi·∫øn ƒë·ªïi tr√™n t·∫≠p d·ªØ li·ªáu theo ƒë√∫ng tr√¨nh t·ª±.

- Cho ƒë·∫øn nay, ta ƒë√£ x·ª≠ l√Ω c√°c c·ªôt d·ªØ li·ªáu h·∫°ng m·ª•c v√† c√°c c·ªôt d·ªØ li·ªáu s·ªë m·ªôt c√°ch ri√™ng bi·ªát. S·∫Ω thu·∫≠n ti·ªán h∆°n n·∫øu ta c√≥ m·ªôt b·ªô bi·∫øn ƒë·ªïi c√≥ th·ªÉ x·ª≠ l√Ω t·∫•t c·∫£ c√°c c·ªôt, v√† √°p d·ª•ng nh·ªØng ph√©p bi·∫øn ƒë·ªïi ph√π h·ª£p cho t·ª´ng lo·∫°i c·ªôt. T·ª´ phi√™n b·∫£n `0.20`, `Scikit-Learn` ƒë√£ gi·ªõi thi·ªáu `ColumnTransformer` cho m·ª•c ƒë√≠ch n√†y, v√† ti·ªán t·ªët ƒë√≥ l√† n√≥ ho·∫°t ƒë·ªông r·∫•t t·ªët v·ªõi `DataFrame` c·ªßa `pandas`. H√£y s·ª≠ d·ª•ng n√≥ ƒë·ªÉ th·ª±c hi·ªán c√°c ph√©p bi·∫øn ƒë·ªïi tr√™n t·∫≠p d·ªØ li·ªáu nh√† ·ªü:

```python
from sklearn.compose import ColumnTransformer

num_attribs = list(housing_num)
cat_attribs = ["ocean_proximity"]

full_pipeline = ColumnTransformer([
    ("num", num_pipeline, num_attribs),
    ("cat", OneHotEncoder(), cat_attribs),
])

housing_prepared = full_pipeline.fit_transform(housing)

```

- ƒê·∫ßu ti√™n ta khai b√°o l·ªõp `ColumnTransformer`, l·∫•y danh s√°ch ch·ª©a t√™n c√°c c·ªôt c√≥ gi√° tr·ªã s·ªë v√† danh s√°ch ch·ª©a t√™n c√°c c·ªôt c√≥ gi√° tr·ªã h·∫°ng m·ª•c, r·ªìi kh·ªüi t·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng `ColumnTransformer`. Ph∆∞∆°ng th·ª©c kh·ªüi t·∫°o ƒë√≤i h·ªèi m·ªôt danh s√°ch c√°c `tuple`, m·ªói `tuple` ch·ª©a t√™n, b·ªô bi·∫øn ƒë·ªïi v√† danh s√°ch t√™n (ho·∫∑c ch·ªâ s·ªë) c·ªßa c√°c c·ªôt m√† ta mu·ªën √°p d·ª•ng b·ªô bi·∫øn ƒë·ªïi n√†y. ·ªû v√≠ d·ª• n√†y, c√°c c·ªôt ch·ª©a gi√° tr·ªã s·ªë s·∫Ω ƒë∆∞·ª£c bi·∫øn ƒë·ªïi b·ªüi `num_pipeline` ƒë√£ ƒë·ªãnh nghƒ©a ph√≠a tr√™n, v√† c√°c c·ªôt ch·ª©a gi√° tr·ªã h·∫°ng m·ª•c s·∫Ω ƒë∆∞·ª£c bi·∫øn ƒë·ªïi b·∫±ng `OneHotEncoder`. Cu·ªëi c√πng, ta √°p d·ª•ng ƒë·ªëi t∆∞·ª£ng `ColumnTransformer` n√†y l√™n d·ªØ li·ªáu nh√† ·ªü: n√≥ s·∫Ω √°p d·ª•ng m·ªói ph√©p bi·∫øn ƒë·ªïi l√™n c√°c c·ªôt ph√π h·ª£p v√† n·ªëi ƒë·∫ßu ra theo c·ªôt (`axis=1`, c√°c b·ªô bi·∫øn ƒë·ªïi ƒë·ªÅu ph·∫£i tr·∫£ v·ªÅ s·ªë h√†ng gi·ªëng nhau).

- Ch√∫ √Ω r·∫±ng `OneHotEncoder` tr·∫£ v·ªÅ m·ªôt ma tr·∫≠n th∆∞a, c√≤n `num_pipeline` tr·∫£ v·ªÅ m·ªôt ma tr·∫≠n d√†y ƒë·∫∑c. Khi k·∫øt qu·∫£ tr·∫£ v·ªÅ ch·ª©a c·∫£ ma tr·∫≠n th∆∞a l·∫´n ma tr·∫≠n d√†y ƒë·∫∑c, `ColumnTransformer` s·∫Ω ∆∞·ªõc l∆∞·ª£ng m·∫≠t ƒë·ªô c·ªßa ma tr·∫≠n cu·ªëi c√πng (t·ª©c t·ªâ l·ªá c√°c ph·∫ßn t·ª≠ kh√°c kh√¥ng), r·ªìi tr·∫£ v·ªÅ m·ªôt ma tr·∫≠n th∆∞a n·∫øu m·∫≠t ƒë·ªô n√†y nh·ªè h∆°n m·ªôt ng∆∞·ª°ng cho tr∆∞·ªõc (m·∫∑c ƒë·ªãnh th√¨ `sparse_threshold=0.3`). Trong v√≠ d·ª• n√†y, n√≥ tr·∫£ v·ªÅ m·ªôt ma tr·∫≠n d√†y ƒë·∫∑c. ƒê√£ xong, gi·ªù ta c√≥ m·ªôt `pipeline` ti·ªán x·ª≠ l√Ω c√≥ kh·∫£ nƒÉng nh·∫≠n to√†n b·ªô d·ªØ li·ªáu gi√° nh√† v√† √°p d·ª•ng c√°c ph√©p bi·∫øn ƒë·ªïi ph√π h·ª£p l√™n t·ª´ng c·ªôt.

> üíπ **M·∫πo:** Ngo√†i vi·ªác s·ª≠ d·ª•ng m·ªôt b·ªô bi·∫øn ƒë·ªïi, ta c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng "drop" n·∫øu mu·ªën b·ªè c·ªôt, ho·∫∑c "passthrough" n·∫øu mu·ªën gi·ªØ nguy√™n c·ªôt. M·∫∑c ƒë·ªãnh, nh·ªØng c·ªôt c√≤n l·∫°i (t·ª©c nh·ªØng c·ªôt kh√¥ng xu·∫•t hi·ªán trong c√°c danh s√°ch tr√™n) s·∫Ω b·ªã lo·∫°i b·ªè, nh∆∞ng ta c√≥ th·ªÉ ƒë·∫∑t tham s·ªë remainder th√†nh b·∫•t c·ª© b·ªô bi·∫øn ƒë·ªïi n√†o (ho·∫∑c "passthrough") n·∫øu ta mu·ªën x·ª≠ l√Ω ch√∫ng theo ki·ªÉu kh√°c.

- N·∫øu b·∫°n ƒëang s·ª≠ d·ª•ng `Scikit-Learn 0.19` ho·∫∑c c≈© h∆°n, b·∫°n c√≥ th·ªÉ d√πng m·ªôt th∆∞ vi·ªán b√™n th·ª© ba nh∆∞ `sklearn-pandas`, ho·∫∑c t·ª± l·∫≠p tr√¨nh m·ªôt ph√©p bi·∫øn ƒë·ªïi ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± nh∆∞ `ColumnTransformer`. M·ªôt ph∆∞∆°ng √°n kh√°c l√† s·ª≠ d·ª•ng l·ªõp `FeatureUnion` ƒë·ªÉ √°p d·ª•ng c√°c ph√©p bi·∫øn ƒë·ªïi kh√°c nhau r·ªìi g·ªôp n·ªëi c√°c k·∫øt qu·∫£ ƒë·∫ßu ra. Tuy nhi√™n s·∫Ω s·∫Ω kh√¥ng th·ªÉ ch·ªâ ƒë·ªãnh c√°c c·ªôt kh√°c nhau cho m·ªói ph√©p bi·∫øn ƒë·ªïi, m√† ch√∫ng s·∫Ω ƒë·ªÅu ƒë∆∞·ª£c √°p d·ª•ng cho to√†n b·ªô d·ªØ li·ªáu. V·∫•n ƒë·ªÅ n√†y c√≥ th·ªÉ ƒë∆∞·ª£c kh·∫Øc ph·ª•c b·∫±ng c√°ch t·ª± l·∫≠p tr√¨nh m·ªôt ph√©p bi·∫øn ƒë·ªïi ƒë·ªÉ ch·ªçn c·ªôt.

## 5. Ch·ªçn v√† Hu·∫•n luy·ªán M√¥ h√¨nh

- Ta ƒë√£ ƒë·ªãnh nghƒ©a xong b√†i to√°n, thu th·∫≠p v√† kh√°m ph√° d·ªØ li·ªáu, l·∫•y m·∫´u t·∫≠p hu·∫•n luy·ªán v√† t·∫≠p ki·ªÉm tra, r·ªìi vi·∫øt pipeline ch·ª©a c√°c ph√©p bi·∫øn ƒë·ªïi ƒë·ªÉ l√†m s·∫°ch v√† chu·∫©n b·ªã d·ªØ li·ªáu cho c√°c thu·∫≠t to√°n H·ªçc M√°y m·ªôt c√°ch t·ª± ƒë·ªông. Cu·ªëi c√πng th√¨ ta ƒë√£ s·∫µn s√†ng ƒë·ªÉ ch·ªçn v√† hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh H·ªçc M√°y.

### Hu·∫•n luy·ªán v√† ƒê√°nh gi√° tr√™n t·∫≠p Hu·∫•n luy·ªán

- Tin t·ªët l√† nh·ªù c√≥ nh·ªØng b∆∞·ªõc ph√≠a tr√™n, m·ªçi th·ª© s·∫Ω tr·ªü n√™n ƒë∆°n gi·∫£n h∆°n nhi·ªÅu. ƒê·∫ßu ti√™n, h√£y hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh H·ªìi quy Tuy·∫øn t√≠nh, nh∆∞ ta ƒë√£ l√†m trong ch∆∞∆°ng tr∆∞·ªõc:

```python
from sklearn.linear_model import LinearRegression

lin_reg = LinearRegression()
lin_reg.fit(housing_prepared, housing_labels)
```

- R·∫•t t·ªët! B√¢y gi·ªù ta ƒë√£ c√≥ m·ªôt m√¥ h√¨nh H·ªìi quy Tuy·∫øn t√≠nh kh·∫£ d·ª•ng. H√£y c√πng th·ª≠ n√≥ v·ªõi m·ªôt v√†i m·∫´u d·ªØ li·ªáu t·ª´ t·∫≠p hu·∫•n luy·ªán:

![anh](./image/192.png)


- N√≥ c√≥ ho·∫°t ƒë·ªông, d√π c√°c d·ª± ƒëo√°n ch∆∞a ƒë∆∞·ª£c ch√≠nh x√°c cho l·∫Øm (d·ª± ƒëo√°n ƒë·∫ßu ti√™n b·ªã l·ªách kho·∫£ng 40%!). H√£y ƒëo RMSE c·ªßa m√¥ h√¨nh n√†y tr√™n to√†n b·ªô t·∫≠p hu·∫•n luy·ªán b·∫±ng h√†m `mean_squared_error()` c√≥ s·∫µn trong `Scikit-Learn`, ngo√†i ra th√¨ b·∫°n c√≥ th·ªÉ ƒëo MAE b·∫±ng h√†m `mean_absolute_error()`:

![anh](./image/193.png)



- C√≥ v·∫´n h∆°n kh√¥ng, nh∆∞ng r√µ r√†ng k·∫øt qu·∫£ n√†y kh√¥ng t·ªët: gi√° tr·ªã `median_housing_values` ·ªü h·∫ßu h·∫øt c√°c qu·∫≠n n·∫±m trong kho·∫£ng 120,000 USD v√† 265,000 USD, n√™n sai l·ªách kho·∫£ng 68,628 USD ch∆∞a th·ªÉ l√†m ta h√†i l√≤ng. ƒê√¢y l√† m·ªôt v√≠ d·ª• cho vi·ªác m√¥ h√¨nh d∆∞·ªõi kh·ªõp d·ªØ li·ªáu hu·∫•n luy·ªán. Khi ƒëi·ªÅu n√†y x·∫£y ra, c√≥ th·ªÉ c√°c ƒë·∫∑c tr∆∞ng kh√¥ng cung c·∫•p ƒë·ªß th√¥ng tin ƒë·ªÉ ƒë∆∞a ra d·ª± ƒëo√°n t·ªët, ho·∫∑c c≈©ng c√≥ th·ªÉ m√¥ h√¨nh v·∫´n ch∆∞a ƒë·ªß m·∫°nh. Nh∆∞ ta ƒë√£ th·∫•y ·ªü ch∆∞∆°ng tr∆∞·ªõc, nh·ªØng ph∆∞∆°ng ph√°p ch√≠nh ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ d∆∞·ªõi kh·ªõp l√† ch·ªçn m·ªôt m√¥ h√¨nh m·∫°nh h∆°n, cung c·∫•p ƒë·∫∑c tr∆∞ng t·ªët h∆°n cho thu·∫≠t to√°n ho·∫∑c gi·∫£m c√°c ƒëi·ªÅu ki·ªán r√†ng bu·ªôc l√™n m√¥ h√¨nh. M√¥ h√¨nh n√†y ch∆∞a ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh n√™n ta c√≥ th·ªÉ lo·∫°i tr·ª´ ph∆∞∆°ng √°n cu·ªëi c√πng. Ta c√≥ th·ªÉ th·ª≠ th√™m c√°c ƒë·∫∑c tr∆∞ng kh√°c (v√≠ d·ª• nh∆∞ log c·ªßa d√¢n s·ªë), nh∆∞ng tr∆∞·ªõc ti√™n h√£y th·ª≠ s·ª≠ d·ª•ng m·ªôt m√¥ h√¨nh ph·ª©c t·∫°p h∆°n ƒë·ªÉ xem k·∫øt qu·∫£ ra sao.

- H√£y hu·∫•n luy·ªán m·ªôt `DecisionTreeRegressor`. ƒê√¢y l√† m·ªôt m√¥ h√¨nh m·∫°nh m·∫Ω v√† c√≥ kh·∫£ nƒÉng t√¨m ra c√°c quan h·ªá phi tuy·∫øn trong d·ªØ li·ªáu. Ch·∫Øc h·∫≥n gi·ªù b·∫°n ƒë√£ th·∫•y quen thu·ªôc v·ªõi ƒëo·∫°n m√£ b√™n d∆∞·ªõi:

```python
from sklearn.tree import DecisionTreeRegressor

tree_reg = DecisionTreeRegressor()
tree_reg.fit(housing_prepared, housing_labels)
```

- Sau khi m√¥ h√¨nh ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán xong, h√£y ƒë√°nh gi√° n√≥ tr√™n t·∫≠p hu·∫•n luy·ªán:


![anh](./image/194.png)

- G√¨ th·∫ø n√†y!? Kh√¥ng h·ªÅ c√≥ sai l·ªách? Li·ªáu c√≥ ph·∫£i m√¥ h√¨nh n√†y ho√†n h·∫£o tuy·ªát ƒë·ªëi kh√¥ng? T·∫•t nhi√™n, kh·∫£ nƒÉng cao l√† m√¥ h√¨nh ƒë√£ qu√° kh·ªõp d·ªØ li·ªáu m·ªôt c√°ch n·∫∑ng n·ªÅ. L√†m th·∫ø n√†o ƒë·ªÉ x√°c nh·∫≠n ƒëi·ªÅu n√†y? Nh∆∞ ƒë·ªÅ c·∫≠p ·ªü tr√™n, ta kh√¥ng mu·ªën ƒë·ªông v√†o t·∫≠p ki·ªÉm tra cho ƒë·∫øn khi s·∫µn s√†ng tri·ªÉn khai m·ªôt m√¥ h√¨nh ƒë√°ng tin c·∫≠y. V√¨ v·∫≠y, ta c·∫ßn ph·∫£i d√†nh ri√™ng m·ªôt ph·∫ßn c·ªßa t·∫≠p hu·∫•n luy·ªán cho vi·ªác ki·ªÉm ƒë·ªãnh m√¥ h√¨nh v√† ph·∫ßn c√≤n l·∫°i cho vi·ªác hu·∫•n luy·ªán.


### Ki·ªÉm ƒë·ªãnh Ch√©o: Ph∆∞∆°ng ph√°p ƒê√°nh gi√° t·ªët h∆°n

- M√¥t c√°ch ƒë·ªÉ ƒë√°nh gi√° m√¥ h√¨nh C√¢y Quy·∫øt ƒë·ªãnh l√† s·ª≠ d·ª•ng h√†m `train_test_split()` ƒë·ªÉ chia t·∫≠p hu·∫•n luy·ªán th√†nh m·ªôt t·∫≠p hu·∫•n luy·ªán nh·ªè h∆°n v√† m·ªôt t·∫≠p ki·ªÉm ƒë·ªãnh, r·ªìi hu·∫•n luy·ªán m√¥ h√¨nh tr√™n t·∫≠p hu·∫•n luy·ªán nh·ªè v√† ƒë√°nh gi√° n√≥ tr√™n t·∫≠p ki·ªÉm ƒë·ªãnh. Ta s·∫Ω c·∫ßn l√†m vi·ªác nhi·ªÅu h∆°n m·ªôt ch√∫t, nh∆∞ng c≈©ng kh√¥ng c√≥ g√¨ qu√° kh√≥ khƒÉn v√† ph∆∞∆°ng √°n n√†y ho·∫°t ƒë·ªông kh√° t·ªët.
- M·ªôt ph∆∞∆°ng √°n tuy·ªát v·ªùi kh√°c l√† s·ª≠ d·ª•ng t√≠nh nƒÉng ki·ªÉm ƒë·ªãnh ch√©o `K-fold` (`K-fold cross-validation`) c·ªßa `Scikit-Learn`. ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y chia ng·∫´u nhi√™n t·∫≠p hu·∫•n luy·ªán th√†nh 10 t·∫≠p con ri√™ng bi·ªát g·ªçi l√† `fold`, r·ªìi hu·∫•n luy·ªán v√† ƒë√°nh gi√° m√¥ h√¨nh C√¢y Quy·∫øt ƒë·ªãnh 10 l·∫ßn, m·ªói l·∫ßn ch·ªçn m·ªôt fold kh√°c nhau ƒë·ªÉ ƒë√°nh gi√° v√† hu·∫•n luy·ªán tr√™n 9 fold c√≤n l·∫°i. K·∫øt qu·∫£ l√† m·ªôt m·∫£ng ch·ª©a 10 ƒëi·ªÉm s·ªë ƒë√°nh gi√°:

```python
from sklearn.model_selection import cross_val_score

scores = cross_val_score(tree_reg, housing_prepared, housing_labels,
                         scoring="neg_mean_squared_error", cv=10)
tree_rmse_scores = np.sqrt(-scores)
```

> üìù **Note:** T√≠nh nƒÉng ki·ªÉm ƒë·ªãnh ch√©o c·ªßa Scikit-Learn l√†m vi·ªác v·ªõi m·ªôt h√†m l·ª£i √≠ch (c√†ng cao c√†ng t·ªët) thay v√¨ m·ªôt h√†m chi ph√≠ (c√†ng th·∫•p c√†ng t·ªët), n√™n h√†m t√≠nh ƒëi·ªÉm l√† h√†m ƒë·ªëi c·ªßa MSE (t·ª©c c√≥ gi√° tr·ªã √¢m). ƒê√¢y l√† l√Ω do t·∫°i sao ƒëo·∫°n m√£ tr√™n t√≠nh -scores tr∆∞·ªõc khi l·∫•y cƒÉn b·∫≠c hai.

- H√£y c√πng xem k·∫øt qu·∫£:

![anh](./image/195.png)


- Gi·ªù th√¨ C√¢y Quy·∫øt ƒë·ªãnh kh√¥ng c√≤n t·ªët nh∆∞ tr∆∞·ªõc n·ªØa. Th·ª±c ch·∫•t, c√≥ v·∫ª n√≥ ho·∫°t ƒë·ªông t·ªá h∆°n c·∫£ M√¥ H√¨nh H·ªìi Quy Tuy·∫øn T√≠nh ! Ch√∫ √Ω r·∫±ng ki·ªÉm ƒë·ªãnh ch√©o kh√¥ng ch·ªâ gi√∫p ta ∆∞·ªõc t√≠nh ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh, m√† n√≥ c√≤n ƒë√°nh gi√° ƒë·ªô ch√≠nh x√°c c·ªßa ∆∞·ªõc t√≠nh n√†y (t·ª©c ƒë·ªô l·ªách chu·∫©n). C√¢y Quy·∫øt ƒê·ªãnh c√≥ ƒëi·ªÉm s·ªë kho·∫£ng 71,407 +- 2,439. Ta s·∫Ω kh√¥ng c√≥ ƒë∆∞·ª£c th√¥ng tin n√†y n·∫øu ch·ªâ d√πng m·ªôt t·∫≠p ki·ªÉm ƒë·ªãnh. Tuy nhi√™n, ki·ªÉm ƒë·ªãnh ch√©o l·∫°i ƒëi k√®m v·ªõi chi ph√≠ c·ªßa vi·ªác hu·∫•n luy·ªán m√¥ h√¨nh nhi·ªÅu l·∫ßn, n√™n kh√¥ng ph·∫£i l√∫c n√†o n√≥ c≈©ng kh·∫£ thi.
- ƒê·ªÉ ch·∫Øc ch·∫Øn h∆°n, h√£y t√≠nh ƒëi·ªÉm s·ªë t∆∞∆°ng t·ª± nh∆∞ tr√™n cho m√¥ h√¨nh H·ªìi Quy Tuy·∫øn t√≠nh:

![anh](./image/196.png)

- Qu·∫£ th·∫≠t, m√¥ h√¨nh C√¢y Quy·∫øt ƒë·ªãnh qu√° kh·ªõp n·∫∑ng t·ªõi m·ª©c n√≥ ho·∫°t ƒë·ªông t·ªá h∆°n c·∫£ m√¥ h√¨nh H·ªìi Quy Tuy·∫øn T√≠nh.
- Gi·ªù h√£y th·ª≠ m·ªôt m√¥ h√¨nh cu·ªëi c√πng: `RandomForestRegressor`. Nh∆∞ ta s·∫Ω th·∫•y trong blog kh√°c, R·ª´ng Ng·∫´u nhi√™n ho·∫°t ƒë·ªông b·∫±ng c√°ch hu·∫•n luy·ªán nhi·ªÅu C√¢y Quy·∫øt ƒë·ªãnh v·ªõi c√°c t·∫≠p con ƒë·∫∑c tr∆∞ng ng·∫´u nhi√™n, r·ªìi l·∫•y trung b√¨nh d·ª± ƒëo√°n c·ªßa ch√∫ng. X√¢y d·ª±ng m·ªôt m√¥ h√¨nh d·ª±a tr√™n nhi·ªÅu m√¥ h√¨nh kh√°c ƒë∆∞·ª£c g·ªçi l√† H·ªçc `Ensemble`, v√† ƒë√¢y th∆∞·ªùng l√† m·ªôt c√°ch t·ªët ƒë·ªÉ c·∫£i thi·ªán h∆°n n·ªØa c√°c thu·∫≠t to√°n ML m√† ngu·ªìn t∆∞∆°ng t·ª± nh∆∞ v·ªõi c√°c m√¥ h√¨nh kh√°c:

```python
from sklearn.ensemble import RandomForestRegressor

forest_reg = RandomForestRegressor(n_estimators=100, random_state=42)
forest_reg.fit(housing_prepared, housing_labels)

housing_predictions = forest_reg.predict(housing_prepared)
forest_mse = mean_squared_error(housing_labels, housing_predictions)
forest_rmse = np.sqrt(forest_mse)
forest_rmse
```

> 18603.515021376355


```python
from sklearn.model_selection import cross_val_score

forest_scores = cross_val_score(forest_reg, housing_prepared, housing_labels,
                                scoring="neg_mean_squared_error", cv=10)
forest_rmse_scores = np.sqrt(-forest_scores)
display_scores(forest_rmse_scores)
```

> Scores: [49519.80364233 47461.9115823  50029.02762854 52325.28068953
> 
> 49308.39426421 53446.37892622 48634.8036574  47585.73832311
> 
> 53490.10699751 50021.5852922 ]
> 
> Mean: 50182.303100336096
> 
> Standard deviation: 2097.0810550985693

- K·∫øt qu·∫£ n√†y t·ªët h∆°n r·∫•t nhi·ªÅu. R·ª´ng Ng·∫´u nhi√™n c√≥ v·∫ª r·∫•t h·ª©a h·∫πn. Tuy nhi√™n, l∆∞u √Ω r·∫±ng ƒëi·ªÉm s·ªë tr√™n t·∫≠p hu·∫•n luy·ªán v·∫´n th·∫•p h∆°n nhi·ªÅu so v·ªõi tr√™n t·∫≠p ki·ªÉm ƒë·ªãnh, c√≥ nghƒ©a l√† m√¥ h√¨nh v·∫´n qu√° kh·ªõp tr√™n t·∫≠p hu·∫•n luy·ªán. C√°c gi·∫£i ph√°p kh·∫£ thi cho hi·ªán t∆∞·ª£ng qu√° kh·ªõp l√† ƒë∆°n gi·∫£n h√≥a m√¥ h√¨nh, r√†ng bu·ªôc m√¥ h√¨nh (t·ª©c ƒëi·ªÅu chu·∫©n), ho·∫∑c thu th·∫≠p nhi·ªÅu d·ªØ li·ªáu hu·∫•n luy·ªán h∆°n n·ªØa. Tuy nhi√™n, tr∆∞·ªõc khi t√¨m hi·ªÉu s√¢u h∆°n v·ªÅ m√¥ h√¨nh R·ª´ng Ng·∫´u nhi√™n, b·∫°n n√™n th·ª≠ nhi·ªÅu m√¥ h√¨nh H·ªçc M√°y kh√°c nhau (v√≠ d·ª•: thu·∫≠t to√°n M√°y Vector H·ªó tr·ª£ c√°c h·∫°t nh√¢n kh√°c nhau, hay c√°c m·∫°ng n∆°-ron), ch·ª© kh√¥ng n√™n d√†nh qu√° nhi·ªÅu th·ªùi gian ƒë·ªÉ tinh ch·ªânh c√°c si√™u tham s·ªë. M·ª•c ti√™u l√† ƒë·ªÉ ch·ªçn ra m·ªôt v√†i m√¥ h√¨nh tri·ªÉn v·ªçng (t·ª´ hai ƒë·∫øn nƒÉm m√¥ h√¨nh).

- B·∫°n n√™n l∆∞u m·ªçi m√¥ h√¨nh ƒë√£ th·ª≠ nghi·ªám ƒë·ªÉ c√≥ th·ªÉ d·ªÖ d√†ng quay l·∫°i l√†m vi·ªác v·ªõi b·∫•t k·ª≥ m√¥ h√¨nh n√†o. H√£y ƒë·∫£m b·∫£o r·∫±ng b·∫°n l∆∞u c·∫£ si√™u tham s·ªë v√† tham s·ªë ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán, ƒëi·ªÉm s·ªë ki·ªÉm ƒë·ªãnh ch√©o v√† c√≥ th·ªÉ c·∫£ c√°c d·ª± ƒëo√°n th·ª±c t·∫ø. ƒêi·ªÅu n√†y s·∫Ω cho ph√©p b·∫°n d·ªÖ d√†ng so s√°nh ƒëi·ªÉm s·ªë gi·ªØa c√°c lo·∫°i m√¥ h√¨nh v√† so s√°nh c√°c lo·∫°i l·ªói m√† ch√∫ng m·∫Øc ph·∫£i. B·∫°n c√≥ th·ªÉ d·ªÖ d√†ng l∆∞u c√°c m√¥ h√¨nh trong `Scikit-Learn` b·∫±ng c√°ch s·ª≠ d·ª•ng m√¥-ƒëun `pickle` c·ªßa Python ho·∫∑c s·ª≠ d·ª•ng `joblib`, m·ªôt th∆∞ vi·ªán hi·ªáu qu·∫£ h∆°n trong vi·ªác chu·ªói h√≥a c√°c m·∫£ng Numpy l·ªõn (b·∫°n c√≥ th·ªÉ c√†i ƒë·∫∑t th∆∞ vi·ªán n√†y b·∫±ng c√°ch s·ª≠ d·ª•ng pip):

```python
import joblib

joblib.dump(my_model, "my_model.pkl")
# and later...
my_model_loaded = joblib.load("my_model.pkl")

```

## 6. Tinh ch·ªânh m√¥ h√¨nh

- Gi·∫£ s·ª≠ ta c√≥ m·ªôt danh s√°ch nh·ªØng m√¥ h√¨nh tri·ªÉn v·ªçng v√† c·∫ßn ƒë∆∞·ª£c tinh ch·ªânh. H√£y xem qua m·ªôt v√†i c√°ch ƒë·ªÉ th·ª±c hi·ªán vi·ªác n√†y:

### T√¨m ki·∫øm d·∫°ng L∆∞·ªõi

- M·ªôt l·ª±a ch·ªçn l√† tinh ch·ªânh th·ªß c√¥ng ƒë·∫øn khi t√¨m ƒë∆∞·ª£c m·ªôt b·ªô c√°c gi√° tr·ªã si√™u tham s·ªë ∆∞ng √Ω. C√°ch n√†y th·ª±c s·ª± r·∫•t nh√†m ch√°n v√† ta c√≥ th·ªÉ kh√¥ng c√≥ ƒë·ªß th·ªùi gian ƒë·ªÉ kh√°m ph√° nhi·ªÅu c√°ch k·∫øt h·ª£p kh√°c nhau.
- Thay v√†o ƒë√≥, h√£y s·ª≠ d·ª•ng `GridSearchCV` trong `Scikit-Learn` ƒë·ªÉ t√¨m ki·∫øm m·ªôt b·ªô si√™u tham s·ªë ph√π h·ª£p. Ta ch·ªâ c·∫ßn ch·ªâ r√µ nh·ªØng si√™u tham s·ªë mu·ªën tinh ch·ªânh v√† c√°c gi√° tr·ªã n√†o c·∫ßn th·ª≠, r·ªìi GridSearchCV s·∫Ω s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p ki·ªÉm ƒë·ªãnh ch√©o ƒë·ªÉ ƒë√°nh gi√° t·∫•t c·∫£ c√°c c√°ch k·∫øt h·ª£p kh·∫£ thi c·ªßa c√°c gi√° tr·ªã si√™u tham s·ªë. V√≠ d·ª•, ƒëo·∫°n m√£ d∆∞·ªõi ƒë√¢y s·∫Ω t√¨m ki·∫øm b·ªô gi√° tr·ªã t·ªët nh·∫•t cho c√°c si√™u tham s·ªë c·ªßa `RandomForestRegressor`:

```python
from sklearn.model_selection import GridSearchCV

param_grid = [
    # try 12 (3√ó4) combinations of hyperparameters
    {'n_estimators': [3, 10, 30], 'max_features': [2, 4, 6, 8]},
    # then try 6 (2√ó3) combinations with bootstrap set as False
    {'bootstrap': [False], 'n_estimators': [3, 10], 'max_features': [2, 3, 4]},
  ]

forest_reg = RandomForestRegressor(random_state=42)
# train across 5 folds, that's a total of (12+6)*5=90 rounds of training 
grid_search = GridSearchCV(forest_reg, param_grid, cv=5,
                           scoring='neg_mean_squared_error',
                           return_train_score=True)
grid_search.fit(housing_prepared, housing_labels)
```


> üíπ **M·∫πo:** Khi kh√¥ng bi·∫øt gi√° tr·ªã n√†o s·∫Ω ph√π h·ª£p v·ªõi m·ªôt si√™u tham s·ªë, m·ªôt c√°ch ti·∫øp c·∫≠n ƒë∆°n gi·∫£n l√† th·ª≠ c√°c l≈©y th·ª´a li√™n ti·∫øp c·ªßa 10 (ho·∫∑c m·ªôt s·ªë nh·ªè h∆°n n·∫øu b·∫°n mu·ªën t√¨m ki·∫øm chi ti·∫øt h∆°n, nh∆∞ v·ªõi si√™u tham s·ªë n_estimators trong v√≠ d·ª• n√†y).


- ƒê·ªëi s·ªë `param_grid` tr√™n y√™u c·∫ßu `Scikit-Learn` ph·∫£i: ƒë·∫ßu ti√™n ƒë√°nh gi√° t·∫•t c·∫£ $3 √ó 4 = 12$ c√°ch k·∫øt h·ª£p c·ªßa `n_estimators` v√† `max_features` ƒë∆∞·ª£c m√¥ t·∫£ trong dict ƒë·∫ßu ti√™n (hi·ªán t·∫°i b·∫°n kh√¥ng c·∫ßn quan t√¢m v·ªÅ √Ω nghƒ©a c·ªßa c√°c si√™u tham s·ªë n√†y; ch√∫ng s·∫Ω ƒë∆∞·ª£c gi·∫£i th√≠ch trong blog kh√°c), sau ƒë√≥ th·ª≠ t·∫•t c·∫£ $2 x 3 = 6$ c√°ch k·∫øt h·ª£p c·ªßa hai si√™u tham s·ªë ƒë√≥ trong dict th·ª© hai, nh∆∞ng l·∫ßn n√†y v·ªõi `bootstrap` ƒë∆∞·ª£c ƒë·∫∑t l√† `False` thay v√¨ gi√° tr·ªã m·∫∑c ƒë·ªãnh `True`. T√¨m ki·∫øm d·∫°ng l∆∞·ªõi s·∫Ω kh√°m ph√° $12 + 6 = 18$ c√°ch k·∫øt h·ª£p c·ªßa c√°c gi√° tr·ªã si√™u tham s·ªë trong RandomForestRegressor v√† hu·∫•n luy·ªán m·ªói m√¥ h√¨nh 5 l·∫ßn (v√¨ d√πng ph∆∞∆°ng ph√°p ki·ªÉm ƒë·ªãnh ch√©o 5 fold). N√≥i c√°ch kh√°c, s·∫Ω c√≥ t·ªïng c·ªông $18 √ó 5 = 90$ l·∫ßn hu·∫•n luy·ªán! Vi·ªác n√†y c√≥ th·ªÉ s·∫Ω kh√° t·ªën th·ªùi gian, nh∆∞ng sau khi ho√†n th√†nh, b·∫°n c√≥ th·ªÉ t√¨m ƒë∆∞·ª£c b·ªô gi√° tr·ªã t·ªët nh·∫•t cho c√°c si√™u tham s·ªë nh∆∞ sau:

```python
grid_search.best_params_
```

> {'max_features': 8, 'n_estimators': 30}


> üíπ **M·∫πo:** V√¨ 8 v√† 30 l√† gi√° tr·ªã l·ªõn nh·∫•t ƒë∆∞·ª£c ki·ªÉm ƒë·ªãnh, b·∫°n n√™n th·ª≠ t√¨m ki·∫øm l·∫°i v·ªõi gi√° tr·ªã l·ªõn h∆°n; ƒëi·ªÉm s·ªë c√≥ th·ªÉ s·∫Ω ti·∫øp t·ª•c ƒë∆∞·ª£c c·∫£i thi·ªán.

- B·∫°n c≈©ng c√≥ th·ªÉ thu ƒë∆∞·ª£c b·ªô ∆∞·ªõc l∆∞·ª£ng t·ªët nh·∫•t m·ªôt c√°ch tr·ª±c ti·∫øp nh∆∞ sau:

![anh](./image/197.png)

> üìù **Note:**  N·∫øu GridSearchCV ƒë∆∞·ª£c kh·ªüi t·∫°o v·ªõi refit = True (l√† gi√° tr·ªã m·∫∑c ƒë·ªãnh), th√¨ ngay sau khi t√¨m ƒë∆∞·ª£c b·ªô ∆∞·ªõc l∆∞·ª£ng t·ªët nh·∫•t theo ki·ªÉm ƒë·ªãnh ch√©o, n√≥ s·∫Ω hu·∫•n luy·ªán laiji m√¥ h√¨nh tr√™n to√†n b·ªô t·∫≠p d·ªØ li·ªáu hu·∫•n luy·ªán m·ªôt l·∫ßn n·ªØa. ƒê√¢y th∆∞·ªùng l√† m·ªôt √Ω t∆∞·ªüng hay v√¨ ƒë∆∞a th√™m nhi·ªÅu d·ªØ li·ªáu h∆°n n·ªØa s·∫Ω c√≥ kh·∫£ cƒÉng c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh.

- V√† ƒëi·ªÉm s·ªë ƒë√°nh gi√° c≈©ng s·∫Ω ƒë∆∞·ª£c tr·∫£ v·ªÅ:

![anh](./image/198.png)


- Trong v√≠ d·ª• n√†y, ch√∫ng ta t√¨m ƒë∆∞·ª£c m√¥ h√¨nh t·ªët nh·∫•t b·∫±ng c√°ch ƒë·∫∑t gi√° tr·ªã si√™u tham s·ªë `max_features` l√† 8 v√† `n_estimators` l√† 30. ƒêi·ªÉm RMSE cho c√°ch k·∫øt h·ª£p n√†y l√† 49,682, t·ªët h∆°n m·ªôt ch√∫t so v·ªõi c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh c·ªßa si√™u tham s·ªë tr∆∞·ªõc ƒë√≥ (l√† 50,182). Ch√∫c m·ª´ng, b·∫°n ƒë√£ tinh ch·ªânh th√†nh c√¥ng m√¥ h√¨nh t·ªët nh·∫•t c·ªßa m√¨nh !
  
> üíπ **M·∫πo:** ƒê·ª´ng qu√™n r·∫±ng b·∫°n c√≥ th·ªÉ coi m·ªôt s·ªë b∆∞·ªõc chu·∫©n b·ªã d·ªØ li·ªáu l√† si√™u tham s·ªë. V√≠ d·ª•, t√¨m ki·∫øm d·∫°ng l∆∞·ªõi s·∫Ω t·ª± ƒë·ªông ki·ªÉm tra xem c√≥ n√™n th√™m m·ªôt ƒë·∫∑c tr∆∞ng hay kh√¥ng (v√≠ d·ª•: s·ª≠ d·ª•ng si√™u tham s·ªë add_bedroom_per_room trong b·ªô chuy·ªÉn ƒë·ªïi CombineAttributesAdder). T∆∞∆°ng t·ª±, b·∫°n c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng t√¨m ki·∫øm d·∫°ng l∆∞·ªõi ƒë·ªÉ t·ªëi ∆∞u h√≥a c√°ch x·ª≠ l√Ω t·ªët nh·∫•t c√°c m·∫´u ngo·∫°i lai, c√°c ƒë·∫∑c tr∆∞ng b·ªã khuy·∫øt, l·ª±a ch·ªçn ƒë·∫∑c tr∆∞ng, v.v.

### T√¨m ki·∫øm Ng·∫´u Nhi√™n

- T√¨m ki·∫øm d·∫°ng l∆∞·ªõi c√≥ th·ªÉ ƒë∆∞·ª£c d√πng ƒë·ªÉ kh√°m ph√° t∆∞∆°ng ƒë·ªëi √≠t c√°c c√°ch k·∫øt h·ª£p nh∆∞ trong v√≠ d·ª• tr∆∞·ªõc, nh∆∞ng khi kh√¥ng gian t√¨m ki·∫øm si√™u tham s·ªë l·ªõn h∆°n th√¨ ta n√™n ∆∞u ti√™n d√πng `RandomizedSearchCV`. L·ªõp n√†y c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng t∆∞∆°ng t·ª± nh∆∞ l·ªõp `GridSearchCV`, nh∆∞ng thay v√¨ th·ª≠ t·∫•t c·∫£ c√°c c√°ch k·∫øt h·ª£p kh·∫£ thi, n√≥ s·∫Ω ƒë√°nh gi√° m·ªôt s·ªë c√°ch k·∫øt h·ª£p ng·∫´u nhi√™n nh·∫•t ƒë·ªãnh b·∫±ng c√°ch ch·ªçn m·ªôt gi√° tr·ªã ng·∫´u nhi√™n cho m·ªói si√™u tham s·ªë t·∫°i m·ªói l·∫ßn l·∫∑p. Ph∆∞∆°ng ph√°p n√†y c√≥ hai l·ª£i √≠ch ch√≠nh sau ƒë√¢y:

    - N·∫øu ta ƒë·ªÉ thu·∫≠t to√°n t√¨m ki·∫øm ng·∫´u nhi√™n ch·∫°y 1,000 l·∫ßn l·∫∑p, n√≥ s·∫Ω kh√°m ph√° 1,000 gi√° tr·ªã kh√°c nhau cho m·ªói si√™u tham s·ªë (thay v√¨ ch·ªâ m·ªôt v√†i gi√° tr·ªã tr√™n m·ªói si√™u tham s·ªë nh∆∞ trong t√¨m ki·∫øm d·∫°ng l∆∞·ªõi).

    - Ch·ªâ c·∫ßn nh·∫≠p s·ªë l·∫ßn l·∫∑p, ta s·∫Ω ki·ªÉm so√°t t·ªët h∆°n t√†i nguy√™n t√≠nh to√°n ƒë∆∞·ª£c ph√¢n b·ªï cho vi·ªác t√¨m ki·∫øm si√™u tham s·ªë.
- D∆∞·ªõi ƒë√¢y l√† v√≠ d·ª•:
  
```python
from sklearn.model_selection import RandomizedSearchCV
from scipy.stats import randint

param_distribs = {
        'n_estimators': randint(low=1, high=200),
        'max_features': randint(low=1, high=8),
    }

forest_reg = RandomForestRegressor(random_state=42)
rnd_search = RandomizedSearchCV(forest_reg, param_distributions=param_distribs,
                                n_iter=10, cv=5, scoring='neg_mean_squared_error', random_state=42)
rnd_search.fit(housing_prepared, housing_labels)

cvres = rnd_search.cv_results_
for mean_score, params in zip(cvres["mean_test_score"], cvres["params"]):
    print(np.sqrt(-mean_score), params)
```

> 49150.70756927707 {'max_features': 7, 'n_estimators': 180}
> 
> 51389.889203389284 {'max_features': 5, 'n_estimators': 15}
> 
> 50796.155224308866 {'max_features': 3, 'n_estimators': 72}
> 
> 50835.13360315349 {'max_features': 5, 'n_estimators': 21}
> 
> 49280.9449827171 {'max_features': 7, 'n_estimators': 122}
> 
> 50774.90662363929 {'max_features': 3, 'n_estimators': 75}
> 
> 50682.78888164288 {'max_features': 3, 'n_estimators': 88}
> 
> 49608.99608105296 {'max_features': 5, 'n_estimators': 100}
> 
> 50473.61930350219 {'max_features': 3, 'n_estimators': 150}
> 
> 64429.84143294435 {'max_features': 5, 'n_estimators': 2}


### Ph∆∞∆°ng ph√°p Ensemble

- M·ªôt c√°ch n·ªØa ƒë·ªÉ tinh ch·ªânh h·ªá th·ªëng l√† th·ª≠ k·∫øt h·ª£p c√°c m√¥ h√¨nh ho·∫°t ƒë·ªông t·ªët nh·∫•t. Nh√≥m (ho·∫∑c ‚Äúensemble‚Äù) c√°c m√¥ h√¨nh ri√™ng l·∫ª n√†y th∆∞·ªùng s·∫Ω ho·∫°t ƒë·ªông t·ªët h∆°n so v·ªõi m·ªôt m√¥ h√¨nh ri√™ng l·∫ª t·ªët nh·∫•t (gi·ªëng nh∆∞ R·ª´ng Ng·∫´u nhi√™n ho·∫°t ƒë·ªông t·ªët h∆°n C√¢y Quy·∫øt ƒë·ªãnh ri√™ng l·∫ª), ƒë·∫∑c bi·ªát n·∫øu c√°c m√¥ h√¨nh ri√™ng l·∫ª m·∫Øc c√°c l·ªói r·∫•t kh√°c nhau. Ch√∫ng ta s·∫Ω tr√¨nh b√†y chi ti·∫øt h∆°n trong blog kh√°c.

### Ph√¢n t√≠ch c√°c M√¥ h√¨nh T·ªët nh·∫•t v√† L·ªói c·ªßa Ch√∫ng


- Ta th∆∞·ªùng c√≥ th√™m nh·ªØng hi·ªÉu bi·∫øt s√¢u h∆°n v·ªÅ b√†i to√°n b·∫±ng c√°ch ki·ªÉm tra c√°c m√¥ h√¨nh t·ªët nh·∫•t. V√≠ d·ª•: RandomForestRegressor c√≥ th·ªÉ t√≠nh ƒë∆∞·ª£c ƒë·ªô quan tr·ªçng t∆∞∆°ng ƒë·ªëi c·ªßa m·ªói thu·ªôc t√≠nh ƒë·ªÉ ƒë∆∞a ra d·ª± ƒëo√°n ch√≠nh x√°c:

![anh](./image/199.png)

- H√£y in ra c√°c ƒëi·ªÉm s·ªë th·ªÉ hi·ªán ƒë·ªô quan tr·ªçng c√πng v·ªõi t√™n c√°c thu·ªôc t√≠nh t∆∞∆°ng ·ª©ng:

![anh](./image/200.png)


- V·ªõi th√¥ng tin n√†y, b·∫°n c√≥ th·ªÉ th·ª≠ lo·∫°i b·ªè m·ªôt s·ªë ƒë·∫∑c tr∆∞ng √≠t h·ªØu d·ª•ng (v√≠ d·ª•: d∆∞·ªùng nh∆∞ ch·ªâ c√≥ ƒë·∫∑c tr∆∞ng `ocean_proximity` l√† h·ªØu d·ª•ng, n√™n c√≥ th·ªÉ th·ª≠ lo·∫°i b·ªè c√°c ƒë·∫∑c tr∆∞ng kh√°c).
- Ta c≈©ng n√™n xem x√©t c√°c l·ªói c·ª• th·ªÉ m√† h·ªá th·ªëng m·∫Øc ph·∫£i, t·ª´ ƒë√≥ c·ªë g·∫Øng hi·ªÉu nguy√™n nh√¢n v√† t√¨m ra c√°ch kh·∫Øc ph·ª•c v·∫•n ƒë·ªÅ (nh∆∞ th√™m c√°c ƒë·∫∑c tr∆∞ng, b·ªï sung ho·∫∑c lo·∫°i b·ªè c√°c ƒë·∫∑c tr∆∞ng kh√¥ng c√≥ gi√° tr·ªã, lo·∫°i b·ªè c√°c m·∫´u ngo·∫°i lai, v.v).

### ƒê√°nh gi√° H·ªá Th·ªëng tr√™n T·∫≠p Ki·ªÉm Tra

- Sau khi tinh ch·ªânh xong c√°c m√¥ h√¨nh, tq ƒë√£ c√≥ m·ªôt h·ªá th·ªëng ho·∫°t ƒë·ªông ƒë·ªß t·ªët. B√¢y gi·ªù l√† l√∫c ƒë·ªÉ ƒë√°nh gi√° m√¥ h√¨nh cu·ªëi c√πng tr√™n t·∫≠p d·ªØ li·ªáu ki·ªÉm tra. Kh√¥ng c√≥ g√¨ ƒë·∫∑c bi·ªát v·ªÅ qu√° tr√¨nh n√†y: ch·ªâ c·∫ßn l·∫•y c√°c ƒë·∫∑c tr∆∞ng v√† nh√£n t·ª´ t·∫≠p ki·ªÉm tra, ch·∫°y `full_pipeline` ƒë·ªÉ bi·∫øn ƒë·ªïi d·ªØ li·ªáu (g·ªçi h√†m `transform()` thay v√¨ `fit_transform()`, b·ªüi ta kh√¥ng mu·ªën kh·ªõp tr√™n t·∫≠p ki·ªÉm tra!), v√† ƒë√°nh gi√° m√¥ h√¨nh cu·ªëi c√πng tr√™n t·∫≠p ki·ªÉm tra:

```python
final_model = grid_search.best_estimator_

X_test = strat_test_set.drop("median_house_value", axis=1)
y_test = strat_test_set["median_house_value"].copy()

X_test_prepared = full_pipeline.transform(X_test)
final_predictions = final_model.predict(X_test_prepared)

final_mse = mean_squared_error(y_test, final_predictions)
final_rmse = np.sqrt(final_mse)
final_rmse
```
> 47873.26095812988

- Trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p, ∆∞·ªõc l∆∞·ª£ng ƒëi·ªÉm cho sai s·ªë kh√°i qu√°t s·∫Ω kh√¥ng ƒë·ªß thuy·∫øt ph·ª•c ƒë·ªÉ tri·ªÉn khai m√¥ h√¨nh: n·∫øu m√¥ h√¨nh n√†y ch·ªâ t·ªët h∆°n 0.1% so v·ªõi m√¥ h√¨nh ƒëang ƒë∆∞·ª£c tri·ªÉn khai th√¨ sao ? B·∫°n c√≥ th·ªÉ mu·ªën bi·∫øt m·ª©c ƒë·ªô ch√≠nh x√°c c·ªßa ∆∞·ªõc l∆∞·ª£ng n√†y. ƒê·ªÉ l√†m v·∫≠y, ta c√≥ th·ªÉ t√≠nh to√°n kho·∫£ng tin c·∫≠y 95% cho l·ªói kh√°i qu√°t b·∫±ng c√°ch s·ª≠ d·ª•ng `scipy.stats.interval()`


![anh](./image/201.png)


- N·∫øu ta ƒë√£ tinh ch·ªânh si√™u tham s·ªë nhi·ªÅu l·∫ßn, ch·∫•t l∆∞·ª£ng m√¥ h√¨nh th∆∞·ªùng s·∫Ω k√©m h∆°n m·ªôt ch√∫t so v·ªõi k·∫øt qu·∫£ thu ƒë∆∞·ª£c t·ª´ ki·ªÉm ƒë·ªãnh ch√©o (v√¨ h·ªá th·ªëng l√∫c n√†y ƒë√£ ƒë∆∞·ª£c tinh ch·ªânh ƒë·ªÉ ho·∫°t ƒë·ªông t·ªët tr√™n d·ªØ li·ªáu ki·ªÉm ƒë·ªãnh v√† nhi·ªÅu kh·∫£ nƒÉng s·∫Ω kh√¥ng ho·∫°t ƒë·ªông t·ªët nh∆∞ v·∫≠y tr√™n d·ªØ li·ªáu ch∆∞a bi·∫øt). Vi·ªác n√†y kh√¥ng x·∫£y ra trong v√≠ d·ª• tr√™n, nh∆∞ng khi g·∫∑p tr∆∞·ªùng h·ª£p n√†y, ta ph·∫£i h·∫°n ch·∫ø vi·ªác tinh ch·ªânh si√™u tham s·ªë ƒë·ªÉ ƒë·∫°t k·∫øt qu·∫£ cao h∆°n tr√™n t·∫≠p ki·ªÉm tra. R·∫•t c√≥ th·ªÉ m·ª©c c·∫£i thi·ªán n√†y s·∫Ω kh√¥ng kh√°i qu√°t t·ªët tr√™n d·ªØ li·ªáu m·ªõi.

- Gi·ªù ƒë√£ ƒë·∫øn giai ƒëo·∫°n ti·∫øn tri·ªÉn khai d·ª± √°n: ta c·∫ßn tr√¨nh b√†y gi·∫£i ph√°p c·ªßa m√¨nh (nh·∫•n m·∫°nh nh·ªØng g√¨ ƒë√£ h·ªçc ƒë∆∞·ª£c, nh·ªØng g√¨ hi·ªáu qu·∫£ v√† kh√¥ng hi·ªáu qu·∫£, c√°c gi·∫£ ƒë·ªãnh v√† h·∫°n ch·∫ø c·ªßa h·ªá th·ªëng), vi·∫øt t√†i li·ªáu chi ti·∫øt v√† chu·∫©n b·ªã thuy·∫øt tr√¨nh v·ªõi minh h·ªça r√µ r√†ng c√πng c√°c ng√¥n t·ª´ d·ªÖ n√≥i (v√≠ d·ª•: ‚Äúthu nh·∫≠p trung v·ªã l√† ƒë·∫∑c tr∆∞ng s·ªë m·ªôt ƒë·ªÉ d·ª± ƒëo√°n gi√° nh√† ·ªü‚Äù). Trong v√≠ d·ª• v·ªÅ gi√° nh√† ·ªü California, ch·∫•t l∆∞·ª£ng cu·ªëi c√πng c·ªßa h·ªá th·ªëng kh√¥ng t·ªët h∆°n so v·ªõi k·∫øt qu·∫£ c·ªßa c√°c chuy√™n gia (th∆∞·ªùng k√©m kho·∫£ng 20%), nh∆∞ng c√≥ l·∫Ω ta v·∫´n n√™n tri·ªÉn khai h·ªá th·ªëng, ƒë·∫∑c bi·ªát n·∫øu ƒëi·ªÅu n√†y gi√∫p c√°c chuy√™n gia ti·∫øt ki·ªám th·ªùi gian ƒë·ªÉ h·ªç c√≥ th·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• th√∫ v·ªã v√† hi·ªáu qu·∫£ h∆°n.

## 7. Tri·ªÉn khai, Theo d√µi, v√† B·∫£o tr√¨ H·ªá th·ªëng

- Th·∫≠t tuy·ªát! H·ªá th·ªëng ƒë√£ ƒë∆∞·ª£c ch·∫•p thu·∫≠n ƒë·ªÉ tri·ªÉn khai! B√¢y gi·ªù ta c·∫ßn ch·ªânh trang l·∫°i m√£ ngu·ªìn, vi·∫øt t√†i li·ªáu v√† ki·ªÉm th·ª≠, v.v., ƒë·ªÉ chu·∫©n b·ªã s·∫µn s√†ng v·∫≠n h√†nh. Sau ƒë√≥, ta c√≥ th·ªÉ tri·ªÉn khai m√¥ h√¨nh v√†o m√¥i tr∆∞·ªùng v·∫≠n h√†nh (`production environment`). ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, ta c√≥ th·ªÉ l∆∞u m√¥ h√¨nh `Scikit-Learn` ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán (v√≠ d·ª•: s·ª≠ d·ª•ng `joblib`), bao g·ªìm to√†n b·ªô `pipeline` ti·ªÅn x·ª≠ l√Ω d·ªØ li·ªáu, sau ƒë√≥ n·∫°p m√¥ h√¨nh n√†y v√†o m√¥i tr∆∞·ªùng v·∫≠n h√†nh v√† s·ª≠ d·ª•ng ch√∫ng ƒë·ªÉ d·ª± ƒëo√°n b·∫±ng c√°ch g·ªçi ph∆∞∆°ng th·ª©c `predict()`. V√≠ d·ª•, c√≥ th·ªÉ m√¥ h√¨nh s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m·ªôt trang web: ng∆∞·ªùi d√πng s·∫Ω nh·∫≠p d·ªØ li·ªáu v·ªÅ m·ªôt qu√°n m·ªõi v√† nh·∫•p v√†o n√∫t D·ª± ƒëo√°n Gi√°. Thao t√°c n√†y s·∫Ω g·ª≠i m·ªôt truy v·∫•n ch·ª©a d·ªØ li·ªáu ƒë·∫øn m√°y ch·ªß c·ªßa trang web, m√°y ch·ªß s·∫Ω chuy·ªÉn ti·∫øp ƒë·∫øn ·ª©ng d·ª•ng web v√† g·ªçi ph∆∞∆°ng th·ª©c `predict()` c·ªßa m√¥ h√¨nh (n√™n n·∫°p m√¥ h√¨nh ngay khi kh·ªüi ƒë·ªông m√°y ch·ªß, thay v√¨ n·∫°p m·ªói l·∫ßn m√¥ h√¨nh ƒë∆∞·ª£c s·ª≠ d·ª•ng). Ngo√†i ra, ta c√≥ th·ªÉ ƒë√≥ng g√≥i m√¥ h√¨nh trong m·ªôt d·ªãch v·ª• web chuy·ªÉn d√πng m√† ·ª©ng d·ª•ng c·ªßa b·∫°n c√≥ th·ªÉ truy v·∫•n th√¥ng qua `REST API` (xem th√™m H√¨nh 2.17). ƒêi·ªÅu n√†y gi√∫p ta d·ªÖ d√†ng n√¢ng c·∫•p m√¥ h√¨nh l√™n c√°c phi√™n b·∫£n m·ªõi m√† kh√¥ng l√†m gi√°n ƒëo·∫°n ·ª©ng d·ª•ng. N√≥ c≈©ng ƒë∆°n gi·∫£n h√≥a vi·ªác m·ªü r·ªông quy m√¥, v√¨ ta c√≥ th·ªÉ kh·ªüi t·∫°o nhi·ªÅu d·ªãch v·ª• web n·∫øu c·∫ßn c√¢n b·∫±ng t·∫£i (`load-balance`) c√°c truy v·∫•n ƒë·∫øn t·ª´ ·ª©ng d·ª•ng cho c√°c d·ªãch v·ª• n√†y. H∆°n n·ªØa, n√≥ cho ph√©p ·ª©ng d·ª•ng web s·ª≠ d·ª•ng b·∫•t k·ª≥ ng√¥n ng·ªØ n√†o, kh√¥ng ch·ªâ Python.

![anh](./image/202.png)

- M·ªôt chi·∫øn l∆∞·ª£c ph·ªï bi·∫øn kh√°c l√† tri·ªÉn khai m√¥ h√¨nh tr√™n ƒëi·ªán to√°n ƒë√°m m√¢y, ch·∫≥ng h·∫°n nh∆∞ `Google Cloud AI Platform` (t√™n g·ªçi tr∆∞·ªõc l√† `Google Cloud ML Engine`): ch·ªâ c·∫ßn l∆∞u m√¥ h√¨nh b·∫±ng `joblib` v√† t·∫£i l√™n `Google Cloud Storage` (GCS), sau ƒë√≥ t·∫°o phi√™n b·∫£n m√¥ h√¨nh m·ªõi t·∫°i Google Cloud AI Platform v√† tr·ªè n√≥ t·ªõi t·ªáp GCS. Ch·ªâ ƒë∆°n gi·∫£n v·∫≠y th√¥i! C√°ch n√†y cung c·∫•p m·ªôt d·ªãch v·ª• web ƒë∆°n gi·∫£n ƒë·∫£m nh·∫≠n vi·ªác c√¢n b·∫±ng t·∫£i v√† m·ªü r·ªông quy m√¥. D·ªãch v·ª• web tr√™n s·∫Ω nh·∫≠n c√°c y√™u c·∫ßu d·∫°ng JSON ch·ª©a d·ªØ li·ªáu ƒë·∫ßu v√†o (v√≠ d·ª•: c·ªßa m·ªôt qu√°n) v√† tr·∫£ v·ªÅ c√°c ph·∫ßn h·ªìi JSON c√≥ ch·ª©a c√°c d·ª± ƒëo√°n. Sau ƒë√≥, ta c√≥ th·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª• web n√†y trong trang web c·ªßa m√¨nh (ho·∫∑c b·∫•t k·ª≥ m√¥i tr∆∞·ªùng v·∫≠n h√†nh n√†o ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng). Vi·ªác tri·ªÉn khai nh·ªØng m√¥ h√¨nh TensorFlow tr√™n n·ªÅn t·∫£ng AI (s·∫Ω ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p trong blog kh√°c) kh√¥ng kh√°c nhi·ªÅu so v·ªõi vi·ªác tri·ªÉn khai m√¥ h√¨nh `Scikit-Learn`.

- Nh∆∞ng tri·ªÉn khai s·∫£n ph·∫©m kh√¥ng c√≥ nghƒ©a l√† ƒë√£ ho√†n th√†nh c√¥ng vi·ªác. Ta c≈©ng c·∫ßn vi·∫øt m√£ gi√°m s√°t ƒë·ªÉ ki·ªÉm tra ƒë·ªãnh k·ª≥ ch·∫•t l∆∞·ª£ng c·ªßa h·ªá th·ªëng v√† k√≠ch ho·∫°t c·∫£nh b√°o khi n√≥ gi·∫£m ƒëi. ƒê√¢y c√≥ th·ªÉ l√† m·ªôt s·ª± gi√°m nghi·ªám nghi√™m tr·ªçng, kh·∫£ nƒÉng cao l√† do m·ªôt th√†nh ph·∫ßn b·ªã h·ªèng trong c∆° s·ªü h·∫° t·∫ßng, nh∆∞ng h√£y l∆∞u √Ω r·∫±ng n√≥ c≈©ng c√≥ th·ªÉ l√† do m·ªôt s·ª± gi·∫£m nh·∫π kh√¥ng ƒë∆∞·ª£c ch√∫ √Ω m·ªôt th·ªùi gian d√†i. ƒêi·ªÅu n√†y kh√° ph·ªï bi·∫øn v·ªõi c√°c m√¥ h√¨nh c√≥ xu h∆∞·ªõng ‚Äúsuy gi·∫£m ch·∫•t l∆∞·ª£ng‚Äù theo th·ªùi gian: th·∫≠t v·∫≠y, th·∫ø gi·ªõi lu√¥n thay ƒë·ªïi, v√¨ v·∫≠y m√¥ h√¨nh ƒë∆∞·ª£c hu·∫•n luy·ªán tr√™n d·ªØ li·ªáu c·ªßa nƒÉm ngo√°i c√≥ th·ªÉ s·∫Ω kh√¥ng th√≠ch ·ª©ng ƒë∆∞·ª£c v·ªõi d·ªØ li·ªáu hi·ªán nay.

> üìù **Note:** Ngay c·∫£ m·ªôt m√¥ h√¨nh ƒë∆°n gi·∫£n nh∆∞ ph√¢n lo·∫°i ·∫£nh m√®o v√† ch√≥ c≈©ng c√≥ th·ªÉ c·∫ßn ph·∫£i hu·∫•n luy·ªán l·∫°i th∆∞·ªùng xuy√™n. L√Ω do kh√¥ng ph·∫£i v√¨ ch√≥ v√† m√®o s·∫Ω bi·∫øn ƒë·ªïi trong m·ªôt s·ªë m·∫∑t chi·ªÅu m√† v√¨ m√°y ·∫£nh li√™n t·ª•c thay ƒë·ªïi, c√πng v·ªõi ƒë·ªãnh d·∫°ng, ƒë·ªô s·∫Øc n√©t, ƒë·ªô s√°ng v√† t·ª∑ l·ªá k√≠ch th∆∞·ªõc ·∫£nh. H∆°n n·ªØa, m·ªçi ng∆∞·ªùi c√≥ th·ªÉ y√™u th√≠ch c√°c gi·ªëng ch√≥ kh√°c v√†o nƒÉm t·ªõi, ho·∫∑c gia c·ªë th·ªÉ ƒë·ªôi cho v·∫≠t nu√¥i c·ªßa m√¨nh nh·ªØng chi·∫øc m≈© nh·ªè xinh ‚Äì kh√¥ng ai c√≥ th·ªÉ bi·∫øt tr∆∞·ªõc ƒë∆∞·ª£c.

- V√¨ v·∫≠y, ta lu√¥n c·∫ßn theo d√µi ch·∫•t l∆∞·ª£ng hi·ªán t·∫°i c·ªßa m√¥ h√¨nh. Nh∆∞ng ph·∫£i l√†m ƒëi·ªÅu ƒë√≥ nh∆∞ th·∫ø n√†o? Th·∫≠t ra n√≥ ph·ª• thu·ªôc v√†o nhi·ªÅu y·∫øu t·ªë. Trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p, ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh c√≥ th·ªÉ ƒë∆∞·ª£c suy ra t·ª´ c√°c ph√©p ƒëo m·ª•c ti√™u. V√≠ d·ª•, n·∫øu m√¥ h√¨nh c·ªßa b·∫°n l√† m·ªôt ph·∫ßn c·ªßa h·ªá th·ªëng ƒë·ªÅ xu·∫•t v√† n√≥ ƒë·ªÅ xu·∫•t c√°c s·∫£n ph·∫©m m√† ng∆∞·ªùi d√πng c√≥ th·ªÉ quan t√¢m th√¨ th·∫≠t d·ªÖ d√†ng ƒë·ªÉ theo d√µi s·ªë l∆∞·ª£ng s·∫£n ph·∫©m ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t ƒë√£ b√°n m·ªói ng√†y. N·∫øu con s·ªë n√†y gi·∫£m xu·ªëng (so v·ªõi c√°c s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t), th√¨ kh·∫£ nƒÉng cao l√† do m√¥ h√¨nh. ƒêi·ªÅu n√†y c√≥ th·ªÉ l√† do pipeline d·ªØ li·ªáu b·ªã h·ªèng, ho·∫∑c c√≥ l·∫Ω m√¥ h√¨nh c·∫ßn ƒë∆∞·ª£c hu·∫•n luy·ªán l·∫°i tr√™n d·ªØ li·ªáu m·ªõi (nh∆∞ ƒë√£ ƒë∆∞·ª£c l∆∞u √Ω ngay sau ƒë√¢y).

- Tuy nhi√™n, kh√¥ng ph·∫£i l√∫c n√†o b·∫°n c≈©ng c√≥ th·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh m√† kh√¥ng c·∫ßn b·∫•t k·ª≥ ph√¢n t√≠ch n√†o c·ªßa con ng∆∞·ªùi. V√≠ d·ª•, gi·∫£ s·ª≠ b·∫°n ƒë√£ hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh ph√¢n lo·∫°i ·∫£nh ƒë·ªÉ ph√°t hi·ªán l·ªói s·∫£n ph·∫©m tr√™n d√¢y chuy·ªÅn s·∫£n xu·∫•t. L√†m th·∫ø n√†o ƒë·ªÉ nh·∫≠n bi·∫øt r·∫±ng bao b√¨ n·∫øu ch·∫•t l∆∞·ª£ng kh√¥ng ƒë·∫°t c≈©ng ƒë∆∞·ª£c m√¥ h√¨nh gi·∫£m xu·ªëng, tr∆∞·ªõc khi nh·∫≠n th·∫•y ph·∫£n h·ªìi b·ªã l·ªói tr·ª±c ti·∫øp t·ª´ kh√°ch h√†ng? M·ªôt gi·∫£i ph√°p l√† g·ª≠i cho ng∆∞·ªùi ƒë√°nh gi√° t·∫•t c·∫£ c√°c b·ª©c ·∫£nh m√† m√¥ h√¨nh ƒë√£ ph√¢n lo·∫°i (ƒë·∫∑c bi·ªát l√† nh·ªØng b·ª©c ·∫£nh m√† m√¥ h√¨nh kh√¥ng ch·∫Øc ch·∫Øn l·∫Øm). T√πy t·ª´ng t√°c v·ª• m√† ng∆∞·ªùi ƒë√°nh gi√° ph·∫£i l√† chuy√™n gia, ho·∫∑c h·ªç c≈©ng c√≥ th·ªÉ l√† ng∆∞·ªùi th∆∞·ªùng, ch·∫≥ng h·∫°n nh∆∞ c√¥ng nh√¢n tr√™n n·ªÅn t·∫£ng cung ·ª©ng c·ªông ƒë·ªìng (v√≠ d·ª•: Amazon Mechanical Turk). Trong m·ªôt s·ªë ·ª©ng d·ª•ng, ng∆∞·ªùi ƒë√°nh gi√° th·∫≠m ch√≠ c√≥ th·ªÉ l√† ch√≠nh ng∆∞·ªùi d√πng, v√≠ d·ª• nh∆∞ th√¥ng qua kh·∫£o s√°t ho·∫∑c captcha.

- D√π b·∫±ng c√°ch n√†o, ta c≈©ng c·∫ßn ƒë·∫∑t m·ªôt h·ªá th·ªëng gi√°m s√°t (c√≥ ho·∫∑c kh√¥ng c√≥ ng∆∞·ªùi ƒë√°nh gi√° ƒë·ªÉ ƒë√°nh gi√° tr·ª±c ti·∫øp m√¥ h√¨nh), c≈©ng nh∆∞ t·∫•t c·∫£ c√°c quy tr√¨nh c√≥ li√™n quan ƒë·ªÉ x√°c ƒë·ªãnh nh·ªØng g√¨ c·∫ßn l√†m trong tr∆∞·ªùng h·ª£p th·∫•t b·∫°i v√† l√†m sao ƒë·ªÉ chu·∫©n b·ªã ·ª©ng ph√≥. Th·∫≠t kh√¥ng may, th·ª±c t·∫ø th√¨ vi·ªác n√†y th∆∞·ªùng t·ªën nhi·ªÅu c√¥ng s·ª©c h∆°n vi·ªác x√¢y d·ª±ng v√† hu·∫•n luy·ªán m·ªôt m√¥ h√¨nh.

- N·∫øu d·ªØ li·ªáu ti·∫øp t·ª•c thay ƒë·ªïi, ta s·∫Ω c·∫ßn c·∫≠p nh·∫≠t t·∫≠p d·ªØ li·ªáu v√† hu·∫•n luy·ªán l·∫°i m√¥ h√¨nh th∆∞·ªùng xuy√™n, do ƒë√≥ ta n√™n t·ª± ƒë·ªông h√≥a to√†n b·ªô qu√° tr√¨nh c√†ng nhi·ªÅu c√†ng t·ªët. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë vi·ªác c√≥ th·ªÉ ƒë∆∞·ª£c t·ª± ƒë·ªông h√≥a:

  - Th∆∞·ªùng xuy√™n thu th·∫≠p d·ªØ li·ªáu m·ªõi v√† g√°n nh√£n (v√≠ d·ª•: s·ª≠ d·ª•ng ng∆∞·ªùi ƒë√°nh gi√°).

  - Vi·∫øt m√£ ƒë·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh v√† tinh ch·ªânh si√™u tham s·ªë m·ªôt c√°ch t·ª± ƒë·ªông. M√£ n√†y c√≥ th·ªÉ ch·∫°y t·ª± ƒë·ªông, v√≠ d·ª• nh∆∞ sau m·ªói ng√†y ho·∫∑c m·ªói tu·∫ßn, t√πy thu·ªôc v√†o nhu c·∫ßu c·ªßa b·∫°n.

  - Vi·∫øt m√£ ƒë·ªÉ ƒë√°nh gi√° c·∫£ m√¥ h√¨nh m·ªõi v√† m√¥ h√¨nh c≈© tr√™n t·∫≠p ki·ªÉm tra ƒë∆∞·ª£c c·∫≠p nh·∫≠t, v√† tri·ªÉn khai m√¥ h√¨nh n·∫øu ch·∫•t l∆∞·ª£ng c·ªßa n√≥ kh√¥ng b·ªã gi·∫£m s√∫t (n·∫øu gi·∫£m th√¨ h√£y t√¨m nguy√™n nh√¢n).

- Ta c≈©ng n√™n ƒë·∫£m b·∫£o r·∫±ng ta ƒë√£ ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng d·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa m√¥ h√¨nh. Th·ªânh tho·∫£ng ch·∫•t l∆∞·ª£ng m√¥ h√¨nh s·∫Ω gi·∫£m nh·∫π do ch·∫•t l∆∞·ª£ng t√≠n hi·ªáu k√©m (v√≠ d·ª•, m·ªôt c·∫£m bi·∫øn b·ªã tr·ª•c tr·∫∑c g·ª≠i ƒëi c√°c gi√° tr·ªã ng·∫´u nhi√™n, ho·∫∑c d·ªØ li·ªáu l√† c√¥ng vi·ªác c·ªßa m·ªôt nh√≥m kh√°c ch∆∞a ƒë∆∞·ª£c c·∫≠p nh·∫≠t), nh∆∞ng c√≥ th·ªÉ m·∫•t m·ªôt l√∫c tr∆∞·ªõc khi ch·∫•t l∆∞·ª£ng gi·∫£m s√∫t ƒë·ªß ƒë·ªÉ k√≠ch ho·∫°t c·∫£nh b√°o. N·∫øu ki·ªÉm so√°t ƒë·∫ßu v√†o c·ªßa m√¥ h√¨nh, ta c√≥ th·ªÉ n·∫Øm b·∫Øt ƒëi·ªÅu n√†y s·ªõm h∆°n. V√¨ v·∫≠y, ta c√≥ th·ªÉ k√≠ch ho·∫°t c·∫£nh b√°o n·∫øu c√≥ nhi·ªÅu ƒë·∫ßu v√†o b·ªã thi·∫øu ƒë·∫∑c tr∆∞ng, ho·∫∑c n·∫øu gi√° tr·ªã trung b√¨nh v√† ƒë·ªô l·ªách chu·∫©n kh√°c qu√° nhi·ªÅu so v·ªõi t·∫≠p hu·∫•n luy·ªán, ho·∫∑c m·ªôt ƒë·∫∑c tr∆∞ng h√†ng m·ª•c b·∫Øt ƒë·∫ßu ch·ª©a nh·ªØng h·∫°ng m·ª•c m·ªõi.

- Cu·ªëi c√πng, h√£y gi·ªØ b·∫£n sao l∆∞u cho m·ªói m√¥ h√¨nh v√† c√≥ quy tr√¨nh c≈©ng nh∆∞ c√¥ng c·ª• ƒë·ªÉ quay tr·ªü l·∫°i m√¥ h√¨nh tr∆∞·ªõc ƒë√≥ m·ªôt c√°ch nhanh ch√≥ng n·∫øu m√¥ h√¨nh m·ªõi b·∫•t ƒë·∫ßu ho·∫°t ƒë·ªông k√©m h·∫≥n ƒëi v√¨ l√Ω do n√†o ƒë√≥. B·∫£n sao l∆∞u c≈©ng gi√∫p ta d·ªÖ d√†ng so s√°nh m√¥ h√¨nh m·ªõi v·ªõi c√°c m√¥ h√¨nh tr∆∞·ªõc ƒë√≥. T∆∞∆°ng t·ª±, ta n√™n gi·ªØ b·∫£n sao l∆∞u cho m·ªói phi√™n b·∫£n d·ªØ li·ªáu ƒë·ªÉ c√≥ th·ªÉ quay tr·ªü l·∫°i t·∫≠p d·ªØ li·ªáu tr∆∞·ªõc ƒë√≥ n·∫øu d·ªØ li·ªáu m·ªõi c√≥ v·∫•n ƒë·ªÅ (v√≠ d·ª•, n·∫øu d·ªØ li·ªáu m·ªõi ch·ª©a nhi·ªÅu ƒëi·ªÉm ngo·∫°i lai). B·∫£n sao l∆∞u d·ªØ li·ªáu c≈©ng cho ph√©p ta ƒë√°nh gi√° b·∫•t k·ª≥ m√¥ h√¨nh n√†o tr√™n b·∫•t k·ª≥ t·∫≠p d·ªØ li·ªáu n√†o tr∆∞·ªõc ƒë√≥.


> üíπ **M·∫πo:** B·∫°n c√≥ th·ªÉ mu·ªën t·∫°o m·ªôt s·ªë t·∫≠p con t·ª´ t·∫≠p ki·ªÉm tra ƒë·ªÉ ƒë√°nh gi√° ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh tr√™n m·ªôt ph·∫ßn c·ª• th·ªÉ c·ªßa d·ªØ li·ªáu. V√≠ d·ª•, b·∫°n mu·ªën c√≥ m·ªôt t·∫≠p con ch·ªâ ch·ª©a d·ªØ li·ªáu g·∫ßn ƒë√¢y nh·∫•t, ho·∫∑c m·ªôt t·∫≠p ki·ªÉm tra cho nh·ªØng lo·∫°i ƒë·∫ßu v√†o c·ª• th·ªÉ (v√≠ d·ª•, qu√°n n·∫±m trong d√£y ƒë·∫•t li·ªÅn v·ªõi qu√°n ven bi·ªÉn). Vi·ªác n√†y n√†y gi√∫p b·∫°n hi·ªÉu s√¢u h∆°n v·ªÅ ƒëi·ªÉm m·∫°nh v√† ƒëi·ªÉm y·∫øu c·ªßa m√¥ h√¨nh.

- C√≥ th·ªÉ th·∫•y, H·ªçc M√°y c·∫ßn kh√° nhi·ªÅu c∆° s·ªü h·∫° t·∫ßng, v√¨ v·∫≠y kh√¥ng c√≥ g√¨ b·∫•t ng·ªù n·∫øu d·ª± √°n ML ƒë·∫ßu ti√™n c·ªßa b·∫°n hao t·ªën nhi·ªÅu c√¥ng s·ª©c v√† th·ªùi gian ƒë·ªÉ x√¢y d·ª±ng v√† tri·ªÉn khai. May m·∫Øn thay, m·ªôt khi t·∫•t c·∫£ c√°c c∆° s·ªü h·∫° t·∫ßng ƒë√£ ·ªïn ƒë·ªãnh, ch·∫∑ng ƒë∆∞·ªùng t·ª´ √Ω t∆∞·ªüng ƒë·∫øn s·∫£n ph·∫©m th·ª±c t·∫ø s·∫Ω ng·∫Øn h∆°n r·∫•t nhi·ªÅu.

## 8. Th·ª±c H√†nh

- Hy v·ªçng r·∫±ng ch∆∞∆°ng n√†y ƒë√£ gi√∫p b·∫°n hi·ªÉu v·ªÅ m·ªôt d·ª± √°n H·ªçc M√°y c≈©ng nh∆∞ cung c·∫•p nh·ªØng c√¥ng c·ª• b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ hu·∫•n luy·ªán m·ªôt h·ªá th·ªëng hi·ªáu qu·∫£. C√≥ th·ªÉ th·∫•y, ƒëa s·ªë c√¥ng vi·ªác t·∫≠p trung v√†o b∆∞·ªõc chu·∫©n b·ªã d·ªØ li·ªáu: x√¢y d·ª±ng c√¥ng c·ª• ki·ªÉm so√°t, thi·∫øt l·∫≠p quy tr√¨nh ƒë√°nh gi√° b·∫±ng con ng∆∞·ªùi, v√† t·ª± ƒë·ªông h√≥a vi·ªác hu·∫•n luy·ªán m√¥ h√¨nh m·ªôt c√°ch th∆∞·ªùng xuy√™n. C√°c thu·∫≠t to√°n H·ªçc M√°y dƒ© nhi√™n c≈©ng ƒë√≥ng vai tr√≤ quan tr·ªçng, nh∆∞ng b·∫°n n√™n hi·ªÉu r√µ v·ªÅ quy tr√¨nh t·ªïng th·ªÉ v√† bi·∫øt th·∫•u ƒë√°o ba ho·∫∑c b·ªën thu·∫≠t to√°n thay v√¨ d√†nh tr·ªçn th·ªùi gian ƒë·ªÉ kh√°m ph√° nh·ªØng thu·∫≠t to√°n n√¢ng cao.

- N·∫øu b·∫°n ch∆∞a l√†m ƒëi·ªÅu ƒë√≥, v·∫≠y th√¨ b√¢y gi·ªù ƒë√£ ƒë·∫øn l√∫c ƒë·ªÉ b·∫°n m·ªü laptop, ch·ªçn m·ªôt t·∫≠p d·ªØ li·ªáu m√† b·∫°n quan t√¢m, c·ªë g·∫Øng th·ª±c hi·ªán quy tr√¨nh t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi. M·ªôt n∆°i t·ªët ƒë·ªÉ b·∫Øt ƒë·∫ßu l√† m·ªôt website d√†nh cho c√°c cu·ªôc thi nh∆∞ [Kaggle](https://www.kaggle.com/): b·∫°n s·∫Ω c√≥ m·ªôt t·∫≠p d·ªØ li·ªáu, m·ªôt m·ª•c ti√™u r√µ r√†ng, v√† nhi·ªÅu ng∆∞·ªùi ƒë·ªÉ chia s·∫ª kinh nghi·ªám. Ch√∫c b·∫°n th·ª±c h√†nh vui v·∫ª!


### B√†i t·∫≠p


1. H√£y th·ª≠ s·ª≠ d·ª•ng m·ªôt b·ªô h·ªìi quy SVM (`sklearn.svm.SVR`) v·ªõi m·ªôt v√†i si√™u tham s·ªë nh∆∞ `kernel="linear"` (v·ªõi nh·ªØng gi√° tr·ªã kh√°c nhau cho C) ho·∫∑c `kernel="rbf"` (v·ªõi c√°c gi√° tr·ªã kh√°c nhau cho C v√† gamma). ƒê·ª´ng v·ªôi quan t√¢m ƒë·∫øn nh·ªØng si√™u tham s·ªë n√†y l√† g√¨. Ch·∫•t l∆∞·ª£ng c·ªßa m√¥ h√¨nh SVR t·ªët nh·∫•t nh∆∞ th·∫ø n√†o?

2. H√£y th·ª≠ thay `GridSearchCV` b·∫±ng `RandomizedSearchCV`.

3. H√£y th√™m m·ªôt b·ªô bi·∫øn ƒë·ªïi v√†o `pipeline` ƒë·ªÉ ch·ªâ ch·ªçn ra nh·ªØng thu·ªôc t√≠nh quan tr·ªçng nh·∫•t.

4. Th·ª≠ t·∫°o m·ªôt `pipeline` ƒë∆°n gi·∫£n c√≥ th·ªÉ th·ª±c hi·ªán t·ª± vi·ªác chu·∫©n b·ªã d·ªØ li·ªáu ƒë·∫øn vi·ªác ƒë∆∞a ra d·ª± ƒëo√°n cu·ªëi c√πng.

5. T·ª± ƒë·ªông kh√°m ph√° m·ªôt s·ªë t√πy ch·ªçn trong vi·ªác chu·∫©n b·ªã d·ªØ li·ªáu b·∫±ng c√°ch s·ª≠ d·ª•ng `GridSearchCV`.

